[
  {
    "__docId__": 0,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/_old_role/index.js",
    "memberof": null,
    "longname": "api/_old_role/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./category.controller');\n\nvar router = express.Router();\n\n//get all roles under some space, \n//router.get('/', controller.index);\n//get role by id\nrouter.get('/:id', controller.getRole);\n//add child role\nrouter.post('/:id', controller.addChild);\n//get role by name\nrouter.put('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nrouter.get('/bn/:name', controller.getRole);\n//get all roles in space\nrouter.get('/:spaceId/space', controller.getSpaceRoles);\n//get user roles in space\nrouter.get('/:spaceId/me', controller.getUserRoles);\n//add space role\nrouter.post('/space/:spaceId', controller.addRole);\n\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 1,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/_old_role/index.js",
    "longname": "api/_old_role/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 2,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/_old_role/index.js",
    "longname": "api/_old_role/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 3,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/_old_role/index.js",
    "longname": "api/_old_role/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 4,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/_old_role/index.spec.js",
    "memberof": null,
    "longname": "api/_old_role/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar categoryCtrlStub = {\n  index: 'categoryCtrl.index',\n  show: 'categoryCtrl.show',\n  create: 'categoryCtrl.create',\n  update: 'categoryCtrl.update',\n  destroy: 'categoryCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar categoryIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './category.controller': categoryCtrlStub\n});\n\ndescribe('Category API Router:', function() {\n\n  it('should return an express router instance', function() {\n    categoryIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/categorys', function() {\n\n    it('should route to category.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'categoryCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/categorys/:id', function() {\n\n    it('should route to category.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'categoryCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/categorys', function() {\n\n    it('should route to category.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'categoryCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/categorys/:id', function() {\n\n    it('should route to category.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'categoryCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/categorys/:id', function() {\n\n    it('should route to category.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'categoryCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/categorys/:id', function() {\n\n    it('should route to category.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'categoryCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 5,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/_old_role/index.spec.js",
    "longname": "api/_old_role/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 6,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "categoryCtrlStub",
    "memberof": "api/_old_role/index.spec.js",
    "longname": "api/_old_role/index.spec.js~categoryCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 7,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/_old_role/index.spec.js",
    "longname": "api/_old_role/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 8,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "categoryIndex",
    "memberof": "api/_old_role/index.spec.js",
    "longname": "api/_old_role/index.spec.js~categoryIndex",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 9,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/_old_role/role.events.js",
    "memberof": null,
    "longname": "api/_old_role/role.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Category model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Category = require('../../sqldb').Category;\nvar CategoryEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nCategoryEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Category.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    CategoryEvents.emit(event + ':' + doc._id, doc);\n    CategoryEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default CategoryEvents;\n"
  },
  {
    "__docId__": 10,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Category",
    "memberof": "api/_old_role/role.events.js",
    "longname": "api/_old_role/role.events.js~Category",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/role.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 11,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/_old_role/role.events.js",
    "longname": "api/_old_role/role.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/role.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 12,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/_old_role/role.events.js",
    "longname": "api/_old_role/role.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/role.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 13,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/_old_role/role.integration.js",
    "memberof": null,
    "longname": "api/_old_role/role.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newCategory;\n\ndescribe('Category API:', function() {\n\n  describe('GET /api/categorys', function() {\n    var categorys;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/categorys')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          categorys = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      categorys.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/categorys', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/categorys')\n        .send({\n          name: 'New Category',\n          info: 'This is the brand new category!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newCategory = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created category', function() {\n      newCategory.name.should.equal('New Category');\n      newCategory.info.should.equal('This is the brand new category!!!');\n    });\n\n  });\n\n  describe('GET /api/categorys/:id', function() {\n    var category;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/categorys/' + newCategory._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          category = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      category = {};\n    });\n\n    it('should respond with the requested category', function() {\n      category.name.should.equal('New Category');\n      category.info.should.equal('This is the brand new category!!!');\n    });\n\n  });\n\n  describe('PUT /api/categorys/:id', function() {\n    var updatedCategory;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/categorys/' + newCategory._id)\n        .send({\n          name: 'Updated Category',\n          info: 'This is the updated category!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedCategory = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedCategory = {};\n    });\n\n    it('should respond with the updated category', function() {\n      updatedCategory.name.should.equal('Updated Category');\n      updatedCategory.info.should.equal('This is the updated category!!!');\n    });\n\n  });\n\n  describe('DELETE /api/categorys/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/categorys/' + newCategory._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when category does not exist', function(done) {\n      request(app)\n        .delete('/api/categorys/' + newCategory._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 14,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/_old_role/role.integration.js",
    "longname": "api/_old_role/role.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/role.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 15,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/_old_role/role.model.js",
    "memberof": null,
    "longname": "api/_old_role/role.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\nimport TreeTable from '../../sqldb/treeTable';\nimport {UserRole} from '../../sqldb/';\nimport {User} from '../../sqldb/';\nimport {Space} from '../../sqldb/';\n\nexport default function(sequelize, DataTypes) {\n\treturn sequelize.define('Role', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tparentId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tappId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tname: DataTypes.STRING,\n\t\talias: DataTypes.STRING,\n\t\tfullname: DataTypes.STRING,\n\t\towner: DataTypes.STRING,\n\t\townerId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t}, {\n\t\tgetterMethods: {\n\t\t\troleName: function(){\n\t\t\t\treturn this.fullname.slice(5);\n\t\t\t},\n\t\t\tname: function(){\n\t\t\t\treturn this.fullname.slice(5);\n\t\t\t}\n\t\t},\n\t\tclassMethods: {\n\t\t\tgetRoot: function() {\n\t\t\t\treturn this\n\t\t\t\t\t.findOrCreate({\n\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\tname: 'root',\n\t\t\t\t\t\t\tfullname: 'root'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\talias: 'root'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.spread(function(entity, created) {\n\t\t\t\t\t\treturn Promise.resolve(entity);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\tgetCustomer: function(context) {\n\n\t\t\t\t//console.log('in getTypeRoot typeData:', typeData);\n\n\t\t\t\tvar Model = this;\n\n\t\t\t\treturn this.getRoot().then(function(root) {\n\t\t\t\t\tvar whereData = {};\n\n\t\t\t\t\tif (typeof context === 'object') {\n\t\t\t\t\t\tfor (var key in context) {\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n\t\t\t\t\t\t\t\twhereData.owner = context[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'appid' || key.toLowerCase() === 'spaceid' || key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\t\twhereData.owner = context[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twhereData.name = 'customer';\n\t\t\t\t\twhereData.fullname = 'root.customer';\n\t\t\t\t\twhereData.parentId = 1;\n\n\t\t\t\t\t//console.log('getTypeRoot root: ', JSON.stringify(root));\n\n\t\t\t\t\t//console.log('getTypeRoot whereData: ', JSON.stringify(whereData));\n\n\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\twhere: whereData,\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\talias: 'customer'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\t.spread(function(entity, created) {\n\t\t\t\t\t\t\t//console.log('getTypeRoot created: ', created);\n\t\t\t\t\t\t\treturn Promise.resolve(entity);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t},\n\t\t\tgetMember: function(context) {\n\n\t\t\t\tvar Model = this;\n\n\t\t\t\treturn this.getRoot().then(function(root) {\n\t\t\t\t\tvar whereData = {};\n\n\t\t\t\t\tif (typeof context === 'object') {\n\t\t\t\t\t\tfor (var key in context) {\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n\t\t\t\t\t\t\t\twhereData.owner = context[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'appid' || key.toLowerCase() === 'spaceid' || key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\t\twhereData.owner = context[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twhereData.name = 'member';\n\t\t\t\t\twhereData.fullname = 'root.member';\n\t\t\t\t\twhereData.parentId = 1;\n\n\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\twhere: whereData,\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\talias: 'member'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\t.spread(function(entity, created) {\n\t\t\t\t\t\t\treturn Promise.resolve(entity);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetAdmin: function(context) {\n\n\t\t\t\tvar Model = this;\n\n\t\t\t\treturn this.getRoot().then(function(root) {\n\t\t\t\t\tvar whereData = {};\n\n\t\t\t\t\tif (typeof context === 'object') {\n\t\t\t\t\t\tfor (var key in context) {\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n\t\t\t\t\t\t\t\twhereData.owner = context[key];\n\t\t\t\t\t\t\t\t//delete categoryData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'appid' || key.toLowerCase() === 'spaceid' || key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\t\twhereData.owner = context[key];\n\t\t\t\t\t\t\t\t//delete categoryData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twhereData.name = 'admin';\n\t\t\t\t\twhereData.fullname = 'root.admin';\n\t\t\t\t\twhereData.parentId = 1;\n\n\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\twhere: whereData,\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\talias: 'admin'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\t.spread(function(entity, created) {\n\t\t\t\t\t\t\treturn Promise.resolve(entity);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetUserRoles: function(context) {\n\t\t\t\tvar whereData = {};\n\t\t\t\tif(typeof context === 'object'){\n\t\t\t\t\tfor(var key in context){\n\t\t\t\t\t\tif( key.toLowerCase() === 'spaceid' || key.toLowerCase() === 'userid'){\n\t\t\t\t\t\t\twhereData.spaceId = context[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(whereData.hasOwnProperty('spaceId') && whereData.hasOwnProperty('appId')){\n\t\t\t\t\tUserRole.belongsTo(User);\n\t\t\t\t\tUserRole.belongsTo(Space);\n\t\t\t\t\tUserRole.belongsTo(Role);\n\t\t\t\t\treturn UserRole.findAll({\n\t\t\t\t\t\tinclude: [{all: true}],\n\t\t\t\t\t\twhere: whereData\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//otherwhise, return error\n\t\t\t\treturn Promise.reject(new Error('fail to run function!'));\n\t\t\t}\n\t\t},\n\t\tinstanceMethods:{\n\t\t\taddChild: function(childData){\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.addChild(this,childData);\n\t\t\t},\n\t\t\tgetChildren: function(childData){\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.getChildren(this,childData);\n\t\t\t},\n\t\t\tgetChild: function(childData){\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.getChild(this,childData);\n\t\t\t},\n\t\t\tgetParent: function(recursive){\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.getParent(this,recursive);\n\t\t\t},\n\t\t\tchildCount: function(){\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.childCount(this);\n\t\t\t},\n\t\t\tisParentOf: function(childObj,recursive){\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.isParentOf(childObj,this,recursive);\n\t\t\t},\n\t\t\tisChildOf: function(parentObj,recursive){\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.isChildOf(parentObj,this,childData);\n\t\t\t}\n\t\t}\n\t});\n}\n"
  },
  {
    "__docId__": 16,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/_old_role/role.model.js",
    "longname": "api/_old_role/role.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/role.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 17,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "role",
    "memberof": "api/_old_role/role.model.js",
    "longname": "api/_old_role/role.model.js~role",
    "access": null,
    "export": true,
    "importPath": "./api/_old_role/role.model.js",
    "importStyle": "role",
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 18,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/_old_role/userRole.model.js",
    "memberof": null,
    "longname": "api/_old_role/userRole.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\nimport TreeTable from '../../sqldb/treeTable';\n\nexport default function(sequelize, DataTypes) {\n\treturn sequelize.define('UserRole', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tuserId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\troleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t});\n}\n"
  },
  {
    "__docId__": 19,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/_old_role/userRole.model.js",
    "longname": "api/_old_role/userRole.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/_old_role/userRole.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 20,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "userRole",
    "memberof": "api/_old_role/userRole.model.js",
    "longname": "api/_old_role/userRole.model.js~userRole",
    "access": null,
    "export": true,
    "importPath": "./api/_old_role/userRole.model.js",
    "importStyle": "userRole",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 21,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/app.controller.js",
    "memberof": null,
    "longname": "api/app/app.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {App} from '../../sqldb';\nimport {SpaceApp} from '../../sqldb';\nimport {Space} from '../../sqldb';\nimport {Category} from '../../sqldb';\nimport {Nut} from '../../sqldb';\nimport {PermitRole} from '../../sqldb';\nvar Promise = require('bluebird');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function (entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function (entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n/**\n * get apps according to condition, usually we use \n * this function to find apps under some space, in case\n * we need provide spaceId as params, format like: {spaceId=xxx},\n * if provide userId, it will navigate to findUserApps\n * @method module:server/api/app.method:index\n * @param req.query {object} condition for finding apps\n * @returns {array} return array of app object, and in each app it\n * contain nuts under app, format like: [{_id:xxx,name:xxx, nuts: [...]}]\n */\nexport function index(req, res) {\n\n  App.hasMany(Nut, { as: 'nuts' });\n  App.belongsTo(Category, { as: 'type' });\n\n  var spaceId = req.query.spaceId || undefined;\n  var userId = req.query.userId || undefined;\n\n  if (userId) {\n    return findUserApps(req.res);\n  }\n\n  if (spaceId) {\n    return App.findAll({\n      where: req.query,\n      include: [\n        {\n          model: Nut, as: 'nuts',\n          where: {\n            spaceId: spaceId\n          }\n        },\n        {\n          model: Category, as: 'type'\n        }\n      ]\n    })\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n\n  //otherwise, send error message\n  return res.status(500).send('please check input!');\n}\n\n/**\n * get one app. mention: if want find app by query, \n * please use index function to find all expected apps and then \n * get first one from array\n * @method module:server/api/app.method:show\n * @param req.params.id {int} if provide id param, then get by id\n * @returns {object} app object, contain nuts array for app\n */\nexport function show(req, res) {\n\n  App.belongsTo(Category, { as: 'type' });\n  Nut.belongsTo(Category, { as: 'type' });\n  App.hasMany(Nut, { as: 'nuts' });\n\n  var appId = req.params.id || undefined;\n\n  if (appId) {\n    return App.find({\n      where: {\n        _id: appId\n      },\n      include: [\n        {\n          model: Category, as: 'type'\n        },\n        {\n          model: Nut, as: 'nuts',\n          include: [\n            {\n              model: Category, as: 'type'\n            }\n          ]\n        }\n      ]\n    })\n      .then(handleEntityNotFound(res))\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n\n  //otherwise, return error\n  return res.status(500).send('please check input!');\n}\n\n// Updates an existing App in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  App.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a App from the DB\nexport function destroy(req, res) {\n  App.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function joinSpace(req, res) {\n\n  if (req.body.spaceId && req.body.appId) {\n\n    SpaceApp.findOrCreate({\n      where: req.body\n    })\n      .spread(function (entity, created) {\n        var data = {\n          data: entity,\n          created: created\n        };\n        return Promise.resolve(data);\n      })\n      .then(respondWithResult(res, 201))\n      .catch(handleError(res));\n  }\n\n}\n\nexport function findAppsInSpace(req, res) {\n\n  App.belongsTo(Category, { as: 'type' });\n  Nut.belongsTo(App, { as: 'app' });\n  Nut.belongsTo(Space, { as: 'space' });\n  Nut.belongsTo(Category, { as: 'type' });\n\n  var queryData = req.query;\n\n  App.findAll({\n    where: queryData,\n    include: {\n      model: Category, as: 'type'\n    }\n  })\n    .then(function (rows) {\n      //console.log('rows:',rows);\n      var apps = [];\n      return Promise.map(rows, function (row) {\n        //console.log('row:',JSON.stringify(row));\n        var appId = row.appId;\n        var spaceId = row.spaceId;\n        var app = JSON.parse(JSON.stringify(row.app));\n        //console.log('app:',app);\n        return Nut.findAll({\n          where: {\n            appId: appId,\n            spaceId: spaceId\n          },\n          include: {\n            model: Category, as: 'type'\n          }\n        }).then(function (rows) {\n          app.nuts = rows;\n          apps.push(app);\n        });\n      }).then(function () {\n        return Promise.resolve(apps);\n      });\n    })\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n/**\n * create app\n * @method module:server/api/app.method:create\n * @param req.body {object} must provide spaceId, name as appName, typeId or type\n * @returns {object} return app object\n */\nexport function create(req, res) {\n\n  //console.log('req.body:', JSON.stringify(req.body));\n\n  var spaceId = req.body.spaceId || undefined;\n  var appName = req.body.name || undefined;\n  var typeId = req.body.name || undefined;\n  var type = req.body.name || undefined;\n\n  if (spaceId && appName && (typeId || type)) {\n    return App.add(appData, spaceId)\n      .then(respondWithResult(res, 201))\n      .catch(handleError(res));\n  } else {\n    return Promise.reject('Please provide spaceId && name && type when create app!');\n  }\n\n\n}\n\n/**\n * create apps in same time\n * @method module:server/api/app.method:bulkCreate\n * @param req.body {object} must provide spaceId and appDataList or appDataCollection\n * format like: {spaceId: xxx, appDataList(appDataCollection): []}\n * @returns {array} return array of app object\n */\nexport function bulkCreate(req, res) {\n\n  var appDataCollection = req.body.appDataCollection || undefined;\n  var appDataList = req.body.appDataList || undefined;\n  var spaceId = req.body.spaceId || undefined;\n\n  if (spaceId || (appDataCollection || appDataList)) {\n    App.bulkAdd(appDataCollection, spaceId)\n      .then(respondWithResult(res, 201))\n      .catch(handleError(res));\n  } else {\n    res.status(500).send('please provide spaceId and appDataCollection!');\n  }\n\n\n}\n"
  },
  {
    "__docId__": 22,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 19,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 23,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 21,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 24,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 25,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 39,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 26,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 50,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 27,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 60,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 28,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{index}",
    "description": "get apps according to condition, usually we use \nthis function to find apps under some space, in case\nwe need provide spaceId as params, format like: {spaceId=xxx},\nif provide userId, it will navigate to findUserApps",
    "lineNumber": 77,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/app.method:index"
      },
      {
        "tagName": "@returns",
        "tagValue": "{array} return array of app object, and in each app it\ncontain nuts under app, format like: [{_id:xxx,name:xxx, nuts: [...]}]"
      }
    ],
    "params": [
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.query",
        "description": "{object} condition for finding apps"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "array"
      ],
      "spread": false,
      "description": "return array of app object, and in each app it\ncontain nuts under app, format like: [{_id:xxx,name:xxx, nuts: [...]}]"
    },
    "generator": false
  },
  {
    "__docId__": 29,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{show}",
    "description": "get one app. mention: if want find app by query, \nplease use index function to find all expected apps and then \nget first one from array",
    "lineNumber": 120,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/app.method:show"
      },
      {
        "tagName": "@returns",
        "tagValue": "{object} app object, contain nuts array for app"
      }
    ],
    "params": [
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.params.id",
        "description": "{int} if provide id param, then get by id"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "object"
      ],
      "spread": false,
      "description": "app object, contain nuts array for app"
    },
    "generator": false
  },
  {
    "__docId__": 30,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 157,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 31,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 173,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 32,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "joinSpace",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~joinSpace",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{joinSpace}",
    "description": null,
    "lineNumber": 184,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 33,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAppsInSpace",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~findAppsInSpace",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{findAppsInSpace}",
    "description": null,
    "lineNumber": 204,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 34,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{create}",
    "description": "create app",
    "lineNumber": 254,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/app.method:create"
      },
      {
        "tagName": "@returns",
        "tagValue": "{object} return app object"
      }
    ],
    "params": [
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.body",
        "description": "{object} must provide spaceId, name as appName, typeId or type"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "object"
      ],
      "spread": false,
      "description": "return app object"
    },
    "generator": false
  },
  {
    "__docId__": 35,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "bulkCreate",
    "memberof": "api/app/app.controller.js",
    "longname": "api/app/app.controller.js~bulkCreate",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.controller.js",
    "importStyle": "{bulkCreate}",
    "description": "create apps in same time",
    "lineNumber": 281,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/app.method:bulkCreate"
      },
      {
        "tagName": "@returns",
        "tagValue": "{array} return array of app object"
      }
    ],
    "params": [
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.body",
        "description": "{object} must provide spaceId and appDataList or appDataCollection\nformat like: {spaceId: xxx, appDataList(appDataCollection): []}"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "array"
      ],
      "spread": false,
      "description": "return array of app object"
    },
    "generator": false
  },
  {
    "__docId__": 36,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/app.events.js",
    "memberof": null,
    "longname": "api/app/app.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 37,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/app/app.events.js",
    "longname": "api/app/app.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 38,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/app/app.events.js",
    "longname": "api/app/app.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 39,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/app/app.events.js",
    "longname": "api/app/app.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 40,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/app.integration.js",
    "memberof": null,
    "longname": "api/app/app.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 41,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/app/app.integration.js",
    "longname": "api/app/app.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 42,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/app.model.js",
    "memberof": null,
    "longname": "api/app/app.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport _ from 'lodash';\nvar Promise = require('bluebird');\n\nexport default function (sequelize, DataTypes) {\n\treturn sequelize.define('App', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tname: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\talias: DataTypes.STRING,\n\t\tdescription: DataTypes.STRING,\n\t\ttypeId: DataTypes.INTEGER,\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t}, {\n\t\t\tclassMethods: {\n\t\t\t\taddType: function (typeData) {\n\t\t\t\t\treturn this.getType(typeData, true);\n\t\t\t\t},\n\t\t\t\tgetType: function (typeData, autoCreated) {\n\t\t\t\t\t//console.log('in app Category:', Category);\n\t\t\t\t\t//console.log('in app User:', User);\n\t\t\t\t\t//console.log('in app sqldb:', sqldb);\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\t//var Category = sqldb.Category;\n\t\t\t\t\t//console.log('in app Category:', Category);\n\t\t\t\t\tif (typeof typeData === 'string' && isNaN(typeData)) {\n\t\t\t\t\t\tvar typeName = typeData;\n\n\t\t\t\t\t\ttypeData = {};\n\n\t\t\t\t\t\ttypeData.name = typeName;\n\n\t\t\t\t\t\t//console.log('in space getType');\n\t\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\t\t//console.log('space getType typeData:', JSON.stringfy(typeData));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof typeData === 'object' && !_.isEmpty(typeData)) {\n\t\t\t\t\t\ttypeData.owner = 'app';\n\t\t\t\t\t\tvar tyName = typeData.name;\n\t\t\t\t\t\tif (tyName.substr(0, 4).toLowerCase() !== 'app.') {\n\t\t\t\t\t\t\ttyName = 'app.' + tyName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttypeData.name = tyName;\n\t\t\t\t\t\t//console.log('app model typeData:', JSON.stringify(typeData));\n\t\t\t\t\t\treturn Category.getType(typeData, true);\n\t\t\t\t\t}\n\n\t\t\t\t\t//otherwise return promise reject\n\t\t\t\t\tsequelize.Promise.reject(new Error('fail to add type!'));\n\t\t\t\t},\n\t\t\t\tadd: function (appData, spaceId) {\n\n\t\t\t\t\tvar app;\n\t\t\t\t\tvar typeId;\n\t\t\t\t\tvar App = sqldb.App;\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\tvar Nut = sqldb.Nut;\n\t\t\t\t\tvar PermitRole = sqldb.PermitRole;\n\t\t\t\t\tvar isNewApp = false;\n\n\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\n\t\t\t\t\t\t//console.log('1 appData:', JSON.stringify(appData));\n\n\t\t\t\t\t\tvar typeName;\n\n\t\t\t\t\t\tfor (var key in appData) {\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'type' || key.toLowerCase() === 'typename') {\n\t\t\t\t\t\t\t\ttypeName = appData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (appData.typeId) {\n\t\t\t\t\t\t\treturn resolve(appData.typeId);\n\t\t\t\t\t\t} else if (typeName) {\n\t\t\t\t\t\t\treturn App.addType({\n\t\t\t\t\t\t\t\tname: typeName,\n\t\t\t\t\t\t\t\tspaceId: spaceId\n\t\t\t\t\t\t\t}).then(function (type) {\n\t\t\t\t\t\t\t\t//console.log('after get type:', JSON.stringify(type));\n\t\t\t\t\t\t\t\treturn resolve(type._id);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn reject('fail to get typeId in create app!');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}).then(function (typeId) {\n\n\t\t\t\t\t\t//console.log('2: typeId:',typeId);\n\n\t\t\t\t\t\tvar appName = appData.name;\n\t\t\t\t\t\tappData.typeId = typeId;\n\n\t\t\t\t\t\tif (!appName) {\n\t\t\t\t\t\t\treturn Promise.reject('fail to find appName in create app!');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tappData.alias = appData.alias || appName;\n\n\t\t\t\t\t\t\t//console.log(\"createApp appData before created app:\", JSON.stringify(appData));\n\n\t\t\t\t\t\t\tApp.belongsTo(Category, { as: 'type' });\n\n\t\t\t\t\t\t\treturn App.findOrCreate({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\tname: appName,\n\t\t\t\t\t\t\t\t\tspaceId: spaceId\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdefaults: appData\n\t\t\t\t\t\t\t}).spread(function (result, created) {\n\t\t\t\t\t\t\t\tisNewApp = created;\n\t\t\t\t\t\t\t\t//console.log('created:',created);\n\t\t\t\t\t\t\t\t//console.log('result:',JSON.stringify(result));\n\t\t\t\t\t\t\t\tif (created) {\n\t\t\t\t\t\t\t\t\treturn Promise.resolve(result);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t//console.log('not create app result:',result);\n\t\t\t\t\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t\t\t\t\treturn resolve(result);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(function (newApp) {\n\t\t\t\t\t\tapp = newApp;\n\t\t\t\t\t\tvar nuts;\n\t\t\t\t\t\tvar type;\n\t\t\t\t\t\tif (appData.nuts) {\n\t\t\t\t\t\t\tnuts = appData.nuts;\n\t\t\t\t\t\t\ttype = 'nut.normal';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (appData.cores) {\n\t\t\t\t\t\t\tnuts = appData.cores;\n\t\t\t\t\t\t\ttype = 'nut.core';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!isNewApp) {\n\t\t\t\t\t\t\treturn Promise.resolve(app);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!nuts) {\n\t\t\t\t\t\t\treturn Promise.reject('fail to find nuts data when creating app!');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar nutArray = [];\n\n\t\t\t\t\t\t//console.log('nuts:', JSON.stringify(nuts));\n\n\t\t\t\t\t\tfor (var key in nuts) {\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar nutData = nuts[key];\n\t\t\t\t\t\t\t//console.log('nutData:', nutData);\n\t\t\t\t\t\t\tvar nut = {};\n\t\t\t\t\t\t\tnut.name = key;\n\t\t\t\t\t\t\tnut.alias = nutData.alias || key;\t\t\t\n\t\t\t\t\t\t\tnut.description = nutData.description || nut.alias;\n\t\t\t\t\t\t\tnut.type = nutData.type || type;\n\t\t\t\t\t\t\tnut.spaceId = spaceId;\n\t\t\t\t\t\t\tnut.appId = app._id;\n\t\t\t\t\t\t\tnutArray.push(nut);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t//console.log('nutArray:', JSON.stringify(nutArray));\n\n\t\t\t\t\t\treturn Nut.addBulkNut(nutArray);\n\n\t\t\t\t\t})\n\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\tif (!isNewApp) {\n\t\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn Nut.findAll({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\tspaceId: spaceId,\n\t\t\t\t\t\t\t\t\tappId: app._id\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).then(function (nuts) {\n\t\t\t\t\t\t\t\t//add nut permits\n\t\t\t\t\t\t\t\tvar permitRoleList = [];\n\t\t\t\t\t\t\t\t//console.log('nuts:', JSON.stringify(nuts));\n\t\t\t\t\t\t\t\t//console.log('appData:', JSON.stringify(appData));\n\t\t\t\t\t\t\t\tnuts.forEach(function (nut) {\n\t\t\t\t\t\t\t\t\tvar nutName = nut.name;\n\t\t\t\t\t\t\t\t\tvar appName = app.name;\n\t\t\t\t\t\t\t\t\tvar grants;\n\t\t\t\t\t\t\t\t\tif (appData['cores'] && appData['cores'][nutName]['grants']) {\n\t\t\t\t\t\t\t\t\t\tgrants = appData['cores'][nutName]['grants'];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (appData['nuts'] && appData['nuts'][nutName]['grants']) {\n\t\t\t\t\t\t\t\t\t\tgrants = appData['nuts'][nutName]['grants'];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t//console.log('grants:', JSON.stringify(grants));\n\t\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t\t * grants format:\n\t\t\t\t\t\t\t\t\t * {\n\t\t\t\t\t\t\t\t\t * \t\t\"roleName|roleAlias\": \"permitName|permitAlias,....\",\n\t\t\t\t\t\t\t\t\t * \t\t\"roleName|roleAlias\": [\"permitName|permitAlias\",...],\n\t\t\t\t\t\t\t\t\t * \t\t\"roleName|roleAlias\": [{name:xxx,alias:xxxx},...]\n\t\t\t\t\t\t\t\t\t * }\n\t\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\t\tfor (var key in grants) {\n\t\t\t\t\t\t\t\t\t\tvar permits = grants[key];\n\t\t\t\t\t\t\t\t\t\tvar roleData = {};\n\t\t\t\t\t\t\t\t\t\tvar permitList = [];\n\t\t\t\t\t\t\t\t\t\t//console.log('typeof permits:',typeof permits);\n\t\t\t\t\t\t\t\t\t\tif (typeof permits === 'object') {\n\t\t\t\t\t\t\t\t\t\t\tpermits.forEach(function (permitData) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (typeof permitData === 'string') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar posList = permitData.split(\"|\");\n\t\t\t\t\t\t\t\t\t\t\t\t\tpermitList.push({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: posList[0],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talias: posList[1] || posList[0]\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tif(typeof permitData === 'object'){\n\t\t\t\t\t\t\t\t\t\t\t\t\tpermitList.push(permitData);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t//permitList = permits;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (typeof permits === 'string') {\n\t\t\t\t\t\t\t\t\t\t\tvar pList = permits.split(\",\");\n\t\t\t\t\t\t\t\t\t\t\t//console.log('pList', pList);\n\t\t\t\t\t\t\t\t\t\t\tpList.forEach(function (p) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar psList = p.split(\"|\");\n\t\t\t\t\t\t\t\t\t\t\t\t//console.log('psList', psList);\n\t\t\t\t\t\t\t\t\t\t\t\t//console.log('psList[0]', psList[0]);\n\t\t\t\t\t\t\t\t\t\t\t\t//console.log('psList[1]', psList[1]);\n\t\t\t\t\t\t\t\t\t\t\t\tpermitList.push({\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: psList[0],\n\t\t\t\t\t\t\t\t\t\t\t\t\talias: psList[1] || psList[0]\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tvar rList = key.split(\"|\");\n\t\t\t\t\t\t\t\t\t\t//console.log('rList', rList);\n\t\t\t\t\t\t\t\t\t\t//console.log('rList[0]', rList[0]);\n\t\t\t\t\t\t\t\t\t\t//console.log('rList[1]', rList[1]);\n\t\t\t\t\t\t\t\t\t\troleData.name = rList[0];\n\t\t\t\t\t\t\t\t\t\troleData.alias = rList[1] || rList[0];\n\t\t\t\t\t\t\t\t\t\tpermitList.forEach(function (permit) {\n\t\t\t\t\t\t\t\t\t\t\tvar oPermit = {};\n\t\t\t\t\t\t\t\t\t\t\toPermit.role = roleData;\n\t\t\t\t\t\t\t\t\t\t\toPermit.permit = permit;\n\t\t\t\t\t\t\t\t\t\t\toPermit.spaceId = spaceId;\n\t\t\t\t\t\t\t\t\t\t\toPermit.owner = 'nut';\n\t\t\t\t\t\t\t\t\t\t\toPermit.ownerId = nut._id;\n\t\t\t\t\t\t\t\t\t\t\tpermitRoleList.push(oPermit);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t//console.log('permitRoleList:', JSON.stringify(permitRoleList));\n\t\t\t\t\t\t\t\treturn PermitRole.addBulkPermitRole(permitRoleList);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t\t//console.log('1 app:',JSON.stringify(app));\n\t\t\t\t\t\t\tApp.belongsTo(Category, { as: 'type' });\n\t\t\t\t\t\t\treturn App.find({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t_id: app._id\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tinclude: [{\n\t\t\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tbulkAdd: function (listOfAppData, spaceId) {\n\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar apps = [];\n\n\t\t\t\t\treturn Promise.each(listOfAppData, function (appData) {\n\t\t\t\t\t\treturn that.add(appData, spaceId).then(function (app) {\n\t\t\t\t\t\t\t//console.log('app:',JSON.stringify(app));\n\t\t\t\t\t\t\tapps.push(app);\n\t\t\t\t\t\t})\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('apps:',JSON.stringify(apps));\n\t\t\t\t\t\treturn Promise.resolve(apps);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t});\n}\n"
  },
  {
    "__docId__": 43,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/app/app.model.js",
    "longname": "api/app/app.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 44,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/app/app.model.js",
    "longname": "api/app/app.model.js~app",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.model.js",
    "importStyle": "app",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 45,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/app.socket.js",
    "memberof": null,
    "longname": "api/app/app.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 46,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/app/app.socket.js",
    "longname": "api/app/app.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 47,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/app/app.socket.js",
    "longname": "api/app/app.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 48,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/app/app.socket.js",
    "longname": "api/app/app.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/app/app.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 49,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/app/app.socket.js",
    "longname": "api/app/app.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 50,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/app/app.socket.js",
    "longname": "api/app/app.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/app/app.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 51,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/index.js",
    "memberof": null,
    "longname": "api/app/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./app.controller');\n\nvar router = express.Router();\n\n/**\n * Provides the base sever side restful api under app module\n * \n * Using Rails-like standard naming convention for endpoints.\n * \n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * POST    /api/apps/bulk         ->  bulk create apps\n * GET     /api/apps/:id          ->  get app by id\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n * \n * @module server/api/app\n */\n\nrouter.get('/', controller.index);\n//router.get('/byname', controller.show);\nrouter.get('/:id', controller.show);\n//router.get('/byname/:name', controller.getAppByName);\nrouter.post('/bulk', controller.bulkCreate);\n//router.post('/joinSpace', controller.joinSpace);\nrouter.post('/', controller.create);\n//router.post('/app', controller.createApp);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 52,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/app/index.js",
    "longname": "api/app/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/app/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 53,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/app/index.js",
    "longname": "api/app/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/app/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 54,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/app/index.js",
    "longname": "api/app/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/app/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 55,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/index.spec.js",
    "memberof": null,
    "longname": "api/app/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 56,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/app/index.spec.js",
    "longname": "api/app/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/app/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 57,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/app/index.spec.js",
    "longname": "api/app/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/app/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 58,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/app/index.spec.js",
    "longname": "api/app/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/app/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 59,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/app/index.spec.js",
    "longname": "api/app/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/app/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 60,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/app/spaceApp.model.js",
    "memberof": null,
    "longname": "api/app/spaceApp.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('SpaceApp', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    spaceId: DataTypes.INTEGER,\n\tappId: DataTypes.INTEGER,\n    active: DataTypes.BOOLEAN\n  });\n}\n"
  },
  {
    "__docId__": 61,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "spaceApp",
    "memberof": "api/app/spaceApp.model.js",
    "longname": "api/app/spaceApp.model.js~spaceApp",
    "access": null,
    "export": true,
    "importPath": "./api/app/spaceApp.model.js",
    "importStyle": "spaceApp",
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 62,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/attribute/attribute.controller.js",
    "memberof": null,
    "longname": "api/attribute/attribute.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/attributes              ->  index\n * POST    /api/attributes              ->  create\n * GET     /api/attributes/:id          ->  show\n * PUT     /api/attributes/:id          ->  update\n * DELETE  /api/attributes/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Attribute} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function (entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function (entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Attributes\nexport function index(req, res) {\n  Attribute.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Attribute from the DB\nexport function show(req, res) {\n  Attribute.find({\n      where: {\n        _id: req.params.id\n      }\n    })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Attribute in the DB\nexport function create(req, res) {\n  Attribute.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Attribute in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Attribute.find({\n      where: {\n        _id: req.params.id\n      }\n    })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Attribute from the DB\nexport function destroy(req, res) {\n  Attribute.find({\n      where: {\n        _id: req.params.id\n      }\n    })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\n//常用函数\nexport function getAttribute(req, res) {\n  var attrData = req.body;\n  Attribute.find({\n      include: [{all: true}],\n      where: attrData\n    })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function addAttribute(req, res) {\n  var attrData = req.body;\n  Attribute.addAttribute(attrData)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\nexport function addAttributes(req, res) {\n  var attrData = req.body;\n  Attribute.addAttributes(attrData)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\nexport function getAttributes(req, res) {\n}\n\n"
  },
  {
    "__docId__": 63,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 64,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 65,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 66,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 44,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 67,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 68,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 69,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 70,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 71,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 88,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 72,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 104,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 73,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getAttribute",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~getAttribute",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{getAttribute}",
    "description": null,
    "lineNumber": 116,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 74,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addAttribute",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~addAttribute",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{addAttribute}",
    "description": null,
    "lineNumber": 127,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 75,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addAttributes",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~addAttributes",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{addAttributes}",
    "description": null,
    "lineNumber": 134,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 76,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getAttributes",
    "memberof": "api/attribute/attribute.controller.js",
    "longname": "api/attribute/attribute.controller.js~getAttributes",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.controller.js",
    "importStyle": "{getAttributes}",
    "description": null,
    "lineNumber": 141,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 77,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/attribute/attribute.events.js",
    "memberof": null,
    "longname": "api/attribute/attribute.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Attribute model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Attribute = require('../../sqldb').Attribute;\nvar AttributeEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAttributeEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Attribute.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AttributeEvents.emit(event + ':' + doc._id, doc);\n    AttributeEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AttributeEvents;\n"
  },
  {
    "__docId__": 78,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Attribute",
    "memberof": "api/attribute/attribute.events.js",
    "longname": "api/attribute/attribute.events.js~Attribute",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 79,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/attribute/attribute.events.js",
    "longname": "api/attribute/attribute.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 80,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/attribute/attribute.events.js",
    "longname": "api/attribute/attribute.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 81,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/attribute/attribute.integration.js",
    "memberof": null,
    "longname": "api/attribute/attribute.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newAttribute;\n\ndescribe('Attribute API:', function() {\n\n  describe('GET /api/attributes', function() {\n    var attributes;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/attributes')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          attributes = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      attributes.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/attributes', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/attributes')\n        .send({\n          name: 'New Attribute',\n          info: 'This is the brand new attribute!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newAttribute = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created attribute', function() {\n      newAttribute.name.should.equal('New Attribute');\n      newAttribute.info.should.equal('This is the brand new attribute!!!');\n    });\n\n  });\n\n  describe('GET /api/attributes/:id', function() {\n    var attribute;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/attributes/' + newAttribute._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          attribute = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      attribute = {};\n    });\n\n    it('should respond with the requested attribute', function() {\n      attribute.name.should.equal('New Attribute');\n      attribute.info.should.equal('This is the brand new attribute!!!');\n    });\n\n  });\n\n  describe('PUT /api/attributes/:id', function() {\n    var updatedAttribute;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/attributes/' + newAttribute._id)\n        .send({\n          name: 'Updated Attribute',\n          info: 'This is the updated attribute!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedAttribute = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedAttribute = {};\n    });\n\n    it('should respond with the updated attribute', function() {\n      updatedAttribute.name.should.equal('Updated Attribute');\n      updatedAttribute.info.should.equal('This is the updated attribute!!!');\n    });\n\n  });\n\n  describe('DELETE /api/attributes/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/attributes/' + newAttribute._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when attribute does not exist', function(done) {\n      request(app)\n        .delete('/api/attributes/' + newAttribute._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 82,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/attribute/attribute.integration.js",
    "longname": "api/attribute/attribute.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 83,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/attribute/attribute.model.js",
    "memberof": null,
    "longname": "api/attribute/attribute.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\nimport TreeTable from '../../sqldb/treeTable';\n\nexport default function (sequelize, DataTypes) {\n  return sequelize.define('Attribute', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    parentId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    spaceId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    appId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    name: DataTypes.STRING,\n    alias: DataTypes.STRING,\n    value: DataTypes.STRING,\n    fullname: DataTypes.STRING,\n    owner: DataTypes.STRING,\n    ownerId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    active: DataTypes.BOOLEAN\n  }, {\n    getterMethods: {\n      // attributeName: function () {\n      //   var fname = this.fullname;\n      //   //console.log('fname:', fname);\n      //   var fname2 = fname.slice(fname.indexOf('.') + 1);\n      //   //console.log('fname2:', fname2);\n      //   return fname2.slice(fname2.indexOf('.') + 1);\n      // },\n      attributeName: function () {\n        var fname = this.fullname;\n        var fname2 = fname.slice(fname.indexOf('.') + 1);\n        return fname2.slice(fname2.indexOf('.') + 1);\n      },\n      name: function () {\n        var fname = this.fullname;\n        var fname2 = fname.slice(fname.indexOf('.') + 1);\n        return fname2.slice(fname2.indexOf('.') + 1);\n      }\n    },\n    classMethods: {\n      getRoot: function () {\n        return this\n          .findOrCreate({\n            where: {\n              name: 'root',\n              fullname: 'root'\n            },\n            defaults: {\n              alias: 'root'\n            }\n          })\n          .spread(function (entity, created) {\n            return Promise.resolve(entity);\n          });\n      },\n      getAttributeRoot: function (attributeData) {\n\n        //console.log('in getAttributeRoot attributeData:', attributeData);\n\n        var Model = this;\n        //var attributeData = attrData;\n\n        return this.getRoot().then(function (root) {\n          var whereData = {};\n\n          if (typeof attributeData === 'object') {\n            for (var key in attributeData) {\n              if (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownerattribute') {\n                whereData.owner = attributeData[key];\n                //delete attributeData[key];\n              }\n              if (key.toLowerCase() === 'ownerid') {\n                whereData.ownerId = attributeData[key];\n                //delete attributeData[key];\n              }\n              if (key.toLowerCase() === 'spaceid') {\n                whereData.spaceId = attributeData[key];\n                //delete attributeData[key];\n              }\n              if (key.toLowerCase() === 'appid') {\n                whereData.appId = attributeData[key];\n                //delete attributeData[key];\n              }\n            }\n          }\n\n          whereData.name = 'attributeRoot';\n          whereData.fullname = 'root.attributeRoot';\n          whereData.parentId = 1;\n\n          //console.log('getAttributeRoot root: ', JSON.stringify(root));\n\n          //console.log('getAttributeRoot whereData: ', JSON.stringify(whereData));\n\n          return Model.findOrCreate({\n              where: whereData,\n              defaults: {\n                alias: 'attributeRoot'\n              }\n            })\n            .spread(function (entity, created) {\n              //console.log('getAttributeRoot created: ', created);\n              return Promise.resolve(entity);\n            });\n        });\n      },\n      addAttribute: function (attributeData) {\n\n        var attributeName;\n        var owner;\n        var ownerId;\n        var spaceId;\n        var appId;\n\n        //console.log('attributeData:',attributeData);\n\n        if (typeof attributeData === 'string') {\n          attributeName = attributeData;\n          attributeData = {};\n          attributeData.name = attributeName;\n        }\n\n        if (typeof attributeData === 'object') {\n          //console.log('attributeData 2: ', attributeData);\n          for (var key in attributeData) {\n            if (key.toLowerCase() === 'name' || key.toLowerCase() === 'attributename') {\n              attributeName = attributeData[key];\n              delete attributeData[key];\n            }\n            if (key.toLowerCase() === 'owner') {\n              owner = attributeData[key];\n              delete attributeData[key];\n            }\n            if (key.toLowerCase() === 'ownerid') {\n              ownerId = attributeData[key];\n              delete attributeData[key];\n            }\n            if (key.toLowerCase() === 'spaceid') {\n              spaceId = attributeData[key];\n              delete attributeData[key];\n            }\n            if (key.toLowerCase() === 'appid') {\n              appId = attributeData[key];\n              delete attributeData[key];\n            }\n          }\n        }\n        //console.log('attributeName:',attributeName);\n\n        var attributeContext = {};\n\n        if (owner) {\n          attributeContext.owner = owner;\n        }\n        if (ownerId && ownerId !== -1) {\n          attributeContext.ownerId = ownerId;\n        }\n        if (spaceId && spaceId !== -1) {\n          attributeContext.spaceId = spaceId;\n        }\n        if (appId && appId !== -1) {\n          attributeContext.appId = appId;\n        }\n\n        if (attributeName) {\n          var names = attributeName.split('.');\n          //console.log('names:', names);\n          //console.log('attributeData:',attributeData);\n          //console.log('attributeContext:',attributeContext);\n\n          var Model = this;\n\n          return this.getAttributeRoot(attributeContext)\n            .then(function (attributeRoot) {\n              //console.log('attributeRoot:',attributeRoot);\n              var parentId = attributeRoot._id;\n              var fullname = attributeRoot.fullname;\n              var finalAttribute;\n              var i = 0;\n              return Promise.reduce(names, function (finalAttribute, tName) {\n                  //attributeData.alias = attributeData.alias || tName;\n                  attributeContext.name = tName;\n                  attributeContext.fullname = fullname + '.' + tName;\n                  attributeContext.parentId = parentId;\n                  //console.log('name: ',tName);\n                  //console.log('fullName: ',fullname);\n                  //console.log('parentId: ',parentId);\n                  //console.log('attributeContext',JSON.stringify(attributeContext));\n                  var defaults = {};\n                  if(i++ === names.length - 1){\n                    attributeData.alias = attributeData.alias || attributeName;\n                    defaults = attributeData\n                  }               \n                  return Model.findOrCreate({\n                      where: attributeContext,\n                      defaults: defaults\n                    })\n                    .spread(function (theAttribute, created) {\n                      parentId = theAttribute._id;\n                      fullname = theAttribute.fullname;\n                      return finalAttribute = theAttribute;\n                      //console.log('finalAttribute:', finalAttribute);\n                      //Promise.resolve(finalAttribute);\n                    });\n                }, 0)\n                .then(function (finalAttribute) {\n                  //console.log('promise.map finalAttribute: ',finalAttribute);\n                  return Promise.resolve(finalAttribute);\n                });\n            });\n        }\n\n        return Promise.reject(new Error('fail to add attribute!'));\n      },\n      getAttribute: function (attributeData) {\n\n        if(!isNaN(attributeData) && attributeData > 0){\n          return this.findById(attributeData);\n        }\n        //console.log('getAttribute attributeContext:', JSON.stringify(attributeContext));\n        return this.getAttributeRoot(attributeData).then(function (attrRoot) {\n          //console.log('getAttributes attrRoot:', JSON.stringify(attrRoot));\n          return attrRoot.getChild(attributeData);\n        });\n      },\n      getAttributes: function (attributeContext) {\n        //console.log('getAttribute attributeContext:', JSON.stringify(attributeContext));\n        return this.getAttributeRoot(attributeContext).then(function (attrRoot) {\n          //console.log('getAttributes attrRoot:', JSON.stringify(attrRoot));\n          return attrRoot.getChildren({mode: 'leaf'});\n        });\n      },\n      //name format: a1.b1.c1\n      addAttributes: function (attributesData) {\n        var newAttrs = [];\n        Promise.each(attributesData, function (attributeData) {\n          this.addAttribute(attributeData).then(function (attr) {\n            newAttrs.push(attr);\n          })\n        });\n        return Promise.resolve(newAttrs);\n      },\n\n      toObject: function(attributes){\n\n        //console.log('toObject attibutes:',JSON.stringify(attribute));\n\n        var theObjec = {};\n\n        attributes.forEach(function(attribute){\n          var name = attribute.name;\n          var value = attribute.value;\n\n          var names = name.split('.');\n\n          //console.log('toObject attribute:',JSON.stringify(attribute));\n\n          //console.log('toObject names:',JSON.stringify(names));\n\n          var parent = theObjec;\n          //console.log(' toObject parent: ', JSON.stringify(parent));\n          var i = 0;\n          names.forEach(function(k){\n            i++;\n            if(i == names.length){\n              parent[k] = attribute.value;\n            } else {\n              /*\n              parent = parent[k];\n              if( typeof parent !== 'object') {\n                parent = {};\n              } */\n              ///*\n              if (!parent[k] || typeof parent[k] !== 'object'){\n                parent = parent[k] = {};\n              } else {\n                parent = parent[k];\n              }   //*/     \n            }          \n            //console.log(i + ' toObject theObjec: ', JSON.stringify(theObjec));\n          });\n          //parent = attr.value;\n        });\n\n        return theObjec;\n      }\n    },\n    instanceMethods: {\n      addChild: function (childData) {\n        var treeObj = new TreeTable();\n        return treeObj.addChild(this, childData);\n      },\n      getChildren: function (childData) {\n        //console.log('getChildren:', JSON.stringify(childData));\n        var treeObj = new TreeTable();\n        return treeObj.getChildren(this, childData);\n      },\n      getChild: function (childData) {\n        var treeObj = new TreeTable();\n        return treeObj.getChild(this, childData);\n      },\n      getParent: function (recursive) {\n        var treeObj = new TreeTable();\n        return treeObj.getParent(this, recursive);\n      },\n      childCount: function () {\n        var treeObj = new TreeTable();\n        return treeObj.childCount(this);\n      },\n      isParentOf: function (childObj, recursive) {\n        var treeObj = new TreeTable();\n        return treeObj.isParentOf(childObj, this, recursive);\n      },\n      isChildOf: function (parentObj, recursive) {\n        var treeObj = new TreeTable();\n        return treeObj.isChildOf(parentObj, this, childData);\n      }\n    }\n  });\n}\n"
  },
  {
    "__docId__": 84,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/attribute/attribute.model.js",
    "longname": "api/attribute/attribute.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 85,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "attribute",
    "memberof": "api/attribute/attribute.model.js",
    "longname": "api/attribute/attribute.model.js~attribute",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.model.js",
    "importStyle": "attribute",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 86,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/attribute/attribute.socket.js",
    "memberof": null,
    "longname": "api/attribute/attribute.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AttributeEvents = require('./attribute.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('attribute:' + event, socket);\n\n    AttributeEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AttributeEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 87,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AttributeEvents",
    "memberof": "api/attribute/attribute.socket.js",
    "longname": "api/attribute/attribute.socket.js~AttributeEvents",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 88,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/attribute/attribute.socket.js",
    "longname": "api/attribute/attribute.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 89,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/attribute/attribute.socket.js",
    "longname": "api/attribute/attribute.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/attribute/attribute.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 90,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/attribute/attribute.socket.js",
    "longname": "api/attribute/attribute.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 91,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/attribute/attribute.socket.js",
    "longname": "api/attribute/attribute.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/attribute.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 92,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/attribute/index.js",
    "memberof": null,
    "longname": "api/attribute/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./attribute.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nrouter.post('/addAttribute/', controller.addAttribute);\nrouter.post('/addAttributes/', controller.addAttributes);\n\nrouter.post('/getAttribute/', controller.getAttribute);\n//router.post('/getAttributes/', controller.getAttributes);\n\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 93,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/attribute/index.js",
    "longname": "api/attribute/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 94,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/attribute/index.js",
    "longname": "api/attribute/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 95,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/attribute/index.js",
    "longname": "api/attribute/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 96,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/attribute/index.spec.js",
    "memberof": null,
    "longname": "api/attribute/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar attributeCtrlStub = {\n  index: 'attributeCtrl.index',\n  show: 'attributeCtrl.show',\n  create: 'attributeCtrl.create',\n  update: 'attributeCtrl.update',\n  destroy: 'attributeCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar attributeIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './attribute.controller': attributeCtrlStub\n});\n\ndescribe('Attribute API Router:', function() {\n\n  it('should return an express router instance', function() {\n    attributeIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/attributes', function() {\n\n    it('should route to attribute.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'attributeCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/attributes/:id', function() {\n\n    it('should route to attribute.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'attributeCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/attributes', function() {\n\n    it('should route to attribute.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'attributeCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/attributes/:id', function() {\n\n    it('should route to attribute.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'attributeCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/attributes/:id', function() {\n\n    it('should route to attribute.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'attributeCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/attributes/:id', function() {\n\n    it('should route to attribute.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'attributeCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 97,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/attribute/index.spec.js",
    "longname": "api/attribute/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 98,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "attributeCtrlStub",
    "memberof": "api/attribute/index.spec.js",
    "longname": "api/attribute/index.spec.js~attributeCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 99,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/attribute/index.spec.js",
    "longname": "api/attribute/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 100,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "attributeIndex",
    "memberof": "api/attribute/index.spec.js",
    "longname": "api/attribute/index.spec.js~attributeIndex",
    "access": null,
    "export": false,
    "importPath": "./api/attribute/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 101,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/category/category.controller.js",
    "memberof": null,
    "longname": "api/category/category.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/categorys              ->  index\n * POST    /api/categorys              ->  create\n * GET     /api/categorys/:id          ->  show\n * PUT     /api/categorys/:id          ->  update\n * DELETE  /api/categorys/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Category} from '../../sqldb';\nimport {Thing} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Categorys\nexport function index(req, res) {\n\t//console.log('Category:',Category);\n  Category.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Category from the DB\nexport function show(req, res) {\n  Category.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Category in the DB\nexport function create(req, res) {\n\t//console.log('category create 1');\n  Category.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Category in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Category.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Category from the DB\nexport function destroy(req, res) {\n  Category.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function getChildren(req, res){\n\t//console.log('req params:',req);\n\tCategory.find({\n\t\t_id: req.params.id\n\t})\n\t.then(function(category){\n\t\t//console.log('category:',category);\n\t\tcategory.getChildren(req.query).then(\n\t\t\tfunction(results){\n\t\t\t\t//console.log('results:',results);\n\t\t\t\tres.status(200).json(results);\n\t\t\t}\n\t\t)\n\t})\n\t.catch(handleError(res));\n}\n\nexport function test(req, res){\n\t\n\t//console.log('req.body=',req.body);\n\t/*\n  \tThing.create({name: 'root2',info: 'root2 info'})\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n\t*/\n\t\n\tCategory.getTypeRoot(req.body)\n\t.then(function(typeRoot){\n\t\t//res.status(200).json(typeRoot);\n\t\ttypeRoot.getChild(req.body,true).then(function(child){\n\t\t\tres.status(200).json(child);\n\t\t\t//var isParentOf = typeRoot.isParentOf(child);\n\t\t\t//console.log('isParentOf: ', isParentOf);\n\t\t\t//res.status(200).send(isParentOf);\n\t\t\t//child.getParent().then(function(parent){\n\t\t\t\t//res.status(200).json(parent);\n\t\t\t\t//});\n\t\t});\n\t})\n\t.catch(handleError(res));\n\t\n\t/*\n\tCategory.findOrCreate({\n\t\twhere: {\n\t\t\tname: 'root',\n\t\t\tfullname: 'root'\n\t\t},\n\t\tdefaults: {\n\t\t\talias: 'root'\n\t\t}\n\t})\n\t.spread(function(entity,created){\n\t\tres.status(200).json(entity);\n\t})\n\t.catch(handleError(res));\n\t*/\n\t\n\t/*\n\tThing.create({name: 'root1', info: 'root1 info'})\n\t.then(function(result){\n\t\treturn Category.findOrCreate({\n\t\t\twhere: {name: 'root'}\n\t\t})\n\t\t.then(function(entity){\n\t\t\tif(entity){\n\t\t\t\tres.status(200).json(entity);\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn Category.create({\n\t\t\t\t\tname: 'newRoot',\n\t\t\t\t\tinfo: 'newRoot info'\n\t\t\t\t})\n\t\t\t\t.then(function(entity2){\n\t\t\t\t\tres.status(200).json(entity2);\n\t\t\t\t});\n\t\t\t}\t\t\n\t\t});\n\t})\n\t.catch(handleError(res));\n\t*/\n\t\n\t/*\n\tconsole.log('req.body=',req.body);\n\tCategory.build().addType(req.body).then(function(type){\n\t\tres.status(200).json(type);\n\t})\n\t.catch(handleError(res));\n\t*/\n}\n"
  },
  {
    "__docId__": 102,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 16,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 103,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 25,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 104,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 34,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 105,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 45,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 106,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 55,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 107,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 63,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 108,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 71,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 109,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 83,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 110,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 91,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 111,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 107,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 112,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getChildren",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~getChildren",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.controller.js",
    "importStyle": "{getChildren}",
    "description": null,
    "lineNumber": 118,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 113,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "test",
    "memberof": "api/category/category.controller.js",
    "longname": "api/category/category.controller.js~test",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.controller.js",
    "importStyle": "{test}",
    "description": null,
    "lineNumber": 135,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 114,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/category/category.events.js",
    "memberof": null,
    "longname": "api/category/category.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Category model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Category = require('../../sqldb').Category;\nvar CategoryEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nCategoryEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Category.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    CategoryEvents.emit(event + ':' + doc._id, doc);\n    CategoryEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default CategoryEvents;\n"
  },
  {
    "__docId__": 115,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Category",
    "memberof": "api/category/category.events.js",
    "longname": "api/category/category.events.js~Category",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 116,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/category/category.events.js",
    "longname": "api/category/category.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 117,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/category/category.events.js",
    "longname": "api/category/category.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 118,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/category/category.integration.js",
    "memberof": null,
    "longname": "api/category/category.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newCategory;\n\ndescribe('Category API:', function() {\n\n  describe('GET /api/categorys', function() {\n    var categorys;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/categorys')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          categorys = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      categorys.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/categorys', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/categorys')\n        .send({\n          name: 'New Category',\n          info: 'This is the brand new category!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newCategory = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created category', function() {\n      newCategory.name.should.equal('New Category');\n      newCategory.info.should.equal('This is the brand new category!!!');\n    });\n\n  });\n\n  describe('GET /api/categorys/:id', function() {\n    var category;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/categorys/' + newCategory._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          category = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      category = {};\n    });\n\n    it('should respond with the requested category', function() {\n      category.name.should.equal('New Category');\n      category.info.should.equal('This is the brand new category!!!');\n    });\n\n  });\n\n  describe('PUT /api/categorys/:id', function() {\n    var updatedCategory;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/categorys/' + newCategory._id)\n        .send({\n          name: 'Updated Category',\n          info: 'This is the updated category!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedCategory = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedCategory = {};\n    });\n\n    it('should respond with the updated category', function() {\n      updatedCategory.name.should.equal('Updated Category');\n      updatedCategory.info.should.equal('This is the updated category!!!');\n    });\n\n  });\n\n  describe('DELETE /api/categorys/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/categorys/' + newCategory._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when category does not exist', function(done) {\n      request(app)\n        .delete('/api/categorys/' + newCategory._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 119,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/category/category.integration.js",
    "longname": "api/category/category.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 120,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/category/category.model.js",
    "memberof": null,
    "longname": "api/category/category.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\nimport TreeTable from '../../sqldb/treeTable';\n\nexport default function(sequelize, DataTypes) {\n\treturn sequelize.define('Category', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tparentId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tappId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tname: DataTypes.STRING,\n\t\talias: DataTypes.STRING,\n\t\tfullname: DataTypes.STRING,\n\t\towner: DataTypes.STRING,\n\t\townerId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t}, {\n\t\tgetterMethods: {\n\t\t\ttypeName: function() {\n\t\t\t\tvar fname = this.fullname;\n\t\t\t\t//console.log('fname:', fname);\n\t\t\t\tvar fname2 = fname.slice(fname.indexOf('.') + 1);\n\t\t\t\t//console.log('fname2:', fname2);\n\t\t\t\treturn fname2.slice(fname2.indexOf('.') + 1);\n\t\t\t},\n\t\t\tcategoryName: function() {\n\t\t\t\tvar fname = this.fullname;\n\t\t\t\tvar fname2 = fname.slice(fname.indexOf('.') + 1);\n\t\t\t\treturn fname2.slice(fname2.indexOf('.') + 1);\n\t\t\t},\n\t\t\tname: function() {\n\t\t\t\tvar fname = this.fullname;\n\t\t\t\tvar fname2 = fname.slice(fname.indexOf('.') + 1);\n\t\t\t\treturn fname2.slice(fname2.indexOf('.') + 1);\n\t\t\t}\n\t\t},\n\t\tclassMethods: {\n\t\t\tgetRoot: function() {\n\t\t\t\t//console.log('in getRoot this:', this);\n\t\t\t\treturn this.findOrCreate({\n\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\tname: 'root',\n\t\t\t\t\t\t\tfullname: 'root'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\talias: 'root'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.spread(function(entity, created) {\n\t\t\t\t\t\t//console.log('getRoot spread');\n\t\t\t\t\t\treturn Promise.resolve(entity);\n\t\t\t\t\t}).catch(function(err){\n\t\t\t\t\t\t//console.log('getRoot err:',JSON.stringify(err));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\t//usually, typeData is a object which contain owner or spaceId\n\t\t\tgetTypeRoot: function(typeData) {\n\n\t\t\t\t//console.log('in getTypeRoot typeData:', typeData);\n\n\t\t\t\tvar Model = this;\n\n\t\t\t\treturn this.getRoot().then(function(root) {\n\t\t\t\t\t//console.log('getTypeRoot root:',JSON.stringify(root));\n\t\t\t\t\tvar whereData = {};\n\n\t\t\t\t\tif (typeof typeData === 'object') {\n\t\t\t\t\t\tfor (var key in typeData) {\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n\t\t\t\t\t\t\t\twhereData.owner = typeData[key];\n\t\t\t\t\t\t\t\t//delete typeData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'appid' || key.toLowerCase() === 'spaceid' || key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\t\twhereData.owner = typeData[key];\n\t\t\t\t\t\t\t\t//delete typeData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twhereData.name = 'typeRoot';\n\t\t\t\t\twhereData.fullname = 'root.typeRoot';\n\t\t\t\t\twhereData.parentId = 1;\n\n\t\t\t\t\t//console.log('getTypeRoot root: ', JSON.stringify(root));\n\n\t\t\t\t\t//console.log('getTypeRoot whereData: ', JSON.stringify(whereData));\n\n\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\twhere: whereData,\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\talias: 'typeRoot'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\t.spread(function(entity, created) {\n\t\t\t\t\t\t\t//console.log('getTypeRoot created: ', created);\n\t\t\t\t\t\t\treturn Promise.resolve(entity);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t},\n\t\t\tgetCategoryRoot: function(categoryData) {\n\n\t\t\t\tvar Model = this;\n\n\t\t\t\treturn this.getRoot().then(function(root) {\n\t\t\t\t\tvar whereData = {};\n\n\t\t\t\t\tif (typeof categoryData === 'object') {\n\t\t\t\t\t\tfor (var key in categoryData) {\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n\t\t\t\t\t\t\t\twhereData.owner = categoryData[key];\n\t\t\t\t\t\t\t\t//delete categoryData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (key.toLowerCase() === 'appid' || key.toLowerCase() === 'spaceid' || key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\t\twhereData.owner = categoryData[key];\n\t\t\t\t\t\t\t\t//delete categoryData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twhereData.name = 'categoryRoot';\n\t\t\t\t\twhereData.fullname = 'root.categoryRoot';\n\t\t\t\t\twhereData.parentId = 1;\n\n\t\t\t\t\tconsole.log('getCategoryRoot root: ', JSON.stringify(root));\n\n\t\t\t\t\tconsole.log('getCategoryRoot whereData: ', JSON.stringify(whereData));\n\n\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\twhere: whereData,\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\talias: 'categoryRoot'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\t.spread(function(entity, created) {\n\t\t\t\t\t\t\tconsole.log('getCategoryRoot created: ', created);\n\t\t\t\t\t\t\treturn Promise.resolve(entity);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\taddType: function(typeData) {\n\n\t\t\t\tvar typeName;\n\t\t\t\tvar owner;\n\t\t\t\tvar ownerId;\n\t\t\t\tvar spaceId;\n\t\t\t\tvar appId;\n\n\t\t\t\t//console.log('typeData:',typeData);\n\n\t\t\t\tif (typeof typeData === 'string') {\n\t\t\t\t\ttypeName = typeData;\n\t\t\t\t\ttypeData = {};\n\t\t\t\t\ttypeData.name = typeName;\n\t\t\t\t}\n\n\t\t\t\tif (typeof typeData === 'object') {\n\t\t\t\t\t//console.log('typeData 2: ', typeData);\n\t\t\t\t\tfor (var key in typeData) {\n\t\t\t\t\t\tif (key.toLowerCase() === 'name' || key.toLowerCase() === 'typename') {\n\t\t\t\t\t\t\ttypeName = typeData[key];\n\t\t\t\t\t\t\tdelete typeData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'owner') {\n\t\t\t\t\t\t\towner = typeData[key];\n\t\t\t\t\t\t\tdelete typeData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\townerId = typeData[key];\n\t\t\t\t\t\t\tdelete typeData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'spaceid') {\n\t\t\t\t\t\t\tspaceId = typeData[key];\n\t\t\t\t\t\t\tdelete typeData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'appid') {\n\t\t\t\t\t\t\tappId = typeData[key];\n\t\t\t\t\t\t\tdelete typeData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//console.log('typeName:',typeName);\n\n\t\t\t\tvar typeContext = {};\n\n\t\t\t\tif (owner) {\n\t\t\t\t\ttypeContext.owner = owner;\n\t\t\t\t}\n\t\t\t\tif (ownerId && ownerId !== -1) {\n\t\t\t\t\ttypeContext.ownerId = ownerId;\n\t\t\t\t}\n\t\t\t\tif (spaceId && spaceId !== -1) {\n\t\t\t\t\ttypeContext.spaceId = spaceId;\n\t\t\t\t}\n\t\t\t\tif (appId && appId !== -1) {\n\t\t\t\t\ttypeContext.appId = appId;\n\t\t\t\t}\n\n\t\t\t\tif (typeName) {\n\t\t\t\t\tvar names = typeName.split('.');\n\t\t\t\t\t//console.log('names:', names);\n\t\t\t\t\t//console.log('typeData:',typeData);\n\t\t\t\t\t//console.log('typeContext:',typeContext);\n\n\t\t\t\t\tvar Model = this;\n\n\t\t\t\t\treturn this.getTypeRoot(typeContext)\n\t\t\t\t\t\t.then(function(typeRoot) {\n\t\t\t\t\t\t\t//console.log('typeRoot:',typeRoot);\n\t\t\t\t\t\t\tvar parentId = typeRoot._id;\n\t\t\t\t\t\t\tvar fullname = typeRoot.fullname;\n\t\t\t\t\t\t\tvar finalType;\n\t\t\t\t\t\t\tvar i = 0;\n\t\t\t\t\t\t\treturn Promise.reduce(names, function(finalType, tName) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\ttypeContext.name = tName;\n\t\t\t\t\t\t\t\ttypeContext.fullname = fullname + '.' + tName;\n\t\t\t\t\t\t\t\ttypeContext.parentId = parentId;\n\t\t\t\t\t\t\t\t//console.log('name: ',tName);\n\t\t\t\t\t\t\t\t//console.log('fullName: ',fullname);\n\t\t\t\t\t\t\t\t//console.log('parentId: ',parentId);\n\t\t\t\t\t\t\t\t//console.log('typeContext',JSON.stringify(typeContext));\n\t\t\t\t\t\t\t\tvar defaults = {};\n\t\t\t\t\t\t\t\tif(i++ === names.length - 1){\n\t\t\t\t\t\t\t\t\ttypeData.alias = typeData.alias || typeName;\n\t\t\t\t\t\t\t\t\tdefaults = typeData;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\t\t\t\twhere: typeContext,\n\t\t\t\t\t\t\t\t\tdefaults: defaults\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.spread(function(theType, created) {\n\t\t\t\t\t\t\t\t\t\tparentId = theType._id;\n\t\t\t\t\t\t\t\t\t\tfullname = theType.fullname;\n\t\t\t\t\t\t\t\t\t\treturn finalType = theType;\n\t\t\t\t\t\t\t\t\t\t//console.log('finalType:', finalType);\n\t\t\t\t\t\t\t\t\t\t//Promise.resolve(finalType);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 0)\n\t\t\t\t\t\t\t\t.then(function(finalType) {\n\t\t\t\t\t\t\t\t\t//console.log('promise.map finalType: ',finalType);\n\t\t\t\t\t\t\t\t\treturn Promise.resolve(finalType);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(new Error('fail to add type!'));\n\t\t\t},\n\t\t\taddCategory: function(categoryData) {\n\n\t\t\t\tvar categoryName;\n\t\t\t\tvar owner;\n\t\t\t\tvar ownerId;\n\t\t\t\tvar spaceId;\n\t\t\t\tvar appId;\n\n\t\t\t\t//console.log('categoryData:',categoryData);\n\n\t\t\t\tif (typeof categoryData === 'string') {\n\t\t\t\t\tcategoryName = categoryData;\n\t\t\t\t\tcategoryData = {};\n\t\t\t\t\tcategoryData.name = categoryName;\n\t\t\t\t}\n\n\t\t\t\tif (typeof categoryData === 'object') {\n\t\t\t\t\t//console.log('categoryData 2: ', categoryData);\n\t\t\t\t\tfor (var key in categoryData) {\n\t\t\t\t\t\tif (key.toLowerCase() === 'name' || key.toLowerCase() === 'categoryname') {\n\t\t\t\t\t\t\tcategoryName = categoryData[key];\n\t\t\t\t\t\t\tdelete categoryData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'owner') {\n\t\t\t\t\t\t\towner = categoryData[key];\n\t\t\t\t\t\t\tdelete categoryData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\townerId = categoryData[key];\n\t\t\t\t\t\t\tdelete categoryData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'spaceid') {\n\t\t\t\t\t\t\tspaceId = categoryData[key];\n\t\t\t\t\t\t\tdelete categoryData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (key.toLowerCase() === 'appid') {\n\t\t\t\t\t\t\tappId = categoryData[key];\n\t\t\t\t\t\t\tdelete categoryData[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//console.log('categoryName:',categoryName);\n\n\t\t\t\tvar categoryContext = {};\n\n\t\t\t\tif (owner) {\n\t\t\t\t\tcategoryContext.owner = owner;\n\t\t\t\t}\n\t\t\t\tif (ownerId && ownerId !== -1) {\n\t\t\t\t\tcategoryContext.ownerId = ownerId;\n\t\t\t\t}\n\t\t\t\tif (spaceId && spaceId !== -1) {\n\t\t\t\t\tcategoryContext.spaceId = spaceId;\n\t\t\t\t}\n\t\t\t\tif (appId && appId !== -1) {\n\t\t\t\t\tcategoryContext.appId = appId;\n\t\t\t\t}\n\n\t\t\t\tif (categoryName) {\n\t\t\t\t\tvar names = categoryName.split('.');\n\t\t\t\t\t//console.log('names:', names);\n\t\t\t\t\t//console.log('categoryData:',categoryData);\n\t\t\t\t\t//console.log('categoryContext:',categoryContext);\n\n\t\t\t\t\tvar Model = this;\n\n\t\t\t\t\treturn this.getCategoryRoot(categoryContext)\n\t\t\t\t\t\t.then(function(categoryRoot) {\n\t\t\t\t\t\t\t//console.log('categoryRoot:',categoryRoot);\n\t\t\t\t\t\t\tvar parentId = categoryRoot._id;\n\t\t\t\t\t\t\tvar fullname = categoryRoot.fullname;\n\t\t\t\t\t\t\tvar finalCategory;\n\t\t\t\t\t\t\treturn Promise.reduce(names, function(finalCategory, tName) {\n\t\t\t\t\t\t\t\tcategoryData.alias = categoryData.alias || tName;\n\t\t\t\t\t\t\t\tcategoryContext.name = tName;\n\t\t\t\t\t\t\t\tcategoryContext.fullname = fullname + '.' + tName;\n\t\t\t\t\t\t\t\tcategoryContext.parentId = parentId;\n\t\t\t\t\t\t\t\t//console.log('name: ',tName);\n\t\t\t\t\t\t\t\t//console.log('fullName: ',fullname);\n\t\t\t\t\t\t\t\t//console.log('parentId: ',parentId);\n\t\t\t\t\t\t\t\t//console.log('categoryContext',JSON.stringify(categoryContext));\n\t\t\t\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\t\t\t\twhere: categoryContext,\n\t\t\t\t\t\t\t\t\tdefaults: categoryData\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.spread(function(theCategory, created) {\n\t\t\t\t\t\t\t\t\t\tparentId = theCategory._id;\n\t\t\t\t\t\t\t\t\t\tfullname = theCategory.fullname;\n\t\t\t\t\t\t\t\t\t\treturn finalCategory = theCategory;\n\t\t\t\t\t\t\t\t\t\t//console.log('finalCategory:', finalCategory);\n\t\t\t\t\t\t\t\t\t\t//Promise.resolve(finalCategory);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 0)\n\t\t\t\t\t\t\t\t.then(function(finalCategory) {\n\t\t\t\t\t\t\t\t\t//console.log('promise.map finalCategory: ',finalCategory);\n\t\t\t\t\t\t\t\t\treturn Promise.resolve(finalCategory);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(new Error('fail to add category!'));\n\t\t\t},\n\t\t\tgetType: function(typeData, autoCreated) {\n\t\t\t\t//console.log('in Category typeData:', JSON.stringify(typeData));\n\t\t\t\tif (typeData && !isNaN(typeData) && typeData > 0) {\n\t\t\t\t\treturn this.findById(typeData);\n\t\t\t\t}\n\t\t\t\t//console.log('Category.getType 2');\n\n\t\t\t\tif (typeof typeData === 'object') {\n\t\t\t\t\treturn this.getTypeRoot(typeData).then(function(typeRoot) {\n\t\t\t\t\t\t//console.log('Category getType typeRoot:',JSON.stringify(typeRoot));\n\t\t\t\t\t\treturn typeRoot.getChild(typeData, autoCreated);\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t//otherwise, return a promise reject\n\t\t\t\treturn Promise.reject(new Error('fail to getType, maybe input wrong typeData'));\n\t\t\t}\n\t\t},\n\t\tinstanceMethods: {\n\t\t\taddChild: function(childData) {\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.addChild(this, childData);\n\t\t\t},\n\t\t\tgetChildren: function(childData) {\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.getChildren(this, childData);\n\t\t\t},\n\t\t\tgetChild: function(childData, autoCreated) {\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\tif (autoCreated === true) {\n\t\t\t\t\tvar parentObj = this;\n\t\t\t\t\treturn treeObj.getChild(this, childData).then(function(child){\n\t\t\t\t\t\t//console.log('Category getChild child:',JSON.stringify(child));\n\t\t\t\t\t\tif(child === 'undefined' || child == null || _.isEmpty(child)){\n\t\t\t\t\t\t\t//console.log('Category getChild this 2:',this);\n\t\t\t\t\t\t\treturn treeObj.addChild(parentObj, childData)\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\treturn child;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn treeObj.getChild(this, childData);\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tgetParent: function(recursive) {\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.getParent(this, recursive);\n\t\t\t},\n\t\t\tchildCount: function() {\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.childCount(this);\n\t\t\t},\n\t\t\tisParentOf: function(childObj, recursive) {\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.isParentOf(childObj, this, recursive);\n\t\t\t},\n\t\t\tisChildOf: function(parentObj, recursive) {\n\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\treturn treeObj.isChildOf(parentObj, this, childData);\n\t\t\t}\n\t\t}\n\t});\n}\n"
  },
  {
    "__docId__": 121,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/category/category.model.js",
    "longname": "api/category/category.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/category/category.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 122,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "category",
    "memberof": "api/category/category.model.js",
    "longname": "api/category/category.model.js~category",
    "access": null,
    "export": true,
    "importPath": "./api/category/category.model.js",
    "importStyle": "category",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 123,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/category/index.js",
    "memberof": null,
    "longname": "api/category/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./category.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/test', controller.test);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nrouter.get('/:id/children', controller.getChildren);\n\nrouter.get('/test',controller.test);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 124,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/category/index.js",
    "longname": "api/category/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/category/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 125,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/category/index.js",
    "longname": "api/category/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/category/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 126,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/category/index.js",
    "longname": "api/category/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/category/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 127,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/category/index.spec.js",
    "memberof": null,
    "longname": "api/category/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar categoryCtrlStub = {\n  index: 'categoryCtrl.index',\n  show: 'categoryCtrl.show',\n  create: 'categoryCtrl.create',\n  update: 'categoryCtrl.update',\n  destroy: 'categoryCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar categoryIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './category.controller': categoryCtrlStub\n});\n\ndescribe('Category API Router:', function() {\n\n  it('should return an express router instance', function() {\n    categoryIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/categorys', function() {\n\n    it('should route to category.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'categoryCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/categorys/:id', function() {\n\n    it('should route to category.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'categoryCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/categorys', function() {\n\n    it('should route to category.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'categoryCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/categorys/:id', function() {\n\n    it('should route to category.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'categoryCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/categorys/:id', function() {\n\n    it('should route to category.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'categoryCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/categorys/:id', function() {\n\n    it('should route to category.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'categoryCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 128,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/category/index.spec.js",
    "longname": "api/category/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/category/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 129,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "categoryCtrlStub",
    "memberof": "api/category/index.spec.js",
    "longname": "api/category/index.spec.js~categoryCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/category/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 130,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/category/index.spec.js",
    "longname": "api/category/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/category/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 131,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "categoryIndex",
    "memberof": "api/category/index.spec.js",
    "longname": "api/category/index.spec.js~categoryIndex",
    "access": null,
    "export": false,
    "importPath": "./api/category/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 132,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/category/type.js",
    "memberof": null,
    "longname": "api/category/type.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./category.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.post('/test', controller.test);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 133,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/category/type.js",
    "longname": "api/category/type.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/category/type.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 134,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/category/type.js",
    "longname": "api/category/type.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/category/type.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 135,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/category/type.js",
    "longname": "api/category/type.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/category/type.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 136,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/circle/circle.events.js",
    "memberof": null,
    "longname": "api/circle/circle.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 137,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/circle/circle.events.js",
    "longname": "api/circle/circle.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 138,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/circle/circle.events.js",
    "longname": "api/circle/circle.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 139,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/circle/circle.events.js",
    "longname": "api/circle/circle.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 140,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/circle/circle.integration.js",
    "memberof": null,
    "longname": "api/circle/circle.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 141,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/circle/circle.integration.js",
    "longname": "api/circle/circle.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 142,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/circle/circle.model.js",
    "memberof": null,
    "longname": "api/circle/circle.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nimport sqldb from '../../sqldb';\nimport treeTable from '../../sqldb/treeTable';\nvar Promise = require('bluebird');\n\nexport default function (sequelize, DataTypes) {\n  return sequelize.define('Circle', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING\n    },\n\t\talias: DataTypes.STRING,\n    description: DataTypes.STRING,\n\t\ttypeId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcreatorId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n    active: DataTypes.BOOLEAN\n  }, {\n\t\t\tclassMethods: {\n\t\t\t\taddType: function (typeData) {\n\t\t\t\t\tvar defaultCollabs;\n\t\t\t\t\tif (typeData.defaultCollabs) {\n\t\t\t\t\t\tdefaultCollabs = typeData.defaultCollabs;\n\t\t\t\t\t\tdelete typeData.defaultCollabs;\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log('typeData:',JSON.stringify(typeData));\n\t\t\t\t\tif (typeData.name) {\n\t\t\t\t\t\tvar tName = typeData.name;\n\t\t\t\t\t\tif (tName.indexOf('circle.') !== 0) {\n\t\t\t\t\t\t\ttypeData.name = 'circle.' + tName;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\treturn Category.addType(typeData)/*.then(function (type) {\n\t\t\t\t\t\tif (defaultCollabs) {\n\t\t\t\t\t\t\tvar Collab = sqldb.Collab;\n\t\t\t\t\t\t\treturn Collab.bulkAdd(defaultCollabs);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn Promise.resolve(type);\n\t\t\t\t\t\t}\n\t\t\t\t\t})*/\n\t\t\t\t},\n\t\t\t\tgetType: function (typeData, autoCreated) {\n\t\t\t\t\t//console.log('in app Category:', Category);\n\t\t\t\t\t//console.log('in app User:', User);\n\t\t\t\t\t//console.log('in app sqldb:', sqldb);\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\t//var Category = sqldb.Category;\n\t\t\t\t\t//console.log('in app Category:', Category);\n\t\t\t\t\tif (typeof typeData === 'string' && isNaN(typeData)) {\n\t\t\t\t\t\tvar typeName = typeData;\n\n\t\t\t\t\t\ttypeData = {};\n\n\t\t\t\t\t\ttypeData.name = typeName;\n\n\t\t\t\t\t\t//console.log('in space getType');\n\t\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\t\t//console.log('space getType typeData:', JSON.stringfy(typeData));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof typeData === 'object' && !_.isEmpty(typeData)) {\n\t\t\t\t\t\ttypeData.owner = 'circle';\n\t\t\t\t\t\tvar tyName = typeData.name;\n\t\t\t\t\t\tif (tyName.substr(0, 4).toLowerCase() !== 'circle.') {\n\t\t\t\t\t\t\ttyName = 'circle.' + tyName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttypeData.name = tyName;\n\t\t\t\t\t\t//console.log('app model typeData:', JSON.stringify(typeData));\n\t\t\t\t\t\treturn Category.getType(typeData, true);\n\t\t\t\t\t}\n\n\t\t\t\t\t//otherwise return promise reject\n\t\t\t\t\tsequelize.Promise.reject(new Error('fail to add type for circle!'));\n\t\t\t\t},\n\t\t\t},\n\t\t});\n}\n"
  },
  {
    "__docId__": 143,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/circle/circle.model.js",
    "longname": "api/circle/circle.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 144,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "circle",
    "memberof": "api/circle/circle.model.js",
    "longname": "api/circle/circle.model.js~circle",
    "access": null,
    "export": true,
    "importPath": "./api/circle/circle.model.js",
    "importStyle": "circle",
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 145,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/circle/circle.socket.js",
    "memberof": null,
    "longname": "api/circle/circle.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 146,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/circle/circle.socket.js",
    "longname": "api/circle/circle.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 147,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/circle/circle.socket.js",
    "longname": "api/circle/circle.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 148,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/circle/circle.socket.js",
    "longname": "api/circle/circle.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/circle/circle.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 149,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/circle/circle.socket.js",
    "longname": "api/circle/circle.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 150,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/circle/circle.socket.js",
    "longname": "api/circle/circle.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/circle/circle.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 151,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/circle/circleSpace.model.js",
    "memberof": null,
    "longname": "api/circle/circleSpace.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\n\nexport default function (sequelize, DataTypes) {\n  return sequelize.define('CircleSpace', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    circleId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    spaceId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    joinStatus: {\n      type: DataTypes.STRING,\n      defaultValue: 'none'\n    },\n    active: DataTypes.BOOLEAN\n  }, {\n      classMethods: {\n      },\n    });\n}\n"
  },
  {
    "__docId__": 152,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "circleSpace",
    "memberof": "api/circle/circleSpace.model.js",
    "longname": "api/circle/circleSpace.model.js~circleSpace",
    "access": null,
    "export": true,
    "importPath": "./api/circle/circleSpace.model.js",
    "importStyle": "circleSpace",
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 153,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/circle/index.js",
    "memberof": null,
    "longname": "api/circle/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./circle.controller');\n\nvar router = express.Router();\n\n//working on collabs role table\n/*\nrouter.get('/collabs', controller.findCollabs);\nrouter.get('/collabs/user', controller.findUserCollabs);\nrouter.get('/collabs/nuts/user', controller.findUserCollabNuts);\nrouter.get('/collabs/:id', controller.findCollab);\nrouter.post('/collabs/circle', controller.addCircleCollab);\nrouter.post('/collabs/role', controller.addCollabRole);\nrouter.post('/collabs', controller.addCollab);\nrouter.patch('/collabs/:id', controller.updateCollab);\nrouter.delete('/collabs/:id', controller.destroyCollab);\n*/\n\nrouter.get('/user', controller.findUserCircles);\nrouter.get('/joinable', controller.findCirclesForJoin);\nrouter.get('/joined', controller.findJoinedCircles);\nrouter.get('/spaces/manage', controller.findCircleSpacesForManage);\nrouter.get('/:id', controller.show);\nrouter.get('/', controller.index);\n//router.get('/nuts/user', controller.findUserCircleNuts);\n//router.post('/space', controller.addCircleSpace);\nrouter.post('/joinCircle', controller.joinCircle);\nrouter.post('/types', controller.addType);\nrouter.post('/addCollab', controller.addCircleCollab);\nrouter.post('/', controller.create);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 154,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/circle/index.js",
    "longname": "api/circle/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/circle/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 155,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/circle/index.js",
    "longname": "api/circle/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/circle/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 156,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/circle/index.js",
    "longname": "api/circle/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/circle/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 157,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/circle/index.spec.js",
    "memberof": null,
    "longname": "api/circle/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 158,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/circle/index.spec.js",
    "longname": "api/circle/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/circle/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 159,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/circle/index.spec.js",
    "longname": "api/circle/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/circle/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 160,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/circle/index.spec.js",
    "longname": "api/circle/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/circle/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 161,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/circle/index.spec.js",
    "longname": "api/circle/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/circle/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 162,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/circleCollab.model.js",
    "memberof": null,
    "longname": "api/collab/circleCollab.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\n\nexport default function (sequelize, DataTypes) {\n  return sequelize.define('CircleCollab', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n\t\tcircleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcollabId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcreatorId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tjoinStatus: {\n\t\t\ttype: DataTypes.STRING,\n\t\t\tdefaultValue: 'none'\n\t\t},\n    active: DataTypes.BOOLEAN\n  }, {\n\t\t\tclassMethods: {\n\t\t\t},\n\t\t});\n}\n"
  },
  {
    "__docId__": 163,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "circleCollab",
    "memberof": "api/collab/circleCollab.model.js",
    "longname": "api/collab/circleCollab.model.js~circleCollab",
    "access": null,
    "export": true,
    "importPath": "./api/collab/circleCollab.model.js",
    "importStyle": "circleCollab",
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 164,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/collab.controller.js",
    "memberof": null,
    "longname": "api/collab/collab.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Collab} from '../../sqldb';\nimport {Category} from '../../sqldb';\nimport {CollabRole} from '../../sqldb';\nimport {Role} from '../../sqldb';\nimport {Space} from '../../sqldb';\nimport {PermitRole} from '../../sqldb';\nimport {Permit} from '../../sqldb';\nimport {Nut} from '../../sqldb';\nimport {User} from '../../sqldb';\nimport {UserRole} from '../../sqldb';\nvar Promise = require('bluebird');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function (entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function (entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of collab\nexport function index(req, res) {\n\n  console.log('index req.body:',JSON.stringify(req.body));\n  var spaceId, type;\n\n  if (req.body.spaceId) {\n    spaceId = req.body.spaceId;\n  }\n\n  if (req.query.spaceId) {\n    spaceId = req.query.spaceId;\n  }\n\n  if (!spaceId) {\n    res.status(500).send('please provide spaceId!');\n  }\n\n  /*\n\n  Collab.belongsTo(Category, { as: 'type' });\n  Collab.hasMany(CollabRole, { foreignKey: 'collabId', as: 'collabRoles' });\n  //that.hasMany(CollabRole,{foreignKey: 'collabId', as:'childRoles'});\n  CollabRole.belongsTo(Role, { as: 'role' });\n\n  var findData = {\n    spaceId: spaceId\n  }\n\n  var includeData = [\n    {\n      model: Category, as: 'type'\n    },\n    {\n      model: CollabRole, as: 'collabRoles',\n      include: [\n        {\n          model: Role, as: 'role'\n        }\n      ]\n    }\n  ]\n  Collab.findAll({\n    where: findData,\n    include: includeData\n  })*/\n  Collab.getCollabRoot().then(function (collabRoot) {\n    //console.log('collab.controller collabRoot:', JSON.stringify(collabRoot));\n    return collabRoot.getChildren({\n      spaceId: spaceId,\n      mode: 'all'\n    })\n  })\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single collab from the DB\nexport function show(req, res) {\n  //console.log(JSON.stringify(req.body.params));\n  var findData = {};\n\n  Collab.belongsTo(Category, { as: 'type' });\n\n  findData.include = [\n    {\n      model: Category, as: 'type'\n    }\n  ]\n\n  if (req.params.id) {\n    findData.where = {\n      _id: req.params.id\n    }\n  }\n\n  Collab.find(findData)\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Collab in the DB\nexport function create(req, res) {\n  //console.log('Collab create req.body:', JSON.stringify(req.body));\n  var collabData = req.body;\n\n  if (!collabData.spaceId) {\n    res.status(500).send('please provide spaceId');\n  }\n\n  Collab.add(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n\n  /*\n  var type;\n  for (var key in collabData) {\n    if (key.toLowerCase() === 'type' || key.toLowerCase() === 'typename') {\n  \t\t  type = collabData[key];\n  \t\t  delete collabData[key];\n    }\n  }\n\n  if (collabData.name) {\n    var collabName = collabData.name;\n    // delete collabData.name;\n  }\n\n  if (!collabData.type && !collabData.typeId) {\n    type = 'normal';\n  }\n\n  if (type && collabName) {\n    if(typeof type === 'string'){\n      type = {\n        name: type\n      }\n    }\n    type.spaceId = collabData.spaceId;\n    //console.log('create collab typeName:', typeName);\n    Collab.addType(type).then(function (type) {\n  \t\t  collabData.typeId = type._id;\n      Collab.add(collabData)\n        .then(respondWithResult(res, 201))\n        .catch(handleError(res));\n      //     Collab.findOrCreate({\n      // where: {name: collabName},\n      // defaults:collabData})\n      //     .then(respondWithResult(res, 201))\n      //     .catch(handleError(res));\n    })\n  } else {\n    // Collab.create(collabData)\n    // .then(respondWithResult(res, 201))\n    // .catch(handleError(res));\n  }*/\n}\n\nexport function bulkCreate(req, res) {\n\n  var listData = req.body;\n\n  if (req.params.spaceId) {\n    listData.spaceId = req.params.spaceId;\n  }\n\n  //console.log('listData:',JSON.stringify(listData));\n\n  Collab.bulkAdd(listData)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Collab in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Collab.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Collab from the DB\nexport function destroy(req, res) {\n  Collab.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\n//post: /api/collabs/role\nexport function addCollabRole(req, res) {\n\n  CollabRole.add(req.body)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function bulkAddCollabRole(req, res) {\n  CollabRole.bulkAdd(req.body)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n//get: /api/collabs/role\nexport function findAllColplayRole(req, res) {\n\n  if (params.id == 'findAllJoinRoleByRoleList') {\n\n    var roleIdList = JSON.parse(req.query.roleIdList);\n\n    var orData = [];\n\n    roleIdList.forEach(function (id) {\n      var o = {\n        roleId: id\n      };\n      orData.push(o);\n    });\n\n    CollabRole.findAll({\n      where: {\n        $or: orData\n      }\n    })\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n  else {\n    var queryData = req.query;\n\n    CollabRole.findAll({\n      where: req.query\n    })\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n\n\n\n}\n\n//get: /api/collabs/role/:id\nexport function findCollabRole(req, res) {\n\n  CollabRole.findById(req.params.id)\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Collab role from the DB\nexport function destroy(req, res) {\n  CollabRole.destroy({\n    _id: req.params.id\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function findAllJoinableSpace(req, res) {\n\n  //console.log('req.body:',JSON.stringify(req.body));\n  //console.log('req.query:',JSON.stringify(req.query));\n  var spaceId;\n\n  if (req.body.spaceId) {\n    spaceId = req.body.spaceId;\n  }\n\n  if (req.query.spaceId) {\n    spaceId = req.query.spaceId;\n  }\n\n  if (!spaceId) {\n    //console.log('spaceId:',spaceId);\n    res.status(500).send('please provide spaceId!');\n  }\n\n  console.log('spaceId:', spaceId);\n\n  CollabRole.belongsTo(Role, { as: 'role' });\n  CollabRole.belongsTo(Collab, { as: 'collab' });\n  Collab.belongsTo(Space, { as: 'space' });\n  Space.belongsTo(Category, { as: 'type' });\n  Space.hasMany(Collab, { as: 'collabs' });\n  Space.hasMany(Role, { as: 'roles' });\n  Role.hasMany(CollabRole, { as: 'collabRoles' });\n  Role.belongsToMany(Collab, { through: 'CollabRole', foreignKey: 'roleId', as: 'collabs' });\n  Collab.belongsToMany(Role, { through: 'CollabRole', foreignKey: 'collabId', as: 'roles' });\n\n  Space.findAll({\n    include: [\n      {\n        model: Collab, as: 'collabs',\n        where: {\n          spaceId: {\n            $ne: spaceId\n          },\n          name: {\n            $ne: 'collabRoot'\n          }\n        },/*\n        include: [\n          {\n            model: Role, as: 'roles',\n            where: {\n              spaceId: {\n                $eq: spaceId\n              }\n            },\n            through: {\n              where: {\n                roleType: 'child'\n              }\n            }\n            \n          }\n        ]*/\n      }\n    ]\n  }).then(function (spaces) {\n    var allSpaces = spaces;\n    return Space.findAll({\n      include: [\n        {\n          model: Collab, as: 'collabs',\n          where: {\n            spaceId: {\n              $ne: spaceId\n            }\n          },\n          include: [\n            {\n              model: Role, as: 'roles',\n              where: {\n                spaceId: {\n                  $eq: spaceId\n                }\n              },\n              through: {\n                where: {\n                  roleType: 'child'\n                }\n              }\n\n            }\n          ]\n        }\n      ]\n    }).then(function (joinedSpaces) {\n\n      //console.log('joinedSpaces:', JSON.stringify(joinedSpaces));\n\n      var theSpaces = allSpaces.slice();\n\n      joinedSpaces.forEach(function (o) {\n        //console.log('space:',JSON.stringify(space));\n        //console.log('o',JSON.stringify(o));\n        allSpaces.forEach(function (space, index) {\n          if (o._id === space._id) {\n            theSpaces.splice(index, 1);\n          }\n        });\n        allSpaces = theSpaces.slice();\n      })\n      return Promise.resolve(theSpaces);\n    })\n  })\n    /*\n    CollabRole.findAll({\n      include: [\n        {\n          model: Role, as: 'role',\n          where: {\n            spaceId: {\n              $ne: spaceId\n            }\n          }\n        },\n        {\n          model: Collab, as: 'collab',\n          include: {\n            model: Space, as: 'space',\n            include: [\n              {\n                model: Category, as: 'type'\n              },\n              {\n                model: Collab, as: 'collabs',\n                where: {\n                  name: {\n                    $ne: 'collabRoot'\n                  }\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }).then(function(collabRoles){\n      var oSpaces = {};\n      collabRoles.forEach(function (cRole) {\n        oSpaces[cRole.collab.space._id] = cRole.collab.space;\n      });\n      //console.log('oSpaces:', JSON.stringify(oSpaces));\n      var spaces = [];\n      for(var key in oSpaces){\n        spaces.push(oSpaces[key]);\n      }   \n      //console.log('spaces:', JSON.stringify(spaces));\n      return Promise.resolve(spaces);\n    })*/\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function findAllJoinedSpace(req, res) {\n  //console.log('req.body:',JSON.stringify(req.body));\n  //console.log('req.query:',JSON.stringify(req.query));\n  var spaceId;\n\n  if (req.body.spaceId) {\n    spaceId = req.body.spaceId;\n  }\n\n  if (req.query.spaceId) {\n    spaceId = req.query.spaceId;\n  }\n\n  if (!spaceId) {\n    //console.log('spaceId:',spaceId);\n    res.status(500).send('please provide spaceId!');\n  }\n\n  //console.log('spaceId:', spaceId);\n\n  CollabRole.belongsTo(Role, { as: 'role' });\n  CollabRole.belongsTo(Collab, { as: 'collab' });\n  Collab.belongsTo(Space, { as: 'space' });\n  Space.belongsTo(Category, { as: 'type' });\n  Space.hasMany(Collab, { as: 'joinedCollabs' });\n  Space.hasMany(Collab, { as: 'collabs' });\n  Space.hasMany(Role, { as: 'roles' });\n  Role.hasMany(CollabRole, { as: 'collabRoles' });\n  Role.belongsToMany(Collab, { through: 'CollabRole', foreignKey: 'roleId', as: 'collabs' });\n  Collab.belongsToMany(Role, { through: 'CollabRole', foreignKey: 'collabId', as: 'roles' });\n\n  Space.findAll({\n    include: [\n      {\n        model: Collab, as: 'joinedCollabs',\n        where: {\n          spaceId: {\n            $ne: spaceId\n          },\n          name: {\n            $ne: 'collabRoot'\n          }\n        },\n        include: [\n          {\n            model: Role, as: 'roles',\n            where: {\n              spaceId: {\n                $eq: spaceId\n              }\n            },\n            through: {\n              where: {\n                roleType: 'child'\n              }\n            }\n          }\n        ]\n      },\n      {\n        model: Collab, as: 'collabs',\n        where: {\n          spaceId: {\n            $ne: spaceId\n          },\n          name: {\n            $ne: 'collabRoot'\n          }\n        }\n      }\n    ]\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n\nexport function findAllUserNutPermit(req, res) {\n  var userId, spaceId;\n\n  if (req.query.spaceId) {\n    spaceId = req.query.spaceId;\n  } else {\n    res.status(500).send('please provide spaceId!');\n  }\n\n  if (req.query.userId) {\n    userId = req.query.userId;\n  } else {\n    res.status(500).send('please provide userId!');\n  }\n\n  /**\n   * 1. find user roles in space\n   * 2. find parent roles through CollabRole table\n   * 3. find NutPermit through parent roles\n   * 4. organize all NutPermit\n   */\n  Collab.findAllUserNutPermit(userId, spaceId)\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n\n\n}\n\n/**\n * return: NutPermitRole\n * require query: spaceId,userId\n * optional query: nutId, collabId\n */\nexport function findAllUserNutPermitByCollab(req, res) {\n\n\n  var nutId = req.query.nutId;\n  var spaceId = req.query.spaceId;\n  var userId = req.query.userId;\n  var collabId = req.query.collabId;\n  \n  if(!spaceId || !userId){\n    res.status(500).send('please provide spaceId and userId');\n  }\n  \n  PermitRole.belongsTo(Role, { as: 'role' });\n  PermitRole.belongsTo(Permit, { as: 'permit' });\n  PermitRole.belongsTo(Nut, { as: 'nut', foreignKey: 'ownerId' });\n  Role.belongsToMany(Collab, { as: 'collabs', through: 'CollabRole' });\n  Collab.belongsToMany(Role, { as: 'childRoles', through: 'CollabRole' });\n  Role.belongsToMany(User, { as: 'users', through: 'UserRole' });\n  User.belongsToMany(Role, { as: 'roles', through: 'UserRole' });\n  Collab.hasMany(CollabRole, { as: 'collabRoles', foreignKey: 'collabId' });\n\n  var userInclude = { model: User, as: 'users' };\n  if (userId) {\n    userInclude.where = { _id: userId }\n  }\n\n  var childRoleInclude = {\n    model: Role, as: 'childRoles',\n    where: {\n      spaceId: {\n        $ne: spaceId\n      }\n    },\n    include: [\n      userInclude\n    ]\n  }\n  \n  var collabInclude = {\n    model: Collab, as: 'collabs',\n    include: [\n      childRoleInclude\n    ]\n  }\n  \n  if(collabId){\n    collabInclude.where = {\n      _id: collabId\n    }\n  }\n  \n  var nutInclude = {\n    model: Nut, as: 'nut'\n  }\n  \n  if(nutId){\n    nutInclude.where = {\n      _id: nutId\n    }\n  }\n\n  PermitRole.findAll({\n    include: [\n      {\n        model: Role, as: 'role',\n        where: { spaceId: spaceId },\n        include: [\n          collabInclude\n        ]\n      },\n      nutInclude,\n      {\n        model: Permit, as: 'permit'\n      }\n    ]\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n"
  },
  {
    "__docId__": 165,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 23,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 166,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 25,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 167,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 34,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 168,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 43,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 169,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 170,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 64,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 171,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 72,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 172,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 129,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 173,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 154,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 174,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "bulkCreate",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~bulkCreate",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{bulkCreate}",
    "description": null,
    "lineNumber": 210,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 175,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 226,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 176,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 242,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 177,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addCollabRole",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~addCollabRole",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{addCollabRole}",
    "description": null,
    "lineNumber": 254,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 178,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "bulkAddCollabRole",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~bulkAddCollabRole",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{bulkAddCollabRole}",
    "description": null,
    "lineNumber": 261,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 179,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllColplayRole",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~findAllColplayRole",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{findAllColplayRole}",
    "description": null,
    "lineNumber": 268,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 180,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findCollabRole",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~findCollabRole",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{findCollabRole}",
    "description": null,
    "lineNumber": 306,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 181,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 315,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 182,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllJoinableSpace",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~findAllJoinableSpace",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{findAllJoinableSpace}",
    "description": null,
    "lineNumber": 324,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 183,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllJoinedSpace",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~findAllJoinedSpace",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{findAllJoinedSpace}",
    "description": null,
    "lineNumber": 482,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 184,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllUserNutPermit",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~findAllUserNutPermit",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{findAllUserNutPermit}",
    "description": null,
    "lineNumber": 560,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 185,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllUserNutPermitByCollab",
    "memberof": "api/collab/collab.controller.js",
    "longname": "api/collab/collab.controller.js~findAllUserNutPermitByCollab",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.controller.js",
    "importStyle": "{findAllUserNutPermitByCollab}",
    "description": "return: NutPermitRole\nrequire query: spaceId,userId\noptional query: nutId, collabId",
    "lineNumber": 594,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 186,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/collab.events.js",
    "memberof": null,
    "longname": "api/collab/collab.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 187,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/collab/collab.events.js",
    "longname": "api/collab/collab.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 188,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/collab/collab.events.js",
    "longname": "api/collab/collab.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 189,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/collab/collab.events.js",
    "longname": "api/collab/collab.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 190,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/collab.integration.js",
    "memberof": null,
    "longname": "api/collab/collab.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 191,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/collab/collab.integration.js",
    "longname": "api/collab/collab.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 192,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/collab.model.js",
    "memberof": null,
    "longname": "api/collab/collab.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require('bluebird');\nimport sqldb from '../../sqldb';\nimport TreeTable from '../../sqldb/treeTable';\n\nexport default function (sequelize, DataTypes) {\n\treturn sequelize.define('Collab', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tname: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\tfullname: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\talias: DataTypes.STRING,\n\t\tdescription: DataTypes.STRING,\n\t\ttypeId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tparentId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tappId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcreatorId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t}, {\n\t\t\tclassMethods: {\n\n\t\t\t\taddType: function (typeData) {\n\t\t\t\t\ttypeData.name = typeData.name.indexOf('collab.') === 0 ? typeData.name : 'collab.' + typeData.name;\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\t//console.log('addType typeData:',JSON.stringify(typeData));\n\t\t\t\t\treturn Category.addType(typeData);\n\t\t\t\t},\n\t\t\t\tgetType: function (typeData, autoCreated) {\n\t\t\t\t\t//console.log('in app Category:', Category);\n\t\t\t\t\t//console.log('in app User:', User);\n\t\t\t\t\t//console.log('in app sqldb:', sqldb);\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\t//var Category = sqldb.Category;\n\t\t\t\t\t//console.log('in app Category:', Category);\n\t\t\t\t\tif (typeof typeData === 'string' && isNaN(typeData)) {\n\t\t\t\t\t\tvar typeName = typeData;\n\n\t\t\t\t\t\ttypeData = {};\n\n\t\t\t\t\t\ttypeData.name = typeName;\n\n\t\t\t\t\t\t//console.log('in space getType');\n\t\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\t\t//console.log('space getType typeData:', JSON.stringfy(typeData));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof typeData === 'object' && !_.isEmpty(typeData)) {\n\t\t\t\t\t\ttypeData.owner = 'collab';\n\t\t\t\t\t\tvar tyName = typeData.name;\n\t\t\t\t\t\tif (tyName.substr(0, 4).toLowerCase() !== 'collab.') {\n\t\t\t\t\t\t\ttyName = 'collab.' + tyName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttypeData.name = tyName;\n\t\t\t\t\t\t//console.log('app model typeData:', JSON.stringify(typeData));\n\t\t\t\t\t\treturn Category.getType(typeData, true);\n\t\t\t\t\t}\n\n\t\t\t\t\t//otherwise return promise reject\n\t\t\t\t\tsequelize.Promise.reject(new Error('fail to add type for collab!'));\n\t\t\t\t},\n\n\t\t\t\tbulkAdd: function (bulkCollabData, context) {\n\n\t\t\t\t\t//console.log('bulkAdd:', JSON.stringify(bulkCollabData));\n\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar results = [];\n\t\t\t\t\treturn Promise.each(bulkCollabData, function (collabData) {\n\t\t\t\t\t\treturn that.add(collabData, context).then(function (c) {\n\t\t\t\t\t\t\t//console.log('c:',JSON.stringify(c));\n\t\t\t\t\t\t\tresults.push(c);\n\t\t\t\t\t\t});\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\treturn Promise.resolve(results);\n\t\t\t\t\t});\n\n\t\t\t\t\t/*\n\t\t\t\t\treturn Promise.each(bulkCollabData, function (collabData) {\n\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!collabData.type && !collabData.typeId) {\n\t\t\t\t\t\t\tcollabData.type = 'normal';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (collabData.type && !collabData.typeId) {\n\t\t\t\t\t\t\tvar spaceId = collabData.spaceId;\n\n\t\t\t\t\t\t\tvar typeData = {\n\t\t\t\t\t\t\t\tname: collabData.type,\n\t\t\t\t\t\t\t\tspaceId: spaceId\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t//console.log('bulkCreate typeData:',JSON.stringify(typeData));\n\n\t\t\t\t\t\t\treturn that.addType(typeData).then(function (type) {\n\t\t\t\t\t\t\t\tcollabData.typeId = type._id;\n\t\t\t\t\t\t\t\t//console.log('collabData:', collabData);\n\t\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('2 bulkCollabData:', JSON.stringify(bulkCollabData));\n\t\t\t\t\t\treturn that.bulkAdd(bulkCollabData);\n\t\t\t\t\t});*/\n\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * \n\t\t\t\t */\n\t\t\t\tadd: function (collabData, context) {\n\t\t\t\t\t//console.log('collabData:', JSON.stringify(collabData));\n\t\t\t\t\tif (context && context.spaceId) {\n\t\t\t\t\t\tcollabData.spaceId = context.spaceId;\n\t\t\t\t\t}\n\t\t\t\t\tvar parentRoles, childRoles;\n\t\t\t\t\tif (collabData.parentRoles) {\n\t\t\t\t\t\tparentRoles = collabData.parentRoles;\n\t\t\t\t\t}\n\t\t\t\t\tif (collabData.childRoles) {\n\t\t\t\t\t\tchildRoles = collabData.childRoles;\n\t\t\t\t\t}\n\t\t\t\t\tvar that = this;\n\n\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t//first add type\n\t\t\t\t\t\tif (collabData.typeId) {\n\t\t\t\t\t\t\tvar type = {\n\t\t\t\t\t\t\t\t_id: collabData.typeId\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t//delete collabData.typeId;\n\t\t\t\t\t\t\treturn resolve(type);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar typeData = {};\n\t\t\t\t\t\ttypeData.spaceId = collabData.spaceId;\n\t\t\t\t\t\tif (!collabData.type) {\n\t\t\t\t\t\t\ttypeData.name = 'normal';\n\t\t\t\t\t\t\ttypeData.alias = \"normal collab\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (collabData.type && typeof collabData.type === 'string') {\n\t\t\t\t\t\t\ttypeData.name = collabData.type;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (collabData.type && typeof collabData.type === 'object') {\n\t\t\t\t\t\t\ttypeData = Object.assign(typeData, collabData.type);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//console.log('typeData:',JSON.stringify(typeData));\n\t\t\t\t\t\treturn that.addType(typeData).then(function (type) {\n\t\t\t\t\t\t\t//console.log('1 type:',JSON.stringify(type));\n\t\t\t\t\t\t\treturn resolve(type);\n\t\t\t\t\t\t});\n\t\t\t\t\t}).then(function (type) {\n\t\t\t\t\t\t//console.log('2 collabData:',JSON.stringify(collabData));\n\t\t\t\t\t\tcollabData.typeId = type._id;\n\t\t\t\t\t\t//return that.getCollabRoot(collabData).addChild(collabData);\n\t\t\t\t\t\treturn that.getCollabRoot(collabData).then(function (collabRoot) {\n\t\t\t\t\t\t\treturn collabRoot.addChild(collabData);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t/*\n\t\t\t\t\t\treturn that.findOrCreate({\n\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\tname: collabData.name,\n\t\t\t\t\t\t\t\tspaceId: collabData.spaceId\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdefaults: collabData\n\t\t\t\t\t\t});*/\n\t\t\t\t\t\t//}).spread(function (collab, created) {\n\t\t\t\t\t}).then(function (collab) {\n\t\t\t\t\t\t//console.log('created:', created);\n\t\t\t\t\t\t//console.log('2 collabData:',JSON.stringify(collabData));\n\t\t\t\t\t\tvar theCollab = collab;\n\t\t\t\t\t\tif (parentRoles || childRoles) {\n\t\t\t\t\t\t\tvar listData = [];\n\t\t\t\t\t\t\tif (parentRoles) {\n\t\t\t\t\t\t\t\tparentRoles.forEach(function (r) {\n\t\t\t\t\t\t\t\t\tif (r && r.parentRoleId) {\n\t\t\t\t\t\t\t\t\t\tlistData.push({\n\t\t\t\t\t\t\t\t\t\t\tparentRoleId: r.parentRoleId,\n\t\t\t\t\t\t\t\t\t\t\tcollabId: collab._id,\n\t\t\t\t\t\t\t\t\t\t\tspaceId: collab.spaceId\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tlistData.push({\n\t\t\t\t\t\t\t\t\t\t\tparentRole: r,\n\t\t\t\t\t\t\t\t\t\t\tcollabId: collab._id,\n\t\t\t\t\t\t\t\t\t\t\tspaceId: collab.spaceId\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (childRoles) {\n\t\t\t\t\t\t\t\tchildRoles.forEach(function (r) {\n\t\t\t\t\t\t\t\t\tif (r && r.childRoleId) {\n\t\t\t\t\t\t\t\t\t\tlistData.push({\n\t\t\t\t\t\t\t\t\t\t\tchildRoleId: r.childRoleId,\n\t\t\t\t\t\t\t\t\t\t\tcollabId: collab._id,\n\t\t\t\t\t\t\t\t\t\t\tspaceId: collab.spaceId\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tlistData.push({\n\t\t\t\t\t\t\t\t\t\t\tchildRole: r,\n\t\t\t\t\t\t\t\t\t\t\tcollabId: collab._id,\n\t\t\t\t\t\t\t\t\t\t\tspaceId: collab.spaceId\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//console.log('listData:', JSON.stringify(listData));\n\t\t\t\t\t\t\tvar CollabRole = sqldb.CollabRole;\n\t\t\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\t\t\tvar Role = sqldb.Role;\n\t\t\t\t\t\t\tthat.belongsTo(Category, { as: 'type' });\n\t\t\t\t\t\t\tthat.hasMany(CollabRole, { foreignKey: 'collabId', as: 'collabRoles' });\n\t\t\t\t\t\t\t//that.hasMany(CollabRole,{foreignKey: 'collabId', as:'childRoles'});\n\t\t\t\t\t\t\tCollabRole.belongsTo(Role, { as: 'role' })\n\n\t\t\t\t\t\t\treturn CollabRole.bulkAdd(listData).then(function (results) {\n\t\t\t\t\t\t\t\t//console.log('results:',JSON.stringify(results));\n\t\t\t\t\t\t\t\treturn that.find({\n\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\t_id: theCollab._id\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmodel: CollabRole, as: 'collabRoles',\n\t\t\t\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodel: Role, as: 'role'\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})/*.then(function(rs){\n\t\t\t\t\t\t\t\t\tconsole.log('rs:',JSON.stringify(rs));\n\t\t\t\t\t\t\t\t})*/\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn that.find({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t_id: collab._id\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tinclude: {\n\t\t\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * format of roleData: \n\t\t\t\t * {\n\t\t\t\t * \t\tcollabId: xxx,\n\t\t\t\t * \t\tparentRoleId: xxx,\n\t\t\t\t * \t\tchildRoleId: xxx\n\t\t\t\t * } \n\t\t\t\t *  or\n\t\t\t\t * {\n\t\t\t\t * \t\tcollabId: xxx,\n\t\t\t\t * \t\tparentRole: xxx(name of role),\n\t\t\t\t * \t\tchildRole: xxx,\n\t\t\t\t * \t\tspaceId: xxx (if use role name, must provide spaceId)\n\t\t\t\t * }\n\t\t\t\t */\n\t\t\t\taddRole: function (roleData) {\n\t\t\t\t\tvar CollabRole = sqldb.CollabRole;\n\t\t\t\t\treturn CollabRole.addCollabRole(roleData);\n\t\t\t\t},\n\n\t\t\t\tgetCollabRoot: function (collabData) {\n\n\t\t\t\t\t//console.log('in getCollabRoot collabData:', JSON.stringify(collabData));\n\n\t\t\t\t\tvar Model = this;\n\t\t\t\t\t//var attributeData = attrData;\n\n\t\t\t\t\tvar treeObj = new TreeTable();\n\n\t\t\t\t\t//console.log('getCollabRoot treeObj:', treeObj);\n\n\t\t\t\t\treturn treeObj.getRoot(this).then(function (root) {\n\t\t\t\t\t\t//console.log('in getCollabRoot root:', JSON.stringify(root));\n\t\t\t\t\t\tvar whereData = {};\n\n\t\t\t\t\t\tif (typeof collabData === 'object') {\n\t\t\t\t\t\t\tfor (var key in collabData) {\n\t\t\t\t\t\t\t\tif (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n\t\t\t\t\t\t\t\t\twhereData.owner = collabData[key];\n\t\t\t\t\t\t\t\t\t//delete attributeData[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (key.toLowerCase() === 'ownerid') {\n\t\t\t\t\t\t\t\t\twhereData.ownerId = collabData[key];\n\t\t\t\t\t\t\t\t\t//delete attributeData[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (key.toLowerCase() === 'spaceid') {\n\t\t\t\t\t\t\t\t\twhereData.spaceId = collabData[key];\n\t\t\t\t\t\t\t\t\t//delete attributeData[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (key.toLowerCase() === 'appid') {\n\t\t\t\t\t\t\t\t\twhereData.appId = collabData[key];\n\t\t\t\t\t\t\t\t\t//delete attributeData[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twhereData.name = 'collabRoot';\n\t\t\t\t\t\twhereData.fullname = 'root.collabRoot';\n\t\t\t\t\t\twhereData.parentId = 1;\n\n\t\t\t\t\t\t//console.log('getAttributeRoot root: ', JSON.stringify(root));\n\n\t\t\t\t\t\t//console.log('getCollabRoot whereData: ', JSON.stringify(whereData));\n\n\t\t\t\t\t\treturn Model.findOrCreate({\n\t\t\t\t\t\t\twhere: whereData,\n\t\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\t\talias: 'collabRoot'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.spread(function (entity, created) {\n\t\t\t\t\t\t\t\t//console.log('getCollabRoot entity: ', JSON.stringify(entity));\n\t\t\t\t\t\t\t\t//return Promise.resolve(entity);\n\t\t\t\t\t\t\t\treturn entity;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * 1. find user roles in space\n\t\t\t\t * 2. find parent roles through CollabRole table\n\t\t\t\t * 3. find NutPermit through parent roles\n\t\t\t\t * 4. organize all NutPermit\n\t\t\t\t */\n\t\t\t\tfindAllUserNutPermit: function (userId, spaceId) {\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\tvar Collab = sqldb.Collab;\n\t\t\t\t\tvar Role = sqldb.Role;\n\t\t\t\t\tvar PermitRole = sqldb.PermitRole;\n\t\t\t\t\tvar Permit = sqldb.Permit;\n\t\t\t\t\tvar Nut = sqldb.Nut;\n\t\t\t\t\tvar Space = sqldb.Space;\n\t\t\t\t\tvar Category = sqldb.Category;\n\n\t\t\t\t\tCollab.belongsToMany(Role, { through: 'CollabRole', foreignKey: 'collabId', as: 'childRoles' });\n\t\t\t\t\tCollab.belongsToMany(Role, { through: 'CollabRole', foreignKey: 'collabId', as: 'parentRoles' });\n\t\t\t\t\tRole.hasMany(PermitRole, { as: 'nutPermits' });\n\t\t\t\t\tPermitRole.belongsTo(Permit, { as: 'permit' });\n\t\t\t\t\tPermitRole.belongsTo(Role, { as: 'role' });\n\t\t\t\t\tPermitRole.belongsTo(Nut, { as: 'nut', foreignKey: 'ownerId' });\n\t\t\t\t\tSpace.hasMany(Collab, { as: 'collabs' });\n\n\t\t\t\t\treturn Role.findAllUserSpaceRole(userId, spaceId)\n\t\t\t\t\t\t.then(function (roles) {\n\t\t\t\t\t\t\tvar childRoleList = [];\n\t\t\t\t\t\t\troles.forEach(function (role) {\n\t\t\t\t\t\t\t\tchildRoleList.push(role._id);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t//console.log('user roles:', childRoleList);\n\t\t\t\t\t\t\treturn Space.findAll({\n\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tmodel: Collab, as: 'collabs',\n\t\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\t\tspaceId: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ne: spaceId\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tmodel: Role, as: 'childRoles',\n\t\t\t\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t_id: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$in: childRoleList\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tthrough: {\n\t\t\t\t\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troleType: 'child'\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tmodel: Role, as: 'parentRoles',\n\t\t\t\t\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel: PermitRole, as: 'nutPermits',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel: Permit, as: 'permit',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel: Nut, as: 'nut'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel: Role, as: 'role'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}).then(function (spaces) {\n\t\t\t\t\t\t\t//console.log('spaces:',JSON.stringify(spaces));\n\t\t\t\t\t\t\tspaces.forEach(function (space) {\n\t\t\t\t\t\t\t\tvar collabs = space.collabs;\n\t\t\t\t\t\t\t\tcollabs.forEach(function (collab) {\n\t\t\t\t\t\t\t\t\tcollab.parentRoles.forEach(function (role, index) {\n\t\t\t\t\t\t\t\t\t\tif (role.CollabRole.roleType === 'child') {\n\t\t\t\t\t\t\t\t\t\t\tcollab.parentRoles.splice(index, 1);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn Promise.resolve(spaces);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tinstanceMethods: {\n\t\t\t\taddChild: function (childData) {\n\t\t\t\t\t//console.log('addChild childData:', JSON.stringify(childData));\n\t\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\t\treturn treeObj.addChild(this, childData);\n\t\t\t\t},\n\t\t\t\tgetChildren: function (childData) {\n\t\t\t\t\t//console.log('getChildren:', JSON.stringify(childData));\n\t\t\t\t\t//var treeObj = new TreeTable();\n\t\t\t\t\t//return treeObj.getChildren(this, childData);\n\n\t\t\t\t\tvar Collab = sqldb.Collab;\n\t\t\t\t\tvar CollabRole = sqldb.CollabRole;\n\t\t\t\t\tvar Role = sqldb.Role;\n\t\t\t\t\tvar Category = sqldb.Category;\n\n\t\t\t\t\tvar mode = 'all';\n\t\t\t\t\tif (childData.mode) {\n\t\t\t\t\t\tmode = childData.mode;\n\t\t\t\t\t}\n\n\t\t\t\t\tCollab.belongsTo(Category, { as: 'type' });\n\t\t\t\t\tCollab.hasMany(CollabRole, { foreignKey: 'collabId', as: 'collabRoles' });\n\t\t\t\t\t//that.hasMany(CollabRole,{foreignKey: 'collabId', as:'childRoles'});\n\t\t\t\t\tCollabRole.belongsTo(Role, { as: 'role' });\n\n\t\t\t\t\tvar findData = {\n\t\t\t\t\t\tspaceId: childData.spaceId,\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t$ne: 'collabRoot'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfullname: {\n\t\t\t\t\t\t\t$like: this.fullname + '.%'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (mode.toLocaleLowerCase() === 'child') {\n\t\t\t\t\t\tfindData.parentId = this._id;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar includeData = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmodel: CollabRole, as: 'collabRoles',\n\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmodel: Role, as: 'role'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\t\treturn Collab.findAll({\n\t\t\t\t\t\twhere: findData,\n\t\t\t\t\t\tinclude: includeData\n\t\t\t\t\t}).then(function (collabs) {\n\t\t\t\t\t\tif (mode.toLocaleLowerCase() === 'leaf') {\n\t\t\t\t\t\t\tvar theList = [];\n\t\t\t\t\t\t\tvar theCollabs = collabs.slice();\n\n\t\t\t\t\t\t\tcollabs.forEach(function (collab, index) {\n\t\t\t\t\t\t\t\tvar fullname = collab.fullname;\n\t\t\t\t\t\t\t\tvar id = collab._id;\n\t\t\t\t\t\t\t\ttheCollabs.forEach(function (tCollab, index2) {\n\t\t\t\t\t\t\t\t\tvar fullname2 = tCollab.fullname;\n\t\t\t\t\t\t\t\t\t//var id2 = tCollab._id;\n\t\t\t\t\t\t\t\t\t//find none-leaf element first\n\t\t\t\t\t\t\t\t\tif (fullname2.indexOf(fullname + '.') !== -1 && theList.indexOf(id) === -1) {\n\t\t\t\t\t\t\t\t\t\t//console.log('fullname:fullname2',fullname + ':' + fullname2)\n\t\t\t\t\t\t\t\t\t\ttheList.push(id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tvar retList = [];\n\t\t\t\t\t\t\tcollabs.forEach(function (collab) {\n\t\t\t\t\t\t\t\tif (theList.indexOf(collab._id) === -1) {\n\t\t\t\t\t\t\t\t\tretList.push(collab);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn Promise.resolve(retList);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn Promise.resolve(collabs);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tgetChild: function (childData) {\n\t\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\t\treturn treeObj.getChild(this, childData);\n\t\t\t\t},\n\t\t\t\tgetParent: function (recursive) {\n\t\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\t\treturn treeObj.getParent(this, recursive);\n\t\t\t\t},\n\t\t\t\tchildCount: function () {\n\t\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\t\treturn treeObj.childCount(this);\n\t\t\t\t},\n\t\t\t\tisParentOf: function (childObj, recursive) {\n\t\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\t\treturn treeObj.isParentOf(childObj, this, recursive);\n\t\t\t\t},\n\t\t\t\tisChildOf: function (parentObj, recursive) {\n\t\t\t\t\tvar treeObj = new TreeTable();\n\t\t\t\t\treturn treeObj.isChildOf(parentObj, this, childData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n}\n"
  },
  {
    "__docId__": 193,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/collab/collab.model.js",
    "longname": "api/collab/collab.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 194,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "collab",
    "memberof": "api/collab/collab.model.js",
    "longname": "api/collab/collab.model.js~collab",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.model.js",
    "importStyle": "collab",
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 195,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/collab.socket.js",
    "memberof": null,
    "longname": "api/collab/collab.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 196,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/collab/collab.socket.js",
    "longname": "api/collab/collab.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 197,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/collab/collab.socket.js",
    "longname": "api/collab/collab.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 198,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/collab/collab.socket.js",
    "longname": "api/collab/collab.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collab.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 199,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/collab/collab.socket.js",
    "longname": "api/collab/collab.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 200,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/collab/collab.socket.js",
    "longname": "api/collab/collab.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collab.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 201,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/collabRole.model.js",
    "memberof": null,
    "longname": "api/collab/collabRole.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require('bluebird');\nimport sqldb from '../../sqldb';\n\nexport default function (sequelize, DataTypes) {\n\treturn sequelize.define('CollabRole', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tdescription: DataTypes.STRING,\n\t\tcollabId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\troleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\troleType: {\n\t\t\ttype: DataTypes.ENUM('parent', 'child')\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t}, {\n\t\t\tclassMethods: {\n\t\t\t\t//this is a clever add, it will first find collab and role, \n\t\t\t\t//if not exist, create first\n\t\t\t\t//input format: {parentRoleId[childRoleId]: xxx, collabId: xxx} \n\t\t\t\t//or {parentRole[childRole]: xxx, [spaceId: xxx], collab: xxx}\n\t\t\t\taddCollabRole: function (data) {\n\t\t\t\t\tvar parentRoleId, childRoleId;\n\t\t\t\t\tvar parentRole, childRole, collabId;\n\t\t\t\t\tvar collab, collabRole;\n\t\t\t\t\tvar spaceId;\n\t\t\t\t\tvar theData = {};\n\t\t\t\t\tvar Role = sqldb.Role;\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\tvar Collab = sqldb.Collab;\n\t\t\t\t\tvar that = this;\n\n\t\t\t\t\tCollab.belongsTo(Category, { as: 'type' });\n\n\t\t\t\t\t//console.log('addCollabRole data:', JSON.stringify(data));\n\n\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t//first get parent role id\n\t\t\t\t\t\tif (data.parentRoleId) {\n\t\t\t\t\t\t\tparentRoleId = data.parentRoleId;\n\t\t\t\t\t\t\treturn resolve(null);\n\t\t\t\t\t\t\t//return resolve(data.parentRoleId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.spaceId && data.parentRole) {\n\t\t\t\t\t\t\t//findOrCreate role and then return roleId\n\t\t\t\t\t\t\tvar pRole = {};\n\t\t\t\t\t\t\tif(typeof data.parentRole === 'string'){\n\t\t\t\t\t\t\t\tpRole.name = data.parentRole;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(typeof data.parentRole === 'object'){\n\t\t\t\t\t\t\t\tpRole = data.parentRole;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpRole.spaceId = data.spaceId;\n\t\t\t\t\t\t\treturn Role.addRole(pRole).then(function (role) {\n\t\t\t\t\t\t\t\tparentRoleId = role._id;\n\t\t\t\t\t\t\t\t//console.log('0 parentRoleId:',parentRoleId);\n\t\t\t\t\t\t\t\t//console.log('role 1:',JSON.stringify(role));\n\t\t\t\t\t\t\t\treturn resolve(role._id);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn resolve(null);\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('1 parentRoleId:',parentRoleId);\n\t\t\t\t\t\t//parentRoleId = roleId;\n\t\t\t\t\t\tif (data.childRoleId) {\n\t\t\t\t\t\t\tchildRoleId = data.childRoleId;\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.spaceId && data.childRole) {\n\t\t\t\t\t\t\tvar cRole = {};\n\t\t\t\t\t\t\tif(typeof data.childRole === 'string'){\n\t\t\t\t\t\t\t\tcRole.name = data.childRole;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(typeof data.childRole === 'object'){\n\t\t\t\t\t\t\t\tcRole = data.childRole;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcRole.spaceId = data.spaceId;\n\t\t\t\t\t\t\t//findOrCreate role and then return roleId\n\t\t\t\t\t\t\treturn Role.addRole(cRole).then(function (role) {\n\t\t\t\t\t\t\t\tchildRoleId = role._id;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('2 childRoleId:',childRoleId);\n\t\t\t\t\t\t//console.log('2 parentRoleId:data',JSON.stringify(data));\n\t\t\t\t\t\t//find collab id\n\t\t\t\t\t\t//childRoleId = roleId;\n\t\t\t\t\t\tif (data.collabId) {\n\t\t\t\t\t\t\tcollabId = data.collabId;\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.collab) {\n\t\t\t\t\t\t\treturn Collab.add(data.collab).then(function (collab) {\n\t\t\t\t\t\t\t\tcollabId = collab._id;\n\t\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//return Promise.resolve(null);\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('3 parentRoleId:',parentRoleId);\n\t\t\t\t\t\t//console.log('3 childRoleId:',childRoleId);\n\t\t\t\t\t\t//console.log('3 collabId:',collabId);\n\t\t\t\t\t\t//collabId = result;\n\t\t\t\t\t\tif (parentRoleId && collabId) {\n\t\t\t\t\t\t\t//console.log('xxx');\n\t\t\t\t\t\t\tthat.belongsTo(Role, { foreignKey: 'roleId', as: 'parentRole' });\n\t\t\t\t\t\t\tthat.belongsTo(Collab, { as: 'collab' });\n\t\t\t\t\t\t\tCollab.belongsTo(Category, { as: 'type' });\n\t\t\t\t\t\t\treturn that.findOrCreate({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\tcollabId: collabId,\n\t\t\t\t\t\t\t\t\troleId: parentRoleId,\n\t\t\t\t\t\t\t\t\troleType: 'parent'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).spread(function (row, create) {\n\t\t\t\t\t\t\t\t//console.log('row:', JSON.stringify(row));\n\t\t\t\t\t\t\t\treturn that.find({\n\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\t_id: row._id\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmodel: Role, as: 'parentRole'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmodel: Collab, as: 'collab',\n\t\t\t\t\t\t\t\t\t\t\tinclude: {\n\t\t\t\t\t\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (childRoleId && collabId) {\n\t\t\t\t\t\t\t//console.log('yyy');\n\t\t\t\t\t\t\tthat.belongsTo(Role, { foreignKey: 'roleId', as: 'childRole' });\n\t\t\t\t\t\t\tthat.belongsTo(Collab, { as: 'collab' });\n\t\t\t\t\t\t\tCollab.belongsTo(Category, { as: 'type' });\n\t\t\t\t\t\t\t//console.log('4:');\n\t\t\t\t\t\t\treturn that.findOrCreate({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\tcollabId: collabId,\n\t\t\t\t\t\t\t\t\troleId: childRoleId,\n\t\t\t\t\t\t\t\t\troleType: 'child'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).spread(function (row, create) {\n\t\t\t\t\t\t\t\t//console.log('2 row:', JSON.stringify(row));\n\t\t\t\t\t\t\t\treturn that.find({\n\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\t_id: row._id\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmodel: Role, as: 'childRole'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmodel: Collab, as: 'collab',\n\t\t\t\t\t\t\t\t\t\t\tinclude: {\n\t\t\t\t\t\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tadd: function (data) {\n\t\t\t\t\treturn this.addCollabRole(data);\n\t\t\t\t},\n\t\t\t\t//this is a clever add, input is an array\n\t\t\t\tbulkAdd: function (data) {\n\t\t\t\t\t//console.log('collabRole data:',JSON.stringify(data))\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar results = [];\n\t\t\t\t\treturn Promise.each(data, function (itemData) {\n\t\t\t\t\t\treturn that.addCollabRole(itemData).then(function (result) {\n\t\t\t\t\t\t\t//console.log('result:',JSON.stringify(result));\n\t\t\t\t\t\t\tresults.push(result);\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t})\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('1 results:',JSON.stringify(results));\n\t\t\t\t\t\treturn Promise.resolve(results);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t});\n}\n"
  },
  {
    "__docId__": 202,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/collab/collabRole.model.js",
    "longname": "api/collab/collabRole.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/collab/collabRole.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 203,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "collabRole",
    "memberof": "api/collab/collabRole.model.js",
    "longname": "api/collab/collabRole.model.js~collabRole",
    "access": null,
    "export": true,
    "importPath": "./api/collab/collabRole.model.js",
    "importStyle": "collabRole",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 204,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/index.js",
    "memberof": null,
    "longname": "api/collab/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./collab.controller');\n\nvar router = express.Router();\n\nrouter.get('/spaces/joinable', controller.findAllJoinableSpace);\nrouter.get('/spaces/joined', controller.findAllJoinedSpace);\nrouter.get('/user/nut/permits', controller.findAllUserNutPermitByCollab);\nrouter.get('/user/nuts', controller.findAllUserNutPermit);\nrouter.get('/:id', controller.show);\nrouter.get('/', controller.index);\nrouter.post('/bulk', controller.bulkCreate);\nrouter.post('/roles', controller.addCollabRole);\nrouter.post('/roles/bulk', controller.bulkAddCollabRole);\nrouter.post('/', controller.create);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\n//working on collab role table\n//router.get('/roles', controller.findAllCollabRole);\n//router.get('/roles/:id', controller.findCollabRole);\n//router.post('/roles', controller.addCollabRole);\n//router.put('/roles/:id', controller.updateCollabRole);\n//router.delete('/roles/:id', controller.destroyCollabRole);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 205,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/collab/index.js",
    "longname": "api/collab/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/collab/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 206,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/collab/index.js",
    "longname": "api/collab/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/collab/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 207,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/collab/index.js",
    "longname": "api/collab/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/collab/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 208,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/collab/index.spec.js",
    "memberof": null,
    "longname": "api/collab/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 209,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/collab/index.spec.js",
    "longname": "api/collab/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/collab/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 210,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/collab/index.spec.js",
    "longname": "api/collab/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/collab/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 211,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/collab/index.spec.js",
    "longname": "api/collab/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/collab/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 212,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/collab/index.spec.js",
    "longname": "api/collab/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/collab/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 213,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/nut/index.js",
    "memberof": null,
    "longname": "api/nut/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./nut.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/user', controller.findAllUserPermitNut);\nrouter.get('/permits/roles', controller.findAllPermitRole);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 214,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/nut/index.js",
    "longname": "api/nut/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/nut/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 215,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/nut/index.js",
    "longname": "api/nut/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/nut/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 216,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/nut/index.js",
    "longname": "api/nut/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/nut/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 217,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/nut/index.spec.js",
    "memberof": null,
    "longname": "api/nut/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 218,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/nut/index.spec.js",
    "longname": "api/nut/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/nut/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 219,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/nut/index.spec.js",
    "longname": "api/nut/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/nut/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 220,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/nut/index.spec.js",
    "longname": "api/nut/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/nut/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 221,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/nut/index.spec.js",
    "longname": "api/nut/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/nut/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 222,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/nut/nut.controller.js",
    "memberof": null,
    "longname": "api/nut/nut.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Nut} from '../../sqldb';\nimport {Permit} from '../../sqldb';\nimport {Role} from '../../sqldb';\nimport {PermitRole} from '../../sqldb';\nimport {UserRole} from '../../sqldb';\nimport {Category} from '../../sqldb';\nimport {App} from '../../sqldb';\nvar Promise = require('bluebird');\n\nvar permitController = require('../permit/permit.controller');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function (entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function (entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Nuts\n//\nexport function index(req, res) {\n\n  Nut.findAll({\n    where: req.query\n  })\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Nut from the DB\nexport function show(req, res) {\n\n  Nut.belongsTo(Category, { as: 'type' });\n\n  var param = req.params.id;\n\n  Nut.find({\n    where: {\n      _id: req.params.id\n    },\n    include: [{\n      model: Category, as: 'type'\n    }]\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Nut in the DB\nexport function create(req, res) {\n  //console.log('Nut create req.body:', JSON.stringify(req.body));\n  var nutData = req.body;\n  var typeName;\n  for (var key in nutData) {\n    if (key.toLowerCase() === 'type' || key.toLowerCase() === 'typename') {\n  \t\t  typeName = nutData[key];\n  \t\t  delete nutData[key];\n    }\n  }\n\n  if (nutData.name) {\n  \t\tvar nutName = nutData.name;\n  \t\t// delete nutData.name;\n  }\n\n  if (typeName && nutName) {\n    //console.log('create nut typeName:',typeName);\n    Nut.addType(typeName).then(function (type) {\n  \t\t  nutData.typeId = type._id;\n      Nut.create(nutData)\n        .then(respondWithResult(res, 201))\n        .catch(handleError(res));\n      //     Nut.findOrCreate({\n      // where: {name: nutName},\n      // defaults:nutData})\n      //     .then(respondWithResult(res, 201))\n      //     .catch(handleError(res));\n    })\n  } else {\n    // Nut.create(nutData)\n    // .then(respondWithResult(res, 201))\n    // .catch(handleError(res));\n  }\n}\n\n// Updates an existing Nut in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Nut from the DB\nexport function destroy(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\n//get: query {userId, spaceId, appId}\nexport function findAllUserPermitNut(req, res) {\n\n  PermitRole.belongsTo(Permit, { as: 'permit' });\n  PermitRole.belongsTo(Role, { as: 'role' });\n  PermitRole.belongsTo(Nut, { foreignKey: 'ownerId', as: 'nut' });\n  Nut.belongsTo(Category, { as: 'type' });\n  Nut.belongsTo(App, { as: 'app' });\n  App.belongsTo(Category, { as: 'type' });\n\n  var query = {};\n  //console.log('query 1:', JSON.stringify(query));\n\n  if (!req.query.spaceId || !req.query.userId) {\n    handleError(res);\n  } else {\n    var whereData = {};\n    whereData.userId = req.query.userId;\n    whereData.spaceId = req.query.spaceId;\n\n    query.spaceId = req.query.spaceId\n    var spaceId = req.query.spaceId;\n\n    //delete query.userId;\n    //delete query.spaceId;\n\n    //console.log('query 2:', JSON.stringify(query));\n    \n    var userRoleList = [];\n\n    UserRole.findAll({\n      where: whereData\n    }).then(function (rows) {\n\n      //console.log('roles:', JSON.stringify(rows));\n\n      var or = [];\n      rows.forEach(function (row) {\n        userRoleList.push(row.roleId);\n        or.push({\n          roleId: row.roleId\n        });\n      });\n      query['$or'] = or;\n\n      //console.log('query 4:', JSON.stringify(query));\n\n      var permitRoles;\n      var nutInclude = {\n        model: Nut, as: 'nut',\n        include: {\n          model: App, as: 'app'\n        },\n        where: {\n          spaceId: spaceId\n        }\n      }\n\n      if (req.query.hasOwnProperty('appId') && req.query.appId > 0) {\n        nutInclude.where = {\n          appId: req.query.appId\n        };\n      }\n\n      //console.log('nutInclude:',nutInclude);\n      \n      //console.log('req.query 5:', JSON.stringify(req.query));\n\n      //add everyone role and add to user role list\n      //it will make sure user have everyone permit nut\n      return Role.addRole({\n          spaceId: req.query.spaceId,\n          name: 'everyone'\n        }\n      ).then(function (eRole) {\n        //console.log('everyone role:',JSON.stringify(eRole));\n        userRoleList.push(eRole._id);\n        or.push(eRole._id);\n        query['$or'] = or;\n        console.log('userRoleList:',JSON.stringify(userRoleList));\n        return PermitRole.findAll({\n          //where: query,\n          include: [\n            {\n              model: Permit, as: 'permit'\n            },\n            {\n              model: Role, as: 'role',\n              where: {\n                _id: {\n                  $in: userRoleList\n                }\n              }\n            },\n            nutInclude\n          ]\n        })\n      })\n    })\n      /*.then(function(rows){\n        \n        //console.log('rows:',JSON.stringify(rows));\n\n        permitRoles = JSON.parse(JSON.stringify(rows));\n\n        var or = [];\n\n        rows.forEach(function(row){\n          or.push({\n            _id: row.ownerId\n          });\n        });\n        \n       console.log('1 appInclude:');\n        \n        var appInclude = {\n          model: App,\n          as: 'app',\n          include: [{\n            model: Category, as: 'type'\n          }]\n        };\n        \n        console.log('2 appInclude:');\n        \n        if(req.query.hasOwnProperty('appId') && req.query.appId >0){\n          appInclude.where = {\n            _id: req.query.appId\n          };\n        }\n        \n        //console.log('appInclude:',appInclude);\n\n        return Nut.findAll({\n          where: {$or: or},\n          include: [\n            {\n              model: Category, as: 'type'\n            },\n            appInclude\n            \n            {\n              model: App, as: 'app',\n              include: [\n                {model: Category, as: 'type'}\n              ]\n            }\n          ]\n        }).then(function(nuts){\n          //console.log('nuts',JSON.stringify(nuts));\n          permitRoles.forEach(function(pr){\n            nuts.forEach(function(nut){\n              if(pr.ownerId === nut._id){\n                pr.nut = nut;\n              }\n            })\n          });\n          return Promise.resolve(permitRoles);\n        });\n      })\n    })*/\n      .then(respondWithResult(res, 201))\n      .catch(handleError(res));\n  }\n\n}\n\n/**\n * find space nut permit role: {spaceId}\n * find app nut permit roles: {appId}\n * find permit roles for nut: {nutId}\n */\nexport function findAllPermitRole(req, res) {\n\n  PermitRole.belongsTo(Permit, { as: 'permit' });\n  PermitRole.belongsTo(Role, { as: 'role' });\n  PermitRole.belongsTo(Nut, { foreignKey: 'ownerId', as: 'nut' });\n  Nut.belongsTo(Category, { as: 'type' });\n  Nut.belongsTo(App, { as: 'app' });\n  App.belongsTo(Category, { as: 'type' });\n\n  var spaceId, appId, nutId;\n  var findData;\n\n  if (req.query.spaceId) {\n    spaceId = req.query.spaceId;\n    findData = {};\n    findData.where = {};\n    findData.where.spaceId = req.query.spaceId;\n    findData.where.owner = 'nut';\n  }\n\n  if (req.query.nutId) {\n    findData = {};\n    findData.where = {};\n    findData.where.ownerId = req.query.nutId;\n    findData.where.owner = 'nut';\n  }\n\n  if (req.query.roleId) {\n    findData = {};\n    findData.where = {};\n    findData.where.roleId = req.query.roleId;\n    findData.where.owner = 'nut';\n  }\n\n  if (req.query.appId) {\n    appId = req.query.appId;\n    findData = {};\n    findData.where = {};\n    //appId = req.query.nutId;\n    findData.where.owner = 'nut';\n    findData.include = [{\n      model: Nut,\n      as: 'nut',\n      where: {\n        appId: appId\n      }\n    }];\n  }\n\n  //console.log('nutController findAllPermitRole spaceId:',spaceId);\n\n  if (typeof findData === 'object') {\n    if (!findData.include) {\n      findData.include = [];\n      findData.include.push({\n        model: Nut, as: 'nut'\n      });\n    }\n    ///*\n    findData.include.push({\n      model: Permit, as: 'permit'\n    });//*/\n\n    findData.include.push({\n      model: Role, as: 'role'\n    });\n\n    PermitRole.findAll(findData)\n      .then(respondWithResult(res, 201))\n      .catch(handleError(res));\n  } else {\n    res.status(500).send('please check input!');\n  }\n\n}\n\n"
  },
  {
    "__docId__": 223,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 20,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 224,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "permitController",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~permitController",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 225,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 226,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 227,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 42,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 228,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 53,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 229,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 63,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 230,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 72,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 231,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 82,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 232,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 102,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 233,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 139,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 234,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 155,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 235,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllUserPermitNut",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~findAllUserPermitNut",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": "{findAllUserPermitNut}",
    "description": null,
    "lineNumber": 167,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 236,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllPermitRole",
    "memberof": "api/nut/nut.controller.js",
    "longname": "api/nut/nut.controller.js~findAllPermitRole",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.controller.js",
    "importStyle": "{findAllPermitRole}",
    "description": "find space nut permit role: {spaceId}\nfind app nut permit roles: {appId}\nfind permit roles for nut: {nutId}",
    "lineNumber": 338,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 237,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/nut/nut.events.js",
    "memberof": null,
    "longname": "api/nut/nut.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 238,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/nut/nut.events.js",
    "longname": "api/nut/nut.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 239,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/nut/nut.events.js",
    "longname": "api/nut/nut.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 240,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/nut/nut.events.js",
    "longname": "api/nut/nut.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 241,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/nut/nut.integration.js",
    "memberof": null,
    "longname": "api/nut/nut.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 242,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/nut/nut.integration.js",
    "longname": "api/nut/nut.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 243,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/nut/nut.model.js",
    "memberof": null,
    "longname": "api/nut/nut.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport _ from 'lodash';\nvar Promise = require('bluebird');\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('Nut', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING\n    },\n\tappId: DataTypes.INTEGER,\n\tspaceId: DataTypes.INTEGER,\n\talias: DataTypes.STRING,\n    description: DataTypes.STRING,\n\ttypeId: DataTypes.INTEGER,\n    active: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\t\t  addType: function(typeData){\n\t\t\t  return this.getType(typeData,true);\n\t\t  },\n\t\t  getType: function(typeData,autoCreated){\n\t\t\t  //console.log('in app Category:', Category);\n\t\t\t  //console.log('in app User:', User);\n\t\t\t  //console.log('in app sqldb:', sqldb);\n\t\t\t  var Category = sqldb.Category;\n\t\t\t  //var Category = sqldb.Category;\n\t\t\t  //console.log('in app Category:', Category);\n\t\t\t  if(typeof typeData === 'string' && isNaN(typeData)){\n\t\t\t\t  var typeName = typeData;\n\t\t\t\t  \n\t\t\t\t  typeData = {};\n\t\t\t\t  \n\t\t\t\t  typeData.name = typeName;\n\t\t\t\t  \n\t\t\t\t  //console.log('in space getType');\n\t\t\t\t  //console.log('in space Category:', Category);\n\t\t\t\t  //console.log('space getType typeData:', JSON.stringfy(typeData));\n\t\t\t  }\n\t\t\t  \n\t\t\t  if(typeof typeData === 'object' && !_.isEmpty(typeData)){\n\t\t\t\ttypeData.owner = 'nut';\n\t\t\t\tvar tyName = typeData.name;\n\t\t\t    if(tyName.substr(0,4).toLowerCase() !== 'nut.'){\n\t\t\t\t   tyName = 'nut.' + tyName;\n\t\t\t    }\n\t\t\t\ttypeData.name = tyName;\n\t\t\t\t//console.log('app model typeData:', JSON.stringify(typeData));\n\t\t\t  \treturn Category.getType(typeData, true);\n\t\t\t  }\n\t\t\t  \n\t\t\t  //otherwise return promise reject\n\t\t\t  sequelize.Promise.reject(new Error('fail to add type for nut!'));\n\t\t  },\n\t\t  addBulkNut: function(bulkNutData){\n\n\t\t  \tvar that = this;\n\t\t  \t\n\t\t  \treturn Promise.each(bulkNutData, function(nutData){\n\t\t  \t\tif(nutData.type && !nutData.typeId){\n\t\t  \t\t\tvar typeData = {\n\t\t  \t\t\t\tname: nutData.type,\n\t\t  \t\t\t\tspaceId: nutData.spaceId\n\t\t  \t\t\t};\n\n\t\t  \t\t\treturn that.getType(typeData, true).then(function(type){\n\t\t  \t\t\t\tnutData.typeId = type._id;\n\t\t  \t\t\t\t//console.log('nutData:', nutData);\n\t\t  \t\t\t\treturn Promise.resolve(null);\n\t\t  \t\t\t});\n\t\t  \t\t} else {\n\t\t  \t\t\treturn Promise.resolve(null);\n\t\t  \t\t}\n\t\t  \t}).then(function(){\n\t\t  \t\t//console.log('2 bulkNutData:', JSON.stringify(bulkNutData));\n\t\t  \t\treturn that.bulkCreate(bulkNutData);\n\t\t  \t});\n\n\t\t  }\n\t  },\n  });\n}\n"
  },
  {
    "__docId__": 244,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/nut/nut.model.js",
    "longname": "api/nut/nut.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 245,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "nut",
    "memberof": "api/nut/nut.model.js",
    "longname": "api/nut/nut.model.js~nut",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.model.js",
    "importStyle": "nut",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 246,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/nut/nut.socket.js",
    "memberof": null,
    "longname": "api/nut/nut.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 247,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/nut/nut.socket.js",
    "longname": "api/nut/nut.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 248,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/nut/nut.socket.js",
    "longname": "api/nut/nut.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 249,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/nut/nut.socket.js",
    "longname": "api/nut/nut.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/nut/nut.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 250,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/nut/nut.socket.js",
    "longname": "api/nut/nut.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 251,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/nut/nut.socket.js",
    "longname": "api/nut/nut.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/nut/nut.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 252,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/index.js",
    "memberof": null,
    "longname": "api/permit/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./permit.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/roles', controller.findAllPermitRole);\nrouter.get('/roles/user', controller.findAllUserPermitRole);\nrouter.get('/roles/:id', controller.findPermitRole);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.post('/findOrCreate', controller.findOrCreate);\nrouter.post('/roles', controller.createPermitRole);\nrouter.post('/roles/bulk', controller.addBulkPermitRole);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/roles/:id', controller.destroyPermitRole);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 253,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/permit/index.js",
    "longname": "api/permit/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/permit/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 254,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/permit/index.js",
    "longname": "api/permit/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/permit/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 255,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/permit/index.js",
    "longname": "api/permit/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/permit/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 256,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/index.spec.js",
    "memberof": null,
    "longname": "api/permit/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar permitCtrlStub = {\n  index: 'permitCtrl.index',\n  show: 'permitCtrl.show',\n  create: 'permitCtrl.create',\n  update: 'permitCtrl.update',\n  destroy: 'permitCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar permitIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './permit.controller': permitCtrlStub\n});\n\ndescribe('Permit API Router:', function() {\n\n  it('should return an express router instance', function() {\n    permitIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/permits', function() {\n\n    it('should route to permit.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'permitCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/permits/:id', function() {\n\n    it('should route to permit.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'permitCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/permits', function() {\n\n    it('should route to permit.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'permitCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/permits/:id', function() {\n\n    it('should route to permit.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'permitCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/permits/:id', function() {\n\n    it('should route to permit.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'permitCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/permits/:id', function() {\n\n    it('should route to permit.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'permitCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 257,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/permit/index.spec.js",
    "longname": "api/permit/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/permit/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 258,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "permitCtrlStub",
    "memberof": "api/permit/index.spec.js",
    "longname": "api/permit/index.spec.js~permitCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/permit/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 259,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/permit/index.spec.js",
    "longname": "api/permit/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/permit/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 260,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "permitIndex",
    "memberof": "api/permit/index.spec.js",
    "longname": "api/permit/index.spec.js~permitIndex",
    "access": null,
    "export": false,
    "importPath": "./api/permit/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 261,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/permit.controller.js",
    "memberof": null,
    "longname": "api/permit/permit.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/permits              ->  index\n * POST    /api/permits              ->  create\n * GET     /api/permits/:id          ->  show\n * PUT     /api/permits/:id          ->  update\n * DELETE  /api/permits/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Permit} from '../../sqldb';\nimport {PermitRole} from '../../sqldb';\nimport {Role} from '../../sqldb';\nimport {UserRole} from '../../sqldb';\nvar Promise = require('bluebird');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Permits\nexport function index(req, res) {\n  //console.log('req.body',JSON.stringify(req.query));\n  var mode = 'leaf';\n  if(req.query.mode){\n    mode = req.query.mode;\n    delete req.query.mode;\n  }\n  if(req.query.permitId){\n    return Permit.findById(req.query.permitId).then(function(permit){\n      return permit.getChildren('leaf')\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n    });\n  } else {\n      if(req.query.spaceId){\n        return Permit.getPermitRoot(req.query).then(function(permitRoot){\n          //var findData = req.query;\n          //findData.mode = 'leaf';\n          return permitRoot.getChildren('leaf')\n          .then(respondWithResult(res))\n          .catch(handleError(res));\n        });\n    }\n  }\n\n  //console.log('1');\n\n  //return with error\n  res.status(500).send('fail, please check input!');\n  /*\n  Permit.findAll(req.query)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n    */\n}\n\n// Gets a single Permit from the DB\nexport function show(req, res) {\n  Permit.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Permit in the DB\nexport function create(req, res) {\n  return addPermit(req,res);\n  /*\n  Permit.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));*/\n}\n\n// Creates a new Permit in the DB\nexport function findOrCreate(req, res) {\n  return addPermit(req,res);\n\n  /*\n  console.log('1');\n  return Permit.findOrCreate({\n    where:req.body,\n    defaults: {}\n  }).spread(function(row,created){\n    //console.log('2 created:', created);\n    //console.log('row:',row.get({plain: true}));\n    res.status(200).json(row);\n    //return Promise.resolve(row);\n  })\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n    */\n}\n\n// Updates an existing Permit in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Permit.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Permit from the DB\nexport function destroy(req, res) {\n  Permit.destroy({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Permit from the DB\nexport function destroyPermitRole(req, res) {\n  PermitRole.destroy({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\n\nexport function getPermit(req, res) {\n  var permitData = req.body;\n  Permit.find({\n      include: [{all: true}],\n      where: permitData\n    })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function addPermit(req, res) {\n  var permitData = req.body;\n  Permit.addPermit(permitData)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\nexport function addChild(req, res){\n  //console.log('req params:',req);\n  Role.find({\n    _id: req.params.id\n  })\n  .then(function(role){\n    //console.log('role:',role);\n    role.addChild(req.body).then(respondWithResult(res));\n  })\n  .catch(handleError(res));\n}\n\n// get: api/permits/roles\nexport function findAllPermitRole(req, res){\n\n  var query = req.query;\n\n  PermitRole.belongsTo(Permit,{as: 'permit'});\n  PermitRole.belongsTo(Role,{as: 'role'});\n\n  return PermitRole.findAll({\n    where: query,\n    include: [\n    {\n      model: Permit, as: 'permit'\n    },{\n      model: Role, as: 'role'\n    }]\n  }).then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n//get: api/permits/roles/user, should contain spaceId for find user roles\nexport function findAllUserPermitRole(req, res){\n\n  PermitRole.belongsTo(Permit,{as: 'permit'});\n  PermitRole.belongsTo(Role,{as: 'role'});\n\n  var query = req.query;\n\n  if(!query.spaceId || !query.userId){\n    handleError(res);\n  } else {\n    var whereData = {};\n    whereData.userId = query.userId;\n    whereData.spaceId = query.spaceId;\n\n    delete query.userId;\n    delete query.spaceId;\n\n    UserRole.findAll({\n      where: whereData\n    }).then(function(rows){\n      \n      var or = [];\n      rows.forEach(function(row){\n        or.push({\n          roleId: row.roleId\n        });\n      });\n      query['$or'] = or;\n\n      PermitRole.findAll({\n        where:query,\n        include: [\n         {\n           model: Permit, as: 'permit'\n         },\n         {\n           model: Role, as: 'role'\n         }\n        ]\n      })\n    })\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n  }\n}\n\nexport function findPermitRole(req, res){\n\n  PermitRole.belongsTo(Permit, {as: 'permit'});\n  PermitRole.belongsTo(Role, {as: 'role'});\n  PermitRole.find({\n    where: {\n      _id: req.params.id\n    },\n    include: [\n      {\n        model: Permit, as: 'permit'\n      },\n      {\n        model: Role, as: 'role'\n      }\n    ]\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function createPermitRole(req, res){\n  //console.log(req.body);\n  PermitRole.belongsTo(Permit,{as: 'permit'});\n  PermitRole.belongsTo(Role, {as: 'role'});\n  var body = req.body;\n  var spaceId;\n\n  if(body.spaceId){\n    spaceId = body.spaceId;\n  }\n\n  PermitRole.findOrCreate({\n    where: req.body,\n    defaults: {}\n  })\n    .spread(function(row,created){\n      return PermitRole.find({\n        where: {_id: row._id},\n        include: [{\n          model: Permit, as: 'permit'\n        },\n        {\n          model: Role, as: 'role'\n        }\n        ]\n      })\n    })\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\nexport function addBulkPermitRole(req, res){\n\n  //console.log('body',JSON.stringify(req.body));\n\n  var rows = req.body;\n\n  Promise.map(rows, function(row){\n    return new Promise(function(resolve,reject){\n       if(row.spaceId && row.permit){\n         var permitData = {};\n         if(typeof row.permit === 'object'){\n           permitData = row.permit;\n         }\n         if(typeof row.permit === 'string'){\n           permitData.name = row.permit;\n         }\n         permitData.spaceId = row.spaceId;\n          return Permit.addPermit(permitData).then(function(permit){\n              row.permitId = permit._id;\n              return resolve(permit);\n            })\n        } else {\n          return resolve(null);\n        }\n    }).then(function(){\n      //console.log('2');\n      if(row.spaceId && row.role){\n          return Role.find({\n            where: {\n              spaceId: row.spaceId,\n              fullname: 'root.'+row.role\n            }\n          }).then(function(role){\n              //console.log('role:', JSON.stringify(role));\n              row.roleId = role._id;\n              return Promise.resolve(null);\n          });\n        } else {\n          return Promise.resolve(null);\n        }\n    })\n  }).then(function(){\n    //console.log(3);\n    //console.log('rows:',JSON.stringify(rows));\n    PermitRole.bulkCreate(rows).then(function(){\n        res.send('success');\n    });  \n  });\n}\n"
  },
  {
    "__docId__": 262,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 17,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 263,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 19,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 264,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 28,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 265,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 37,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 266,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 48,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 267,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 58,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 268,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 66,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 269,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 103,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 270,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 115,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 271,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findOrCreate",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~findOrCreate",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{findOrCreate}",
    "description": null,
    "lineNumber": 124,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 272,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 144,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 273,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 160,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 274,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroyPermitRole",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~destroyPermitRole",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{destroyPermitRole}",
    "description": null,
    "lineNumber": 172,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 275,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getPermit",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~getPermit",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{getPermit}",
    "description": null,
    "lineNumber": 184,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 276,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addPermit",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~addPermit",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{addPermit}",
    "description": null,
    "lineNumber": 195,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 277,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addChild",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~addChild",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{addChild}",
    "description": null,
    "lineNumber": 202,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 278,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllPermitRole",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~findAllPermitRole",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{findAllPermitRole}",
    "description": null,
    "lineNumber": 215,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 279,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllUserPermitRole",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~findAllUserPermitRole",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{findAllUserPermitRole}",
    "description": null,
    "lineNumber": 235,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 280,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findPermitRole",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~findPermitRole",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{findPermitRole}",
    "description": null,
    "lineNumber": 281,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 281,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createPermitRole",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~createPermitRole",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{createPermitRole}",
    "description": null,
    "lineNumber": 303,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 282,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addBulkPermitRole",
    "memberof": "api/permit/permit.controller.js",
    "longname": "api/permit/permit.controller.js~addBulkPermitRole",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.controller.js",
    "importStyle": "{addBulkPermitRole}",
    "description": null,
    "lineNumber": 334,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 283,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/permit.events.js",
    "memberof": null,
    "longname": "api/permit/permit.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Permit model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Permit = require('../../sqldb').Permit;\nvar PermitEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nPermitEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Permit.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    PermitEvents.emit(event + ':' + doc._id, doc);\n    PermitEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default PermitEvents;\n"
  },
  {
    "__docId__": 284,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Permit",
    "memberof": "api/permit/permit.events.js",
    "longname": "api/permit/permit.events.js~Permit",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 285,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/permit/permit.events.js",
    "longname": "api/permit/permit.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 286,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/permit/permit.events.js",
    "longname": "api/permit/permit.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 287,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/permit.integration.js",
    "memberof": null,
    "longname": "api/permit/permit.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newPermit;\n\ndescribe('Permit API:', function() {\n\n  describe('GET /api/permits', function() {\n    var permits;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/permits')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          permits = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      permits.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/permits', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/permits')\n        .send({\n          name: 'New Permit',\n          info: 'This is the brand new permit!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newPermit = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created permit', function() {\n      newPermit.name.should.equal('New Permit');\n      newPermit.info.should.equal('This is the brand new permit!!!');\n    });\n\n  });\n\n  describe('GET /api/permits/:id', function() {\n    var permit;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/permits/' + newPermit._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          permit = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      permit = {};\n    });\n\n    it('should respond with the requested permit', function() {\n      permit.name.should.equal('New Permit');\n      permit.info.should.equal('This is the brand new permit!!!');\n    });\n\n  });\n\n  describe('PUT /api/permits/:id', function() {\n    var updatedPermit;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/permits/' + newPermit._id)\n        .send({\n          name: 'Updated Permit',\n          info: 'This is the updated permit!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedPermit = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedPermit = {};\n    });\n\n    it('should respond with the updated permit', function() {\n      updatedPermit.name.should.equal('Updated Permit');\n      updatedPermit.info.should.equal('This is the updated permit!!!');\n    });\n\n  });\n\n  describe('DELETE /api/permits/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/permits/' + newPermit._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when permit does not exist', function(done) {\n      request(app)\n        .delete('/api/permits/' + newPermit._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 288,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/permit/permit.integration.js",
    "longname": "api/permit/permit.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 289,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/permit.model.js",
    "memberof": null,
    "longname": "api/permit/permit.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\nimport TreeTable from '../../sqldb/treeTable';\n\nexport default function (sequelize, DataTypes) {\n  return sequelize.define('Permit', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    parentId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    spaceId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    appId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    name: DataTypes.STRING,\n    alias: DataTypes.STRING,\n    fullname: DataTypes.STRING,\n    value: DataTypes.STRING,\n    owner: DataTypes.STRING,\n    ownerId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    active: DataTypes.BOOLEAN\n  }, {\n    getterMethods: {\n      permitName: function () {\n        var fname = this.fullname;\n        var fname2 = fname.slice(fname.indexOf('.') + 1);\n        return fname2.slice(fname2.indexOf('.') + 1);\n      },\n      name: function () {\n        var fname = this.fullname;\n        var fname2 = fname.slice(fname.indexOf('.') + 1);\n        return fname2.slice(fname2.indexOf('.') + 1);\n      }\n    },\n    classMethods: {\n      getRoot: function () {\n        return this\n          .findOrCreate({\n            where: {\n              name: 'root',\n              fullname: 'root'\n            },\n            defaults: {\n              alias: 'root'\n            }\n          })\n          .spread(function (entity, created) {\n            return Promise.resolve(entity);\n          });\n      },\n      getPermitRoot: function (permitData) {\n        \n        //return this.getRoot();\n\n        var Model = this;\n\n        ///*\n        return this.getRoot().then(function (root) {\n          var whereData = {};\n\n          if (typeof permitData === 'object') {\n            for (var key in permitData) {\n              if (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n                whereData.owner = permitData[key];\n                //delete permitData[key];\n              }\n              if (key.toLowerCase() === 'spaceid') {\n                whereData.spaceId = permitData[key];\n                //delete permitData[key];\n              }\n              if (key.toLowerCase() === 'appid') {\n                whereData.appId = permitData[key];\n                //delete permitData[key];\n              }\n              if (key.toLowerCase() === 'ownerid') {\n                whereData.ownerId = permitData[key];\n                //delete permitData[key];\n              }\n            }\n          }\n\n          whereData.name = 'permit';\n          whereData.fullname = 'root.permit';\n          whereData.parentId = 1;\n\n          //console.log('getPermitRoot root: ', JSON.stringify(root));\n\n          //console.log('getPermitRoot whereData: ', JSON.stringify(whereData));\n\n          return Model.findOrCreate({\n              where: whereData,\n              defaults: {\n                alias: 'permit'\n              }\n            })\n            .spread(function (entity, created) {\n              //console.log('getPermitRoot created: ', created);\n              return Promise.resolve(entity);\n            });\n        });\n      },\n      //this function like findOrCreate\n      /*\n      addPermit: function (permitData) {\n\n        var permitName;\n        var owner;\n        var ownerId;\n        var spaceId;\n        var appId;\n\n        console.log('Permit model permitData:',permitData);\n\n        if (typeof permitData === 'string') {\n          permitName = permitData;\n          permitData = {};\n          permitData.name = permitName;\n        }\n\n        if (typeof permitData === 'object') {\n          //console.log('permitData 2: ', permitData);\n          for (var key in permitData) {\n            if (key.toLowerCase() === 'name' || key.toLowerCase() === 'permitname') {\n              permitName = permitData[key];\n              delete permitData[key];\n            }\n            if (key.toLowerCase() === 'owner') {\n              owner = permitData[key];\n              delete permitData[key];\n            }\n            if (key.toLowerCase() === 'ownerid') {\n              ownerId = permitData[key];\n              delete permitData[key];\n            }\n            if (key.toLowerCase() === 'spaceid') {\n              spaceId = permitData[key];\n              delete permitData[key];\n            }\n            if (key.toLowerCase() === 'appid') {\n              appId = permitData[key];\n              delete permitData[key];\n            }\n          }\n        }\n        //console.log('permitName:',permitName);\n\n        var permitContext = {};\n\n        if (owner) {\n          permitContext.owner = owner;\n        }\n        if (ownerId && ownerId !== -1) {\n          permitContext.ownerId = ownerId;\n        }\n        if (spaceId && spaceId !== -1) {\n          permitContext.spaceId = spaceId;\n        }\n        if (appId && appId !== -1) {\n          permitContext.appId = appId;\n        }\n\n        if (permitName) {\n          var names = permitName.split('.');\n          //console.log('names:', names);\n          //console.log('permitData:',permitData);\n          //console.log('permitContext:',permitContext);\n\n          var Model = this;\n\n          return this.getPermitRoot(permitContext)\n            .then(function (permitRoot) {\n              //console.log('permitRoot:',permitRoot);\n              var parentId = permitRoot.parentId;\n              var fullname = permitRoot.fullname;\n              var finalPermit;\n              return Promise.reduce(names, function (finalPermit, tName) {\n                  permitData.alias = permitData.alias || tName;\n                  permitContext.name = tName;\n                  permitContext.fullname = fullname + '.' + tName;\n                  permitContext.parentId = parentId;\n                  //console.log('name: ',tName);\n                  //console.log('fullName: ',fullname);\n                  //console.log('parentId: ',parentId);\n                  //console.log('permitContext',JSON.stringify(permitContext));\n                  return Model.findOrCreate({\n                      where: permitContext,\n                      defaults: permitData\n                    })\n                    .spread(function (thePermit, created) {\n                      parentId = thePermit.parentId;\n                      fullname = thePermit.fullname;\n                      return finalPermit = thePermit;\n                      //console.log('finalPermit:', finalPermit);\n                      //Promise.resolve(finalPermit);\n                    });\n                }, 0)\n                .then(function (finalPermit) {\n                  //console.log('promise.map finalPermit: ',finalPermit);\n                  return Promise.resolve(finalPermit);\n                });\n            });\n        }\n\n        return Promise.reject(new Error('fail to add permit!'));\n      },*/\n      addPermit: function (permitData) {\n\n        //console.log('Permit model permitData:',permitData);\n\n        var treeObj = new TreeTable();\n         return this.getPermitRoot(permitData).then(function (permitRoot) {\n           //console.log('permitRoot:',JSON.stringify(permitRoot));\n            return treeObj.addChild(permitRoot,permitData).then(function (child) {\n              //console.log(\"permit model child:\",JSON.stringify(child));\n              return Promise.resolve(child);\n            }); \n         }); \n      },\n      getPermit: function (permitData) {\n        var that = this;\n        if ( permitData && !isNaN(permitData)){\n          return that.findById(permitData);\n        }\n\n        if( typeof permitData === 'object'){\n          return this.getPermitRoot(permitData).then(function(permitRoot){\n            return permitRoot.getChild(permitData);\n          });\n        }\n      },\n      /*\n      getPermit: function (permitData) {\n        var whereData = {};\n        if (typeof permitData === 'object') {\n          for (var key in permitData) {\n            if (key.toLowerCase() === 'spaceid') {\n              whereData.spaceId = permitData[key];\n            }\n          }\n        }\n        if (whereData.hasOwnProperty('spaceId') && whereData.hasOwnProperty('appId')) {\n          return this.findAll({\n            include: [{all: true}],\n            where: whereData\n          })\n        }\n      },*/\n      getPermits: function () {\n      }\n    },\n    instanceMethods: {\n      addChild: function (childData) {\n        var treeObj = new TreeTable();\n        return treeObj.addChild(this, childData);\n      },\n      getChildren: function (childData) {\n        var treeObj = new TreeTable();\n        return treeObj.getChildren(this, childData);\n      },\n      getChild: function (childData) {\n        var treeObj = new TreeTable();\n        return treeObj.getChild(this, childData);\n      },\n      getParent: function (recursive) {\n        var treeObj = new TreeTable();\n        return treeObj.getParent(this, recursive);\n      },\n      childCount: function () {\n        var treeObj = new TreeTable();\n        return treeObj.childCount(this);\n      },\n      isParentOf: function (childObj, recursive) {\n        var treeObj = new TreeTable();\n        return treeObj.isParentOf(childObj, this, recursive);\n      },\n      isChildOf: function (parentObj, recursive) {\n        var treeObj = new TreeTable();\n        return treeObj.isChildOf(parentObj, this, childData);\n      }\n    }\n  });\n}\n"
  },
  {
    "__docId__": 290,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/permit/permit.model.js",
    "longname": "api/permit/permit.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 291,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "permit",
    "memberof": "api/permit/permit.model.js",
    "longname": "api/permit/permit.model.js~permit",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.model.js",
    "importStyle": "permit",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 292,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/permit.socket.js",
    "memberof": null,
    "longname": "api/permit/permit.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar PermitEvents = require('./permit.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('permit:' + event, socket);\n\n    PermitEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    PermitEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 293,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "PermitEvents",
    "memberof": "api/permit/permit.socket.js",
    "longname": "api/permit/permit.socket.js~PermitEvents",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 294,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/permit/permit.socket.js",
    "longname": "api/permit/permit.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 295,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/permit/permit.socket.js",
    "longname": "api/permit/permit.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permit.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 296,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/permit/permit.socket.js",
    "longname": "api/permit/permit.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 297,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/permit/permit.socket.js",
    "longname": "api/permit/permit.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permit.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 298,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/permit/permitRole.model.js",
    "memberof": null,
    "longname": "api/permit/permitRole.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nimport sqldb from '../../sqldb';\nvar Promise = require(\"bluebird\");\n\nexport default function(sequelize, DataTypes) {\n\treturn sequelize.define('PermitRole', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\towner: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\townerId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tpermitId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\troleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t},{\n\t\tclassMethods: {\n\n\t\t\taddPermitRole: function(permitRoleData){\n\n\t\t\t},\n\n\t\t\taddBulkPermitRole: function(bulkPermitRoleData){\n\n\t\t\t\tvar PermitModel = sqldb.Permit;\n\t\t\t\tvar RoleModel = sqldb.Role;\n\t\t\t\tvar that = this;\n\t\t\t\t\n\t\t\t\t//console.log('bulkData:', JSON.stringify(bulkPermitRoleData));\n\n\t\t\t\t/*\n\t\t\t\tvar proms = [];\n\n\t\t\t\tconsole.log('0');\n\n\t\t\t\tbulkPermitRoleData.forEach(function(prd){\n\n\t\t\t\t\tif(prd.permit && !prd.permitId){\n\t\t\t\t\t\tvar permitData = {};\n\t\t\t\t\t\tpermitData.name = prd.permit;\n\t\t\t\t\t\tpermitData.spaceId = prd.spaceId;\n\t\t\t\t\t\tproms.push(PermitModel.addPermit(permitData).then(function(permit){\n\t\t\t\t\t\t\tprd.permitId = permit._id;\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\n\t\t\t\t\tif(prd.role && !prd.roleId){\n\t\t\t\t\t\tvar roleData = {};\n\t\t\t\t\t\troleData.name = prd.permit;\n\t\t\t\t\t\troleData.spaceId = prd.spaceId;\n\t\t\t\t\t\tproms.push(RoleModel.addRole(roleData).then(function(role){\n\t\t\t\t\t\t\tprd.roleId = role._id;\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t});\n\n\t\t\t\tif(proms.length >0){\n\t\t\t\t\tconsole.log('proms:',proms);\n\t\t\t\t\tconsole.log('1 bulkPermitRoleData:',JSON.stringify(bulkPermitRoleData));\n\t\t\t\t\tPromise.all(proms).then(function(){\n\t\t\t\t\t\tconsole.log('2 bulkPermitRoleData:',JSON.stringify(bulkPermitRoleData));\n\t\t\t\t\t\treturn that.bulkCreate(bulkPermitRoleData);\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\treturn that.bulkCreate(bulkPermitRoleData);\n\t\t\t\t} */\n\n\n\t\t\t\tconsole.log('1 bulkPermitRoleData:', JSON.stringify(bulkPermitRoleData));\t\t\t\t\n\n\t\t\t\treturn Promise.each(bulkPermitRoleData, function(prData){\n\n\t\t\t\t\t//console.log('2 prData:',JSON.stringify(prData));\n\t\t\t\t\t//var prData = Object.assign({},pr);\n\n\t\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\t\t//console.log('3');\n\t\t\t\t\t\tconsole.log('1 prData:',JSON.stringify(prData));\n\t\t\t\t\t\tif(prData.permit && ! prData.permitId){\n\t\t\t\t\t\t\tvar permitData = {};\n\t\t\t\t\t\t\tif(typeof prData.permit === 'object'){\n\t\t\t\t\t\t\t\tpermitData = Object.assign({},prData.permit);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(typeof prData.permit === 'string'){\n\t\t\t\t\t\t\t\tpermitData.name = prData.permit;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//permitData.name = prData.permit;\n\t\t\t\t\t\t\tpermitData.spaceId = prData.spaceId;\n\t\t\t\t\t\t\tif(prData.owner){\n\t\t\t\t\t\t\t\tpermitData.owner = prData.owner;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(prData.ownerId){\n\t\t\t\t\t\t\t\tpermitData.ownerId = prData.ownerId;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconsole.log('permitData',JSON.stringify(permitData));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn PermitModel.addPermit(permitData).then(function(permit){\n\t\t\t\t\t\t\t\tprData.permitId = permit._id;\n\t\t\t\t\t\t\t\treturn resolve(null);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn resolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(function(){\n\t\t\t\t\t\tconsole.log('2 prData:',JSON.stringify(prData));\n\t\t\t\t\t\t//console.log('4 bulkPermitRoleData:', JSON.stringify(bulkPermitRoleData));\n\t\t\t\t\t\tif(prData.role && ! prData.roleId){\n\t\t\t\t\t\t\tvar roleData = {};\n\t\t\t\t\t\t\tif(typeof prData.role === 'object'){\n\t\t\t\t\t\t\t\troleData = Object.assign({},prData.role);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(typeof prData.role === 'string'){\n\t\t\t\t\t\t\t\troleData.name = prData.role;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\troleData.spaceId = prData.spaceId;\n\n\t\t\t\t\t\t\tconsole.log('roleData:',JSON.stringify(roleData));\n\n\t\t\t\t\t\t\treturn RoleModel.addRole(roleData).then(function(role){\n\t\t\t\t\t\t\t\t//console.log('role:',JSON.stringify(role));\n\t\t\t\t\t\t\t\tprData.roleId = role._id;\n\t\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\t//console.log('bulkPermitRoleData:', JSON.stringify(bulkPermitRoleData));\n\t\t\t\t\treturn that.bulkCreate(bulkPermitRoleData);\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t});\n}\n"
  },
  {
    "__docId__": 299,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/permit/permitRole.model.js",
    "longname": "api/permit/permitRole.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/permit/permitRole.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 300,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "permitRole",
    "memberof": "api/permit/permitRole.model.js",
    "longname": "api/permit/permitRole.model.js~permitRole",
    "access": null,
    "export": true,
    "importPath": "./api/permit/permitRole.model.js",
    "importStyle": "permitRole",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 301,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/index.js",
    "memberof": null,
    "longname": "api/point/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./voucher.controller');\n\nvar router = express.Router();\n\n//default function for voucher table\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\n//for user voucher table\nrouter.get('/vuser', controller.findAllUserVoucher);\nrouter.get('/:id/vuser', controller.findUserVoucher);\nrouter.post('/vuser/', controller.createUserVoucher);\nrouter.put('/:id/vuser', controller.updateUserVoucher);\nrouter.delete('/:id/vuser', controller.deleteUserVoucher);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 302,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/point/index.js",
    "longname": "api/point/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/point/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 303,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/point/index.js",
    "longname": "api/point/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/point/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 304,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/point/index.js",
    "longname": "api/point/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/point/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 305,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/index.spec.js",
    "memberof": null,
    "longname": "api/point/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 306,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/point/index.spec.js",
    "longname": "api/point/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/point/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 307,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/point/index.spec.js",
    "longname": "api/point/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/point/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 308,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/point/index.spec.js",
    "longname": "api/point/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/point/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 309,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/point/index.spec.js",
    "longname": "api/point/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/point/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 310,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/point.controller.js",
    "memberof": null,
    "longname": "api/point/point.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Nut} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Nuts\nexport function index(req, res) {\n  Nut.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Nut from the DB\nexport function show(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Nut in the DB\nexport function create(req, res) {\n    //console.log('Nut create req.body:', JSON.stringify(req.body));\n    var nutData = req.body;\n    var typeName;\n    for(var key in nutData){\n  \t  if(key.toLowerCase() === 'type' || key.toLowerCase() === 'typename'){\n  \t\t  typeName = nutData[key];\n  \t\t  delete nutData[key]; \n  \t  }\n    }\n\t\n\tif(nutData.name){\n\t\tvar nutName = nutData.name;\n\t\tdelete nutData.name;\n\t}\n  \n    if(typeName && nutName){\n\t\tconsole.log('create nut typeName:',typeName);\n  \t  Nut.addType(typeName).then(function(type){\n  \t\t  nutData.typeId = type._id;\n  \t      Nut.findOrCreate({\n\t\t\t  where: {name: nutName},\n\t\t\t  defaults:nutData})\n  \t      .then(respondWithResult(res, 201))\n  \t      .catch(handleError(res));\n  \t  })\n    } else {\n\t      Nut.findOrCreate({\n\t\t  \t\twhere: {name: nutName},\n\t\t  \t\tdefaults:nutData})\n\t      \t.then(respondWithResult(res, 201))\n\t      \t.catch(handleError(res));\n    } \n}\n\n// Updates an existing Nut in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Nut from the DB\nexport function destroy(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function findOrCreate(req, res){\n\t\n}\n"
  },
  {
    "__docId__": 311,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 312,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 313,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 314,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 44,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 315,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 316,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/point/point.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 317,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/point/point.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 318,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/point/point.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 319,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/point/point.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 117,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 320,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/point/point.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 133,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 321,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findOrCreate",
    "memberof": "api/point/point.controller.js",
    "longname": "api/point/point.controller.js~findOrCreate",
    "access": null,
    "export": true,
    "importPath": "./api/point/point.controller.js",
    "importStyle": "{findOrCreate}",
    "description": null,
    "lineNumber": 144,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 322,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/point.events.js",
    "memberof": null,
    "longname": "api/point/point.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 323,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/point/point.events.js",
    "longname": "api/point/point.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 324,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/point/point.events.js",
    "longname": "api/point/point.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 325,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/point/point.events.js",
    "longname": "api/point/point.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 326,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/point.integration.js",
    "memberof": null,
    "longname": "api/point/point.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 327,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/point/point.integration.js",
    "longname": "api/point/point.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 328,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/point.socket.js",
    "memberof": null,
    "longname": "api/point/point.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 329,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/point/point.socket.js",
    "longname": "api/point/point.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 330,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/point/point.socket.js",
    "longname": "api/point/point.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 331,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/point/point.socket.js",
    "longname": "api/point/point.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/point/point.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 332,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/point/point.socket.js",
    "longname": "api/point/point.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 333,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/point/point.socket.js",
    "longname": "api/point/point.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/point/point.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 334,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/pointAccount.model.js",
    "memberof": null,
    "longname": "api/point/pointAccount.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('PointAccount', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING\n    },\n\talias: DataTypes.STRING,\n\tdescription: DataTypes.STRING,\n\townerType: DataTypes.STRING,\n\townerId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tspaceId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tcircleId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\ttypeId: DataTypes.INTEGER,\n    active: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\t\t  \n\t  },\n  });\n}\n"
  },
  {
    "__docId__": 335,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "pointAccount",
    "memberof": "api/point/pointAccount.model.js",
    "longname": "api/point/pointAccount.model.js~pointAccount",
    "access": null,
    "export": true,
    "importPath": "./api/point/pointAccount.model.js",
    "importStyle": "pointAccount",
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 336,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/point/pointPermit.model.js",
    "memberof": null,
    "longname": "api/point/pointPermit.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\n\n/*\n * this model define permit for operation on PermitAccount table, permit may include\n * pointPermit.allow.addPoint, pointPermit.allow.deductPoint, pointPermit.allow.cashing\n * sometime, may also limit to some app, space and event nut\n * for example: \n * blynPoint is default point for space, can be added in each space, blow row should added for permit\n * {permit: allow.addPoint, nutId: blynPoint id, fromSpace : any, ...}\n */\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('PointPermit', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n\tpermitId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tnutId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tfromUserId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tfromRoleId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tfromNut: {\n\t\ttype: DataTypes.STRING\n\t},\n\tformAppId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tfromSpaceId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tfromCircleId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\t \n    active: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\t\t  \n\t  },\n  });\n}\n"
  },
  {
    "__docId__": 337,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "pointPermit",
    "memberof": "api/point/pointPermit.model.js",
    "longname": "api/point/pointPermit.model.js~pointPermit",
    "access": null,
    "export": true,
    "importPath": "./api/point/pointPermit.model.js",
    "importStyle": "pointPermit",
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 338,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/index.js",
    "memberof": null,
    "longname": "api/product/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./voucher.controller');\n\nvar router = express.Router();\n\n//default function for voucher table\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\n//for user voucher table\nrouter.get('/vuser', controller.findAllUserVoucher);\nrouter.get('/:id/vuser', controller.findUserVoucher);\nrouter.post('/vuser/', controller.createUserVoucher);\nrouter.put('/:id/vuser', controller.updateUserVoucher);\nrouter.delete('/:id/vuser', controller.deleteUserVoucher);\n\n//for group trade table\nrouter.get('/gtrade', controller.findAllGroupTrade);\nrouter.get('/:id/gtrade', controller.findGroupTrade);\nrouter.post('/gtrade/', controller.createGroupTrade);\nrouter.put('/:id/gtrade', controller.updateGroupTrade);\nrouter.delete('/:id/gtrade', controller.deleteGroupTrade);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 339,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/product/index.js",
    "longname": "api/product/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/product/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 340,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/product/index.js",
    "longname": "api/product/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/product/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 341,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/product/index.js",
    "longname": "api/product/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/product/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 342,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/index.spec.js",
    "memberof": null,
    "longname": "api/product/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 343,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/product/index.spec.js",
    "longname": "api/product/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/product/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 344,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/product/index.spec.js",
    "longname": "api/product/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/product/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 345,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/product/index.spec.js",
    "longname": "api/product/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/product/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 346,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/product/index.spec.js",
    "longname": "api/product/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/product/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 347,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/product.controller.js",
    "memberof": null,
    "longname": "api/product/product.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Nut} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Nuts\nexport function index(req, res) {\n  Nut.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Nut from the DB\nexport function show(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Nut in the DB\nexport function create(req, res) {\n    //console.log('Nut create req.body:', JSON.stringify(req.body));\n    var nutData = req.body;\n    var typeName;\n    for(var key in nutData){\n  \t  if(key.toLowerCase() === 'type' || key.toLowerCase() === 'typename'){\n  \t\t  typeName = nutData[key];\n  \t\t  delete nutData[key]; \n  \t  }\n    }\n\t\n\tif(nutData.name){\n\t\tvar nutName = nutData.name;\n\t\tdelete nutData.name;\n\t}\n  \n    if(typeName && nutName){\n\t\tconsole.log('create nut typeName:',typeName);\n  \t  Nut.addType(typeName).then(function(type){\n  \t\t  nutData.typeId = type._id;\n  \t      Nut.findOrCreate({\n\t\t\t  where: {name: nutName},\n\t\t\t  defaults:nutData})\n  \t      .then(respondWithResult(res, 201))\n  \t      .catch(handleError(res));\n  \t  })\n    } else {\n\t      Nut.findOrCreate({\n\t\t  \t\twhere: {name: nutName},\n\t\t  \t\tdefaults:nutData})\n\t      \t.then(respondWithResult(res, 201))\n\t      \t.catch(handleError(res));\n    } \n}\n\n// Updates an existing Nut in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Nut from the DB\nexport function destroy(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function findOrCreate(req, res){\n\t\n}\n"
  },
  {
    "__docId__": 348,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 349,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 350,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 351,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 44,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 352,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 353,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 354,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 355,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 356,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 117,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 357,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 133,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 358,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findOrCreate",
    "memberof": "api/product/product.controller.js",
    "longname": "api/product/product.controller.js~findOrCreate",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.controller.js",
    "importStyle": "{findOrCreate}",
    "description": null,
    "lineNumber": 144,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 359,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/product.events.js",
    "memberof": null,
    "longname": "api/product/product.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 360,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/product/product.events.js",
    "longname": "api/product/product.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 361,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/product/product.events.js",
    "longname": "api/product/product.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 362,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/product/product.events.js",
    "longname": "api/product/product.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 363,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/product.integration.js",
    "memberof": null,
    "longname": "api/product/product.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 364,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/product/product.integration.js",
    "longname": "api/product/product.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 365,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/product.model.js",
    "memberof": null,
    "longname": "api/product/product.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport _ from 'lodash';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('Product', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n\t\tparentId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n    name: {\n      type: DataTypes.STRING\n    },\n\t\tfullname: {\n      type: DataTypes.STRING\n    },\n\t\talias: DataTypes.STRING,\n\t\tdescription: DataTypes.STRING,\n\t\tdata: DataTypes.TEXT,\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcircleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\ttypeId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\t\t  \n\t  },\n  });\n}\n"
  },
  {
    "__docId__": 366,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "product",
    "memberof": "api/product/product.model.js",
    "longname": "api/product/product.model.js~product",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.model.js",
    "importStyle": "product",
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 367,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/product.socket.js",
    "memberof": null,
    "longname": "api/product/product.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 368,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/product/product.socket.js",
    "longname": "api/product/product.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 369,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/product/product.socket.js",
    "longname": "api/product/product.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 370,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/product/product.socket.js",
    "longname": "api/product/product.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/product/product.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 371,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/product/product.socket.js",
    "longname": "api/product/product.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 372,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/product/product.socket.js",
    "longname": "api/product/product.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/product/product.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 373,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/product/productSpec.model.js",
    "memberof": null,
    "longname": "api/product/productSpec.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport _ from 'lodash';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('ProductSpec', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n\t\tparentId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n    name: {\n      type: DataTypes.STRING\n    },\n\t\tfullname: {\n      type: DataTypes.STRING\n    },\n\t\talias: DataTypes.STRING,\n\t\tvalue: DataTypes.STRING,\n\t\tdescription: DataTypes.STRING,\n\t\tdata: DataTypes.TEXT,\n\t\towner: DataTypes.STRING,\n\t\townerId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\ttypeId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\t\t  \n\t  },\n  });\n}\n"
  },
  {
    "__docId__": 374,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "productSpec",
    "memberof": "api/product/productSpec.model.js",
    "longname": "api/product/productSpec.model.js~productSpec",
    "access": null,
    "export": true,
    "importPath": "./api/product/productSpec.model.js",
    "importStyle": "productSpec",
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 375,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/index.js",
    "memberof": null,
    "longname": "api/role/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./role.controller');\n\nvar router = express.Router();\n\n//get space roles format: /roles?spaceId=xxxx\n//get user roles format: /roles?userId=xxxx\n//get user roles in space format: /roles?userId=xxxx&spaceId=xxxx\nrouter.get('/', controller.index);\n\n//get role by name: /roles/name?spaceId=xxx&role=xxx[or name=xxx]\nrouter.get('/name', controller.getRole);\nrouter.get('/user/space', controller.findAllUserSpaceRole);\n\n//get role by Id: id = number\nrouter.get('/:id', controller.getRole);\n\n//get role children, url format: /roles/:id/children?mode=leaf[child,all]\nrouter.get('/:id/children', controller.getChildren);\n\n//add user role: post data format: {userId: xxx, roleId: xxxx [role: xxx]}\nrouter.post('/user', controller.addUserRole);\n\n//add batch user role: post data format: [{userId: xxx, roleId: xxxx [role: xxx]},...]\nrouter.post('/users/batch', controller.batchAddUserRole);\n\n//add roles, post format: [{name:xxx,spaceId:xxxx},....]\nrouter.post('/batch', controller.batchAdd);\n\n//add grants\nrouter.post('/grants', controller.addGrants);\n\n//add child role, findOrCreate\nrouter.post('/:id', controller.addChild);\n\n//post data format: {spaceId=xxx,name=xxx}\nrouter.post('/', controller.create);\n\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 376,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/role/index.js",
    "longname": "api/role/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/role/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 377,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/role/index.js",
    "longname": "api/role/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/role/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 378,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/role/index.js",
    "longname": "api/role/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/role/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 379,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/index.spec.js",
    "memberof": null,
    "longname": "api/role/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar roleCtrlStub = {\n  index: 'roleCtrl.index',\n  show: 'roleCtrl.show',\n  create: 'roleCtrl.create',\n  update: 'roleCtrl.update',\n  destroy: 'roleCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar roleIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './role.controller': roleCtrlStub\n});\n\ndescribe('Role API Router:', function() {\n\n  it('should return an express router instance', function() {\n    roleIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/roles', function() {\n\n    it('should route to role.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'roleCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/roles/:id', function() {\n\n    it('should route to role.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'roleCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/roles', function() {\n\n    it('should route to role.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'roleCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/roles/:id', function() {\n\n    it('should route to role.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'roleCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/roles/:id', function() {\n\n    it('should route to role.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'roleCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/roles/:id', function() {\n\n    it('should route to role.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'roleCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 380,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/role/index.spec.js",
    "longname": "api/role/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 381,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "roleCtrlStub",
    "memberof": "api/role/index.spec.js",
    "longname": "api/role/index.spec.js~roleCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 382,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/role/index.spec.js",
    "longname": "api/role/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 383,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "roleIndex",
    "memberof": "api/role/index.spec.js",
    "longname": "api/role/index.spec.js~roleIndex",
    "access": null,
    "export": false,
    "importPath": "./api/role/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 384,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/role.controller.js",
    "memberof": null,
    "longname": "api/role/role.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/roles              ->  index\n * POST    /api/roles              ->  create\n * GET     /api/roles/:id          ->  show\n * PUT     /api/roles/:id          ->  update\n * DELETE  /api/roles/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Role} from '../../sqldb';\nimport {UserRole} from '../../sqldb';\nimport {Space} from '../../sqldb';\nimport {Category} from '../../sqldb';\nvar Promise = require('bluebird');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function (entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function (entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Roles\nexport function index(req, res) {\n\n  var query = req.query;\n\n  if (!_.isEmpty(query)) {\n\n    if (query.userId && query.userId > 0) {\n      return findUserRoles(req, res);\n    }\n\n    Role.getRoles(query)\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n\n  } else {\n    res.status(500).send('error, please check params!');\n  }\n\n}\n\n// Gets a single Role from the DB\nexport function show(req, res) {\n  Role.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Role in the DB\nexport function create(req, res) {\n  //Role.create(req.body)\n  Role.addRole(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Role in the DB\nexport function update(req, res) {\n  //return create(req, res);\n  ///*\n  var roleId;\n  if (req.body._id) {\n    roleId = req.body._id;\n  }\n  if (req.params.id) {\n    roleId = req.params.id;\n  }\n  if (roleId) {\n    Role.find({\n      where: {\n        _id: roleId\n      }\n    })\n      .then(handleEntityNotFound(res))\n      .then(saveUpdates(req.body))\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n}\n\n// Deletes a Role from the DB\nexport function destroy(req, res) {\n  Role.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function getRole(req, res) {\n\n  var whereData = {};\n\n  if (req.params.id) {\n    var id = req.params.id;\n    if (isNaN(id)) {\n      whereData.fullname = 'root.role.' + req.params.id;\n    } else {\n      whereData._id = req.params.id;\n    }\n  }\n  if (req.params.name) {\n    whereData.fullname = 'root.role.' + req.params.name;\n  }\n  if (req.query) {\n    if (req.query.spaceId) {\n      whereData.spaceId = req.query.spaceId;\n    }\n    if (req.query.name) {\n      whereData.fullname = 'root.role.' + req.query.name;\n    }\n  }\n  Role.find({\n    where: whereData\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function addRole(req, res) {\n\n  req.body.spaceId = req.params.spaceId;\n  Role.addRole(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\nexport function addChild(req, res) {\n  //console.log('1');\n  //console.log('req.body:',console.log(JSON.stringify(req.body)));\n  Role.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(function (role) {\n      //console.log('role:',role);\n      role.addChild(req.body).then(respondWithResult(res));\n    })\n    .catch(handleError(res));\n}\n\nexport function getSpaceRoles(req, res) {\n\n  Role.findAll({\n    where: {\n      spaceId: req.params.spaceId\n    }\n  }).then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// post: /api/roles/user\nexport function addUserRole(req, res) {\n\n  var rId, uId, rName, spaceId;\n\n  var body = req.body;\n\n  if (body.roleId && body.roleId > 0) {\n    rId = body.roleId;\n  }\n  if (body.userId && body.userId > 0) {\n    uId = body.userId;\n  }\n  if (body.spaceId && body.spaceId > 0) {\n    spaceId = body.spaceId;\n  }\n  if (!_.isNull(body.role)) {\n    rName = body.role;\n  }\n  if (!_.isNull(body.name)) {\n    rName = body.name;\n  }\n\n  if (rId > 0 && uId > 0 && spaceId > 0) {\n    return UserRole.findOrCreate({\n      where: {\n        roleId: rId,\n        userId: uId,\n        spaceId: spaceId\n      },\n      defaults: {}\n    }).spread(function (row, created) {\n      return Promise.resolve(row);\n    })\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n\n  if (rId > 0 && uId > 0) {\n    return Role.findById(rId)\n      .then(function (role) {\n        UserRole.findOrCreate({\n          where: {\n            roleId: rId,\n            userId: uId,\n            spaceId: role.spaceId\n          },\n          defaults: {}\n        }).spread(function (row, created) {\n          return Promise.resolve(row);\n        })\n          .then(respondWithResult(res))\n          .catch(handleError(res));\n      });\n  }\n\n  if (!_.isNull(rName) && !_.isNull(spaceId) && uId > 0) {\n\n    return Role.findOrCreate({\n      where: {\n        spaceId: spaceId,\n        fullname: 'root.role.' + rName\n      }\n    }).spread(function (role, created) {\n      UserRole.findOrCreate({\n        where: {\n          roleId: role._id,\n          userId: uId,\n          spaceId: spaceId\n        },\n        defaults: {}\n      }).spread(function (row, created) {\n        return Promise.resolve(row);\n      })\n        .then(respondWithResult(res))\n        .catch(handleError(res));\n    });\n  }\n\n  //if not find spaceId, find spaceId in role first\n  /*\n\tif(!req.body.spaceId){\n\t\tRole.findById(req.body.roleId)\n\t\t.then(function(role){\n\t\t\tUserRole.create(req.body)\n\t\t\t.then(respondWithResult(res))\n\t\t\t.catch(handleError(res));\n\t\t});\n\t} else {\n\t\tUserRole.create(req.body)\n\t\t.then(respondWithResult(res))\n\t\t.catch(handleError(res));\n\t}*/\n}\n\nexport function batchAddUserRole(req, res) {\n  //console.log('req.body:',JSON.stringify(req.body));\n  return UserRole.batchAdd(req.body)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function getChildren(req, res) {\n\n  var parentId, parent, spaceId;\n\n  if (req.params.id) {\n    var id = req.params.id;\n    if (isNaN(id)) {\n      parent = 'root.role.' + req.params.id;\n    } else {\n      parentId = req.params.id;\n    }\n  }\n  if (req.params.name) {\n    parent = 'root.role.' + req.params.name;\n  }\n  if (req.query) {\n    if (req.query.spaceId) {\n      spaceId = req.query.spaceId;\n    }\n    if (req.query.name) {\n      parent = 'root.role.' + req.query.name;\n    }\n  }\n  var whereData = {};\n\n  if (parentId === undefined && spaceId === undefined) {\n    res.status(500).send('error, please provide spaceId or parentId!');\n  }\n\n  if (spaceId !== undefined) {\n    whereData.spaceId = spaceId;\n  }\n  if (parentId !== undefined) {\n    whereData.parentId = parentId;\n  }\n  if (parent !== undefined) {\n    whereData.fullname = { $like: parent + '.%' }\n  }\n\n  console.log('getChildren whereData:', JSON.stringify(whereData));\n\n  Role.findAll({\n    where: whereData\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function batchAdd(req, res) {\n\n}\n\nexport function findUserRoles(req, res) {\n\n  UserRole.belongsTo(Role, { as: 'role' });\n  Role.belongsTo(Space, { as: 'space' });\n  Space.belongsTo(Category, { as: 'type' });\n\n  var query = req.query;\n\n  console.log('query:', JSON.stringify(query));\n\n  if (!_.isEmpty(query) && query.userId && query.userId > 0) {\n\n    UserRole.findAll({\n      where: query,\n      group: 'roleId',\n      include: [{\n        model: Role, as: 'role',\n        include: {\n          model: Space, as: 'space',\n          include: {\n            model: Category, as: 'type'\n          }\n        }\n      }]\n    }).then(function (rows) {\n      var roles = [];\n\n      rows.forEach(function (row) {\n        roles.push(row.role);\n      });\n\n      return Promise.resolve(roles);\n\n    })\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n}\n\nexport function addGrants(req, res) {\n  //console.log(1);\n  //console.log('addGrants req.body', JSON.stringify(req.body));\n  Role.addGrants(req.body.grants, req.body.ownerData)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function findAllUserSpaceRole(req, res) {\n  Role.findAllUserSpaceRole(req.query.userId, req.query.spaceId)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}"
  },
  {
    "__docId__": 385,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 17,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 386,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 19,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 387,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 28,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 388,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 37,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 389,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 48,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 390,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 58,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 391,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 66,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 392,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 87,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 393,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 99,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 394,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 107,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 395,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 131,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 396,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getRole",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~getRole",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{getRole}",
    "description": null,
    "lineNumber": 142,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 397,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addRole",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~addRole",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{addRole}",
    "description": null,
    "lineNumber": 173,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 398,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addChild",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~addChild",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{addChild}",
    "description": null,
    "lineNumber": 181,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 399,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getSpaceRoles",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~getSpaceRoles",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{getSpaceRoles}",
    "description": null,
    "lineNumber": 196,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 400,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addUserRole",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~addUserRole",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{addUserRole}",
    "description": null,
    "lineNumber": 207,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 401,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "batchAddUserRole",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~batchAddUserRole",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{batchAddUserRole}",
    "description": null,
    "lineNumber": 301,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 402,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getChildren",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~getChildren",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{getChildren}",
    "description": null,
    "lineNumber": 308,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 403,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "batchAdd",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~batchAdd",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{batchAdd}",
    "description": null,
    "lineNumber": 357,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 404,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findUserRoles",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~findUserRoles",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{findUserRoles}",
    "description": null,
    "lineNumber": 361,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 405,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addGrants",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~addGrants",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{addGrants}",
    "description": null,
    "lineNumber": 400,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 406,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllUserSpaceRole",
    "memberof": "api/role/role.controller.js",
    "longname": "api/role/role.controller.js~findAllUserSpaceRole",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.controller.js",
    "importStyle": "{findAllUserSpaceRole}",
    "description": null,
    "lineNumber": 408,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 407,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/role.events.js",
    "memberof": null,
    "longname": "api/role/role.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Role model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Role = require('../../sqldb').Role;\nvar RoleEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nRoleEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Role.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    RoleEvents.emit(event + ':' + doc._id, doc);\n    RoleEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default RoleEvents;\n"
  },
  {
    "__docId__": 408,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Role",
    "memberof": "api/role/role.events.js",
    "longname": "api/role/role.events.js~Role",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 409,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/role/role.events.js",
    "longname": "api/role/role.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 410,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/role/role.events.js",
    "longname": "api/role/role.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 411,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/role.integration.js",
    "memberof": null,
    "longname": "api/role/role.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newRole;\n\ndescribe('Role API:', function() {\n\n  describe('GET /api/roles', function() {\n    var roles;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/roles')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          roles = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      roles.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/roles', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/roles')\n        .send({\n          name: 'New Role',\n          info: 'This is the brand new role!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newRole = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created role', function() {\n      newRole.name.should.equal('New Role');\n      newRole.info.should.equal('This is the brand new role!!!');\n    });\n\n  });\n\n  describe('GET /api/roles/:id', function() {\n    var role;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/roles/' + newRole._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          role = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      role = {};\n    });\n\n    it('should respond with the requested role', function() {\n      role.name.should.equal('New Role');\n      role.info.should.equal('This is the brand new role!!!');\n    });\n\n  });\n\n  describe('PUT /api/roles/:id', function() {\n    var updatedRole;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/roles/' + newRole._id)\n        .send({\n          name: 'Updated Role',\n          info: 'This is the updated role!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedRole = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedRole = {};\n    });\n\n    it('should respond with the updated role', function() {\n      updatedRole.name.should.equal('Updated Role');\n      updatedRole.info.should.equal('This is the updated role!!!');\n    });\n\n  });\n\n  describe('DELETE /api/roles/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/roles/' + newRole._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when role does not exist', function(done) {\n      request(app)\n        .delete('/api/roles/' + newRole._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 412,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/role/role.integration.js",
    "longname": "api/role/role.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 413,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/role.model.js",
    "memberof": null,
    "longname": "api/role/role.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\nimport TreeTable from '../../sqldb/treeTable';\nimport {UserRole} from '../../sqldb/';\nimport {User} from '../../sqldb/';\nimport {Space} from '../../sqldb/';\nimport {Permit} from '../../sqldb/';\nimport sqldb from '../../sqldb';\n\nexport default function (sequelize, DataTypes) {\n  return sequelize.define('Role', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    parentId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    spaceId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    appId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    name: DataTypes.STRING,\n    alias: DataTypes.STRING,\n    fullname: DataTypes.STRING,\n    owner: DataTypes.STRING,\n    ownerId: {\n      type: DataTypes.INTEGER,\n      defaultValue: -1\n    },\n    active: DataTypes.BOOLEAN\n  }, {\n      getterMethods: {\n        roleName: function () {\n          if (this.fullname !== 'root.role') {\n            return this.fullname.slice(10);\n          }\n        },\n        name: function () {\n          if (this.fullname !== 'root.role') {\n            return this.fullname.slice(10);\n          }\n        }\n      },\n      classMethods: {\n        getRoot: function () {\n          return this\n            .findOrCreate({\n              where: {\n                name: 'root',\n                fullname: 'root'\n              },\n              defaults: {\n                alias: 'root'\n              }\n            })\n            .spread(function (entity, created) {\n              return Promise.resolve(entity);\n            });\n        },\n        getRoleRoot: function (roleData) {\n\n          //return this.getRoot();\n\n          var Model = this;\n\n          ///*\n          return this.getRoot().then(function (root) {\n            var whereData = {};\n\n            if (typeof roleData === 'object') {\n              for (var key in roleData) {\n                if (key.toLowerCase() === 'owner' || key.toLowerCase() === 'ownertype') {\n                  whereData.owner = roleData[key];\n                  //delete roleData[key];\n                }\n                if (key.toLowerCase() === 'spaceid') {\n                  whereData.spaceId = roleData[key];\n                  //delete roleData[key];\n                }\n                if (key.toLowerCase() === 'appid') {\n                  whereData.appId = roleData[key];\n                  //delete roleData[key];\n                }\n                if (key.toLowerCase() === 'ownerid') {\n                  whereData.ownerId = roleData[key];\n                  //delete roleData[key];\n                }\n              }\n            }\n\n            whereData.name = 'role';\n            whereData.fullname = 'root.role';\n            whereData.parentId = 1;\n\n            //console.log('getRoleRoot root: ', JSON.stringify(root));\n\n            //console.log('getRoleRoot whereData: ', JSON.stringify(whereData));\n\n            return Model.findOrCreate({\n              where: whereData,\n              defaults: {\n                alias: 'role'\n              }\n            })\n              .spread(function (entity, created) {\n                //console.log('getRoleRoot created: ', created);\n                return Promise.resolve(entity);\n              });\n          });\n        },\n        getCustomer: function (context) {\n          return this.getRoleRoot(context).getChild('customer');\n        },\n        getMember: function (context) {\n          return this.getRoleRoot(context).getChild('member');\n        },\n        getAdmin: function (context) {\n          return this.getRoleRoot(context).getChild('admin');\n        },\n        getUserRoles: function (context) {\n          var whereData = {};\n          if (typeof context === 'object') {\n            for (var key in context) {\n              if (key.toLowerCase() === 'spaceid' || key.toLowerCase() === 'userid') {\n                whereData.spaceId = context[key];\n              }\n            }\n          }\n\n          if (whereData.hasOwnProperty('spaceId') && whereData.hasOwnProperty('userId')) {\n            UserRole.belongsTo(User);\n            UserRole.belongsTo(Space);\n            UserRole.belongsTo(Role);\n            return UserRole.findAll({\n              include: [{ all: true }],\n              where: whereData\n            })\n          }\n\n          //otherwhise, return error\n          return Promise.reject(new Error('fail to find users, make sure userId | spaceId is provided!'));\n        },\n        findAllUserSpaceRole: function (userId, spaceId) {\n\n          if (!userId) {\n            Promise.reject('please provide userId!');\n          }\n\n          if (!spaceId) {\n            Promise.reject('please provide spaceId!');\n          }\n\n          var UserRole = sqldb.UserRole;\n          var Category = sqldb.Category;\n          var Space = sqldb.Space;\n          var that = this;\n\n          that.hasMany(UserRole);\n          that.belongsTo(Space, { as: 'space' });\n          Space.belongsTo(Category, { as: 'type' });\n\n          return that.findAll({\n            where: {\n              spaceId: spaceId,\n            },\n            include: [\n              {\n                model: UserRole,\n                where: {\n                  userId: userId\n                }\n              },\n              {\n                model: Space, as: 'space',\n                include: [\n                  {\n                    model: Category, as: 'type'\n                  }\n                ]\n              }\n            ]\n            //add everyone role for each user roles\n          }).then(function (roles) {\n            return that.find({\n              where: {\n                spaceId: spaceId,\n                name: 'everyone'\n              },\n              include: [\n                {\n                  model: Space, as: 'space',\n                  include: [\n                    {\n                      model: Category, as: 'type'\n                    }\n                  ]\n                }\n              ]\n            }).then(function (role) {\n              roles.push(role);\n              return Promise.resolve(roles);\n            })\n          })\n        },\n        addRole: function (context) {\n          if (typeof context === 'string' && parseInt(context) > 0) {\n            return this.findById(context);\n          }\n          if (typeof context === 'object' && context.roleId && context.roleId > 0) {\n            return this.findById(context.roleId);\n          }\n          var treeObj = new TreeTable();\n          return this.getRoleRoot(context).then(function (root) {\n            //console.log('getRoleRoot:', JSON.stringify(root));\n            return treeObj.addChild(root, context);\n          });\n        },\n        add: function (roleData) {\n          return this.addRole(roleData);\n        },\n        getRole: function (roleData) {\n          var that = this;\n          if (roleData && !isNaN(roleData)) {\n            return that.findById(roleData);\n          }\n\n          if (typeof roleData === 'object') {\n            return this.getRoleRoot(roleData).then(function (root) {\n              return root.getChild(roleData);\n            });\n          }\n        },\n        getRoles: function (roleData) {\n          var that = this;\n          return this.getRoleRoot(roleData).then(function (root) {\n            return root.getChildren('all');\n          });\n        },\n        /**\n         * grandsData format: \n         * [\n         *    {roleName|roleAlias:'permitName|permitAlias,....'}\n         * ]\n         */\n        addGrants: function (grantsData, ownerData) {\n          //console.log('in Role.addGrants');\n\n          //console.log('role model grantsData:',JSON.stringify(grantsData));\n          //console.log('addGrants spaceId:',spaceId);\n          //console.log('role model ownerData:',JSON.stringify(ownerData));\n\n          var grants = [];\n\n          for (var key in grantsData) {\n            var o = {};\n            o[key] = grantsData[key];\n            grants.push(o);\n          }\n\n          var that = this;\n          var count = 0;\n\n          //console.log('addGrants grants:',JSON.stringify(grants));\n\n          return Promise.each(grants, function (grantData) {\n            //console.log('role model grantData:',JSON.stringify(grantData));\n            count++;\n            return that.addGrant(grantData, ownerData);\n          }).then(function () {\n            return count;\n          });\n\n        },\n        //grantData format: {roleName|roleAlias: permitList}\n        //permitList format: 'permitName|permitAlias,....'\n        addGrant: function (grantData, ownerData) {\n\n          //console.log('addGrant ownerData:',JSON.stringify(ownerData));\n\n          var roleData;\n\n          for (var key in grantData) {\n            var aList = key.split(\"|\");\n            roleData = {\n              name: aList[0],\n              alias: aList[0]|aList[0],\n              spaceId: ownerData.spaceId\n            };\n            var permitList = grantData[key].split(\",\");\n          }\n\n          //console.log('permitList',JSON.stringify(permitList));\n          //console.log('addGrant roleData',JSON.stringify(roleData));\n\n          var theRole, thePermit;\n\n          return this.addRole(roleData).then(function (role) {\n\n            theRole = role;\n\n            var count = 0;\n\n            return Promise.each(permitList, function (pName) {\n              var permitData = Object.assign({}, ownerData);\n              var pList = pName.split(\"|\");\n              permitData.name = pList[0];\n              permitData.alias = pList[1]|pList[0];\n              count++;\n              //console.log('permitData',JSON.stringify(permitData));\n              return sqldb.Permit.addPermit(permitData).then(function (permit) {\n                var whereData = {};\n\n                whereData.spaceId = ownerData.spaceId,\n                  whereData.owner = ownerData.owner,\n                  whereData.ownerId = ownerData.ownerId\n                whereData.permitId = permit._id;\n                whereData.roleId = theRole._id;\n\n                //console.log('whereData:',JSON.stringify(whereData));\n                //console.log('ownerData:',JSON.stringify(ownerData));\n\n                return sqldb.PermitRole.findOrCreate({\n                  where: whereData,\n                  defaults: {}\n                });\n              });\n            });\n          });\n        }\n      },\n      instanceMethods: {\n        addChild: function (childData) {\n          var treeObj = new TreeTable();\n          return treeObj.addChild(this, childData);\n        },\n        getChildren: function (childData) {\n          var treeObj = new TreeTable();\n          return treeObj.getChildren(this, childData);\n        },\n        getChild: function (childData) {\n          var treeObj = new TreeTable();\n          return treeObj.getChild(this, childData);\n        },\n        getParent: function (recursive) {\n          var treeObj = new TreeTable();\n          return treeObj.getParent(this, recursive);\n        },\n        childCount: function () {\n          var treeObj = new TreeTable();\n          return treeObj.childCount(this);\n        },\n        isParentOf: function (childObj, recursive) {\n          var treeObj = new TreeTable();\n          return treeObj.isParentOf(childObj, this, recursive);\n        },\n        isChildOf: function (parentObj, recursive) {\n          var treeObj = new TreeTable();\n          return treeObj.isChildOf(parentObj, this, childData);\n        }\n      }\n    });\n}\n"
  },
  {
    "__docId__": 414,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/role/role.model.js",
    "longname": "api/role/role.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 415,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "role",
    "memberof": "api/role/role.model.js",
    "longname": "api/role/role.model.js~role",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.model.js",
    "importStyle": "role",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 416,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/role.socket.js",
    "memberof": null,
    "longname": "api/role/role.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar RoleEvents = require('./role.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('role:' + event, socket);\n\n    RoleEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    RoleEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 417,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "RoleEvents",
    "memberof": "api/role/role.socket.js",
    "longname": "api/role/role.socket.js~RoleEvents",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 418,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/role/role.socket.js",
    "longname": "api/role/role.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 419,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/role/role.socket.js",
    "longname": "api/role/role.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/role/role.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 420,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/role/role.socket.js",
    "longname": "api/role/role.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 421,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/role/role.socket.js",
    "longname": "api/role/role.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/role/role.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 422,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/role/userRole.model.js",
    "memberof": null,
    "longname": "api/role/userRole.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\nimport TreeTable from '../../sqldb/treeTable';\nimport sqldb from '../../sqldb';\n\nexport default function(sequelize, DataTypes) {\n\treturn sequelize.define('UserRole', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tuserId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\troleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tactive: DataTypes.BOOLEAN\n\t},{\n\t\tclassMethods: {\n\t\t\t//params: [{userId,roleId[roleName]},...]\n\t\t\tbatchAdd: function (params) {\n\t\t\t\t//console.log('batchAdd in userRole model:',JSON.stringify(params));\n\t\t\t\tvar that = this;\n\t\t\t\tvar theParams = [];\n\t\t\t\tvar Role = sqldb.Role;\n\t\t\t\tif(_.isArray(params)){\n\t\t\t\t\t//console.log('2 batchAdd in userRole model:',JSON.stringify(params));\n\t\t\t\t\treturn Promise.each(params,function(ur){\n\t\t\t\t\t\t//console.log('batchAdd in userRole model:ur:',JSON.stringify(ur));\n\t\t\t\t\t\tif(ur.roleId && ur.userId){\n\t\t\t\t\t\t\t//console.log('1 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\t\tif(ur.spaceId){\n\t\t\t\t\t\t\t\ttheParams.push(ur);\t\n\t\t\t\t\t\t\t\t//console.log('2 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\t\t\treturn Promise.resolve(null);\t\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//console.log('4 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\t\t\treturn Role.findById(ur.roleId).then(function(role){\n\t\t\t\t\t\t\t\t\tur.spaceId = role.spaceId;\n\t\t\t\t\t\t\t\t\ttheParams.push(ur);\n\t\t\t\t\t\t\t\t\t//console.log('3 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(ur.spaceId){\n\t\t\t\t\t\t\t\t//console.log('6 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\t\t\tvar roleName;\n\t\t\t\t\t\t\t\tif(ur.role){\n\t\t\t\t\t\t\t\t\troleName = ur.role;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(ur.roleName){\n\t\t\t\t\t\t\t\t\troleName = ur.roleName;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(roleName){\n\t\t\t\t\t\t\t\t\t//console.log('7 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\t\t\t\treturn Role.find({\n\t\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\t\tfullname: 'root.'+roleName,\n\t\t\t\t\t\t\t\t\t\t\tspaceId: ur.spaceId\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}).then(function(role){\n\t\t\t\t\t\t\t\t\t\t//console.log('5 role',JSON.stringify(role));\n\t\t\t\t\t\t\t\t\t\tur.roleId = role._id;\n\t\t\t\t\t\t\t\t\t\ttheParams.push(ur);\n\t\t\t\t\t\t\t\t\t\t//console.log('5 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//Promise.reject('fail to find spaceId!');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(function(){\n\t\t\t\t\t\tvar rets = [];\n\t\t\t\t\t\t//console.log('6 theParams',JSON.stringify(theParams));\n\t\t\t\t\t\treturn Promise.each(theParams,function(o){\n\t\t\t\t\t\t\treturn that.findOrCreate({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\tuserId: o.userId,\n\t\t\t\t\t\t\t\t\troleId: o.roleId,\n\t\t\t\t\t\t\t\t\tspaceId: o.spaceId\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdefaults: {}\n\t\t\t\t\t\t\t}).spread(function(r,created){\n\t\t\t\t\t\t\t\trets.push(r);\n\t\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}).then(function(){\n\t\t\t\t\t\t\treturn Promise.resolve(rets);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t//return that.bulkCreate(theParams);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t}\n\t}\n\t);\n}\n"
  },
  {
    "__docId__": 423,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/role/userRole.model.js",
    "longname": "api/role/userRole.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/role/userRole.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 424,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "userRole",
    "memberof": "api/role/userRole.model.js",
    "longname": "api/role/userRole.model.js~userRole",
    "access": null,
    "export": true,
    "importPath": "./api/role/userRole.model.js",
    "importStyle": "userRole",
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 425,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/space/index.js",
    "memberof": null,
    "longname": "api/space/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./space.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nrouter.get('/user', controller.findUserSpaces);\n\nrouter.get('/:id/userJoin', controller.userJoin);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 426,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/space/index.js",
    "longname": "api/space/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/space/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 427,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/space/index.js",
    "longname": "api/space/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/space/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 428,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/space/index.js",
    "longname": "api/space/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/space/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 429,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/space/index.spec.js",
    "memberof": null,
    "longname": "api/space/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar spaceCtrlStub = {\n  index: 'spaceCtrl.index',\n  show: 'spaceCtrl.show',\n  create: 'spaceCtrl.create',\n  update: 'spaceCtrl.update',\n  destroy: 'spaceCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar spaceIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './space.controller': spaceCtrlStub\n});\n\ndescribe('Space API Router:', function() {\n\n  it('should return an express router instance', function() {\n    spaceIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/spaces', function() {\n\n    it('should route to space.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'spaceCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/spaces/:id', function() {\n\n    it('should route to space.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'spaceCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/spaces', function() {\n\n    it('should route to space.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'spaceCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/spaces/:id', function() {\n\n    it('should route to space.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'spaceCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/spaces/:id', function() {\n\n    it('should route to space.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'spaceCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/spaces/:id', function() {\n\n    it('should route to space.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'spaceCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 430,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/space/index.spec.js",
    "longname": "api/space/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/space/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 431,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "spaceCtrlStub",
    "memberof": "api/space/index.spec.js",
    "longname": "api/space/index.spec.js~spaceCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/space/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 432,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/space/index.spec.js",
    "longname": "api/space/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/space/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 433,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "spaceIndex",
    "memberof": "api/space/index.spec.js",
    "longname": "api/space/index.spec.js~spaceIndex",
    "access": null,
    "export": false,
    "importPath": "./api/space/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 434,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/space/space.controller.js",
    "memberof": null,
    "longname": "api/space/space.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 26,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/spaces              ->  index\n * POST    /api/spaces              ->  create\n * GET     /api/spaces/:id          ->  show\n * PUT     /api/spaces/:id          ->  update\n * DELETE  /api/spaces/:id          ->  destroy\n * GET\t   /api/spaces/user/:id     ->  findUserSpaces\n */\n\n/**\n * Provides the base sever side restful api under space module\n * \n * Using Rails-like standard naming convention for endpoints.\n * \n * GET     /api/spaces              ->  index\n * POST    /api/spaces              ->  create\n * GET     /api/spaces/:id          ->  show\n * PUT     /api/spaces/:id          ->  update\n * DELETE  /api/spaces/:id          ->  destroy\n * GET\t   /api/spaces/user/:id     ->  findUserSpaces\n * POST    /api/spaces/:id?userId   ->  userJoin\n * \n * @module server/api/space\n */\n'use strict';\n\nimport _ from 'lodash';\nimport {Space} from '../../sqldb';\nimport {UserRole} from '../../sqldb';\nimport {Role} from '../../sqldb';\nimport {Category} from '../../sqldb';\nimport {SpaceApp} from '../../sqldb';\nimport {App} from '../../sqldb';\nimport {Nut} from '../../sqldb';\nimport {User} from '../../sqldb';\nimport {PermitRole} from '../../sqldb';\nimport {Permit} from '../../sqldb';\nimport Sequelize from 'sequelize';\n\nvar Promise = require('bluebird');\n\nfunction respondWithResult(res, statusCode) {\n\n    statusCode = statusCode || 200;\n    return function (entity) {\n        //console.log('response entity:', JSON.stringify(entity));\n        if (entity) {\n            res.status(statusCode).json(entity);\n        }\n    };\n}\n\nfunction saveUpdates(updates) {\n    return function (entity) {\n        return entity.updateAttributes(updates)\n            .then(updated => {\n                return updated;\n            });\n    };\n}\n\nfunction removeEntity(res) {\n    return function (entity) {\n        if (entity) {\n            return entity.destroy()\n                .then(() => {\n                    res.status(204).end();\n                });\n        }\n    };\n}\n\nfunction handleEntityNotFound(res) {\n    return function (entity) {\n        if (!entity) {\n            res.status(404).end();\n            return null;\n        }\n        return entity;\n    };\n}\n\nfunction handleError(res, statusCode) {\n    statusCode = statusCode || 500;\n    return function (err) {\n        res.status(statusCode).send(err);\n    };\n}\n\n/**\n * get all spaces according to condition\n * @method module:server/api/space.method:index\n * @returns {Array} array of spaces, format like: [ {_id: xxx, name: xxx, apps:[], roles:[], type:{},...},...]\n */\nexport function index(req, res) {\n\n    App.belongsTo(Category, { as: 'type' });\n    //App.belongsTo(Space, { as: 'space' });\n    Space.belongsTo(Category, { as: 'type' });\n    Space.hasMany(App, { as: 'apps' });\n    Space.hasMany(Role, { as: 'roles' });\n\n    var findData = req.body;\n    var includeData = [{\n        model: Category, as: 'type'\n        //where: { _id: Sequelize.col('Spaces.typeId') }\n    }];\n    if (findData.type) {\n        Space.getType(findData.type)\n            .then(function (type) {\n                findData.typeId = type._id;\n                delete findData.type;\n                return Promise.resolve(findData);\n            }).then(function (findData) {\n                return Space.findAll({\n                    where: findData,\n                    include: [\n                        {\n                            model: Category,\n                            as: 'type'\n                        },\n                        {\n                            model: App,\n                            as: 'apps',\n                            include: {\n                                model: Category, as: 'type'\n                            }\n                        },\n                        {\n                            model: Role,\n                            as: 'roles',\n                            where: {\n                                fullname: {\n                                    $ne: 'root.role'\n                                }\n                            }\n                        },\n                    ]\n                })\n            })\n            .then(respondWithResult(res))\n            .catch(handleError(res));\n    } else {\n        Space.findAll({\n            where: findData,\n            include: [\n                {\n                    model: Category,\n                    as: 'type'\n                },\n                {\n                    model: App,\n                    as: 'apps',\n                    include: {\n                        model: Category, as: 'type'\n                    }\n                },\n                {\n                    model: Role,\n                    as: 'roles',\n                    where: {\n                        fullname: {\n                            $ne: 'root.role'\n                        }\n                    }\n                },\n            ]\n        })\n            .then(respondWithResult(res))\n            .catch(handleError(res));\n    }\n}\n\n/**\n * get single space\n * @method module:server/api/space.method:show\n * @returns {Object} space object, format like: {_id: xxx, name: xxx, apps:[], roles:[], type:{},...}\n */\nexport function show(req, res) {\n\n    console.log(req.params.id);\n    if (req.params.id && req.params.id === 'user') {\n        return findUserSpaces(req, res);\n    }\n\n    //console.log('1');\n\n    App.belongsTo(Category, { as: 'type' });\n    //App.belongsTo(Space, { as: 'space' });\n    Space.belongsTo(Category, { as: 'type' });\n    Space.hasMany(App, { as: 'apps' });\n    Space.hasMany(Role, { as: 'roles' });\n\n    //console.log('2');\n\n    Space.find({\n        where: {\n            _id: req.params.id\n        },\n        include: [\n            {\n                model: Category,\n                as: 'type'\n            },\n            {\n                model: App,\n                as: 'apps',\n                include: {\n                    model: Category, as: 'type'\n                }\n            },\n            {\n                model: Role,\n                as: 'roles',\n                where: {\n                    fullname: {\n                        $ne: 'root.role'\n                    }\n                }\n            },\n        ]\n    })\n        /*.then(function(space) {\n            //console.log('space:', JSON.stringify(space));\n            var oSpace = JSON.parse(JSON.stringify(space));\n            return Space.getType(space.typeId).then(function(type) {\n                oSpace.type = type;\n                return Promise.resolve(oSpace);\n            }).then(function(oSpace) {\n                //console.log('3 oSpace:',JSON.stringify(oSpace));\n                return App.findAll({\n                    where: {\n                        spaceId: oSpace._id\n                    },\n                    include: {\n                        model: Category,\n                        as: 'type'\n                    }\n                });\n            }).then(function(sApps) {\n                //console.log('4 apps', apps);\n                //console.log('4 apps', JSON.stringify(sApps));\n                oSpace.apps = sApps;\n                //console.log('5 oSpace', JSON.stringify(oSpace));\n                return Promise.resolve(oSpace);\n            });\n        })*/\n        .then(handleEntityNotFound(res))\n        .then(respondWithResult(res))\n        .catch(handleError(res));\n}\n\n/**\n * create a new space, this function call Space model add function to complete create of space\n * please see Space.add function for more information of creating space\n * @method module:server/api/space.method:create\n * @param req.body {object}, format like: {name:xxx, alias:xxx, type:{name:xxx, alias:xxx}, roles: [{...}...]}\n * @returns {Array} array of spaces, format like: [ {_id: xxx, name: xxx, apps:[], roles:[], type:{},...},...]\n */\nexport function create(req, res) {\n    //console.log('space create req.body:', JSON.stringify(req.body));\n    var spaceData = req.body;\n    Space.add(req.body)\n        .then(respondWithResult(res, 201))\n        .catch(handleError(res));\n    /*\n    var typeName;\n    var newSpace;\n    for (var key in spaceData) {\n        if (key.toLowerCase() === 'type' || key.toLowerCase() === 'typename') {\n            typeName = spaceData[key];\n            delete spaceData[key];\n        }\n    }\n \n    if (typeName) {\n        Space.addType(typeName).then(function (type) {\n            spaceData.typeId = type._id;\n            Space.create(spaceData)\n                .then(function (space) {\n                    newSpace = JSON.parse(JSON.stringify(space));\n                    return Space.getType(space.typeId).then(function (type) {\n                        var newSpace = JSON.parse(JSON.stringify(space));\n                        newSpace.type = type;\n                        return Promise.resolve(newSpace);\n                    });\n                })\n                .then(respondWithResult(res, 201))\n                .catch(handleError(res));\n        })\n    } else {\n        Space.create(spaceData)\n            .then(function (space) {\n                newSpace = JSON.parse(JSON.stringify(space));\n                return Space.getType(space.typeId).then(function (type) {\n                    var newSpace = JSON.parse(JSON.stringify(space));\n                    newSpace.type = type;\n                    return Promise.resolve(newSpace);\n                });\n            })*/\n\n\n}\n\n// Updates an existing Space in the DB\nexport function update(req, res) {\n    if (req.body._id) {\n        delete req.body._id;\n    }\n    Space.find({\n        where: {\n            _id: req.params.id\n        }\n    }).then(function (space) {\n        newSpace = JSON.parse(JSON.stringify(space));\n        return Space.getType(space.typeId).then(function (type) {\n            var newSpace = JSON.parse(JSON.stringify(space));\n            newSpace.type = type;\n            return Promise.resolve(newSpace);\n        });\n\t\t  })\n        .then(handleEntityNotFound(res))\n        .then(saveUpdates(req.body))\n        .then(respondWithResult(res))\n        .catch(handleError(res));\n}\n\n// Deletes a Space from the DB\nexport function destroy(req, res) {\n    Space.find({\n        where: {\n            _id: req.params.id\n        }\n    })\n        .then(handleEntityNotFound(res))\n        .then(removeEntity(res))\n        .catch(handleError(res));\n}\n\n/**\n * create a new space, this function call Space model add function to complete create of space\n * please see Space.add function for more information of creating space\n * @method module:server/api/space.method:findUserSpaces\n * @param req.query.userId {int} userId to join\n * @returns {Array} array of spaces under user, format like: [ \n * {_id: xxx, name: xxx, roles:[], type:{}, apps: [ {_id:xxx, name: xxx, nuts: [{_id: xxx, name: xxx, permitRoles: [{\n *      permit: {}, nut: {}, role: {}\n * }]}]} ]...},...]\n * attention is: apps array only contain apps user can access, meanwhile roles only contain user's roles under space\n */\nexport function findUserSpaces(req, res) {\n\n    //console.log('findUserSpaces req.params', JSON.stringify(req.params));\n    //console.log('findUserSpaces req.query', JSON.stringify(req.query));\n\n    App.belongsTo(Category, { as: 'type' });\n\n    UserRole.belongsTo(Space, { as: 'space' });\n    Space.belongsTo(Category, { as: 'type' });\n    //console.log('in findUserSpaces');\n    //console.log('params:', JSON.stringify(req.params));\n    var query = req.query;\n    if (query) {\n        //console.log('findUserSpaces query', JSON.stringify(query));\n\n        Space.belongsTo(Category, { as: 'type' });\n        //console.log(1);\n        Space.hasMany(Role, { as: 'roles', foreignKey: 'spaceId' });\n        //console.log(2);\n        Role.belongsToMany(User, { through: 'UserRole', as: 'users' });\n        //console.log(3);\n        Space.hasMany(App, { as: 'apps' });\n        //console.log(4);\n        App.belongsTo(Category, { as: 'type' });\n        //console.log(5);\n        App.hasMany(Nut, { as: 'nuts' });\n        //console.log(6);\n        Nut.hasMany(PermitRole, { foreignKey: 'ownerId', as: 'permitRoles' });\n        //console.log(7);\n        PermitRole.belongsTo(Permit, { as: 'permit' });\n        //console.log(8);\n        PermitRole.belongsTo(Role, { as: 'role' });\n        //console.log(9);\n\n        return Space.findAll({\n            include: [\n                {\n                    model: Category, as: 'type'\n                },\n                {\n                    model: Role, as: 'roles',\n                    include: [\n                        {\n                            model: User, as: 'users',\n                            where: {\n                                _id: query.userId\n                            }\n                        }\n                    ]\n                },\n                {\n                    model: App, as: 'apps',\n                    include: [\n                        {\n                            model: Category, as: 'type'\n                        },\n                        {\n                            model: Nut, as: 'nuts',\n                            include: [\n                                {\n                                    model: PermitRole, as: 'permitRoles',\n                                    where: {\n                                        'owner': 'nut'\n                                    },\n                                    include: [\n                                        {\n                                            model: Permit, as: 'permit'\n                                        },\n                                        {\n                                            model: Role, as: 'role',\n                                            include: [\n                                                {\n                                                    model: User, as: 'users',\n                                                    where: {\n                                                        _id: query.userId\n                                                    }\n                                                }\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        }).then(function (spaces) {\n            //console.log('spaces: ', JSON.stringify(spaces));\n            return Promise.resolve(spaces);\n        })\n            .then(respondWithResult(res))\n            .catch(handleError(res));\n    }\n}\n\n/**\n * user join to space, by default, will add user as everyone role under space\n * @method module:server/api/space.method:userJoin\n * @param req.params.id {int} space id to join \n * @param req.query.userId {int} userId to join\n * @returns {boolean} true -- created, otherwise error\n */\nexport function userJoin(req, res) {\n    var spaceId = req.params.id;\n    var userId = req.query.userId;\n    //  console.log(\"User \" + userId + \" request to join space \" + spaceId);\n\n    Role.add({\n        spaceId: spaceId,\n        name: \"everyone\"\n    }).then(function (role) {\n        return UserRole.findOrCreate({ userId: userId, roleId: role._id, spaceId: spaceId });\n    }).spread(function (created, entity) {\n        return Promise.resolve(true);\n    }).then(respondWithResult(res))\n        .catch(handleError(res));\n}\n\n"
  },
  {
    "__docId__": 435,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 41,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 436,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 43,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 437,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 438,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 63,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 439,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 74,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 440,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 84,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 441,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.controller.js",
    "importStyle": "{index}",
    "description": "get all spaces according to condition",
    "lineNumber": 96,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/space.method:index"
      },
      {
        "tagName": "@returns",
        "tagValue": "{Array} array of spaces, format like: [ {_id: xxx, name: xxx, apps:[], roles:[], type:{},...},...]"
      }
    ],
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "Array"
      ],
      "spread": false,
      "description": "array of spaces, format like: [ {_id: xxx, name: xxx, apps:[], roles:[], type:{},...},...]"
    },
    "generator": false
  },
  {
    "__docId__": 442,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.controller.js",
    "importStyle": "{show}",
    "description": "get single space",
    "lineNumber": 180,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/space.method:show"
      },
      {
        "tagName": "@returns",
        "tagValue": "{Object} space object, format like: {_id: xxx, name: xxx, apps:[], roles:[], type:{},...}"
      }
    ],
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "Object"
      ],
      "spread": false,
      "description": "space object, format like: {_id: xxx, name: xxx, apps:[], roles:[], type:{},...}"
    },
    "generator": false
  },
  {
    "__docId__": 443,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.controller.js",
    "importStyle": "{create}",
    "description": "create a new space, this function call Space model add function to complete create of space\nplease see Space.add function for more information of creating space",
    "lineNumber": 261,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/space.method:create"
      },
      {
        "tagName": "@returns",
        "tagValue": "{Array} array of spaces, format like: [ {_id: xxx, name: xxx, apps:[], roles:[], type:{},...},...]"
      }
    ],
    "params": [
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.body",
        "description": "{object}, format like: {name:xxx, alias:xxx, type:{name:xxx, alias:xxx}, roles: [{...}...]}"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "Array"
      ],
      "spread": false,
      "description": "array of spaces, format like: [ {_id: xxx, name: xxx, apps:[], roles:[], type:{},...},...]"
    },
    "generator": false
  },
  {
    "__docId__": 444,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 307,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 445,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 330,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 446,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findUserSpaces",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~findUserSpaces",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.controller.js",
    "importStyle": "{findUserSpaces}",
    "description": "create a new space, this function call Space model add function to complete create of space\nplease see Space.add function for more information of creating space",
    "lineNumber": 352,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/space.method:findUserSpaces"
      },
      {
        "tagName": "@returns",
        "tagValue": "{Array} array of spaces under user, format like: [ \n{_id: xxx, name: xxx, roles:[], type:{}, apps: [ {_id:xxx, name: xxx, nuts: [{_id: xxx, name: xxx, permitRoles: [{\n     permit: {}, nut: {}, role: {}\n}]}]} ]...},...]\nattention is: apps array only contain apps user can access, meanwhile roles only contain user's roles under space"
      }
    ],
    "params": [
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.query.userId",
        "description": "{int} userId to join"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "Array"
      ],
      "spread": false,
      "description": "array of spaces under user, format like: [ \n{_id: xxx, name: xxx, roles:[], type:{}, apps: [ {_id:xxx, name: xxx, nuts: [{_id: xxx, name: xxx, permitRoles: [{\n     permit: {}, nut: {}, role: {}\n}]}]} ]...},...]\nattention is: apps array only contain apps user can access, meanwhile roles only contain user's roles under space"
    },
    "generator": false
  },
  {
    "__docId__": 447,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "userJoin",
    "memberof": "api/space/space.controller.js",
    "longname": "api/space/space.controller.js~userJoin",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.controller.js",
    "importStyle": "{userJoin}",
    "description": "user join to space, by default, will add user as everyone role under space",
    "lineNumber": 454,
    "unknown": [
      {
        "tagName": "@method",
        "tagValue": "module:server/api/space.method:userJoin"
      },
      {
        "tagName": "@returns",
        "tagValue": "{boolean} true -- created, otherwise error"
      }
    ],
    "params": [
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.params.id",
        "description": "{int} space id to join"
      },
      {
        "nullable": null,
        "types": [
          "*"
        ],
        "spread": false,
        "optional": false,
        "name": "req.query.userId",
        "description": "{int} userId to join"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "boolean"
      ],
      "spread": false,
      "description": "true -- created, otherwise error"
    },
    "generator": false
  },
  {
    "__docId__": 448,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/space/space.events.js",
    "memberof": null,
    "longname": "api/space/space.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Space model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Space = require('../../sqldb').Space;\nvar SpaceEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nSpaceEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Space.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    SpaceEvents.emit(event + ':' + doc._id, doc);\n    SpaceEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default SpaceEvents;\n"
  },
  {
    "__docId__": 449,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Space",
    "memberof": "api/space/space.events.js",
    "longname": "api/space/space.events.js~Space",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 450,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/space/space.events.js",
    "longname": "api/space/space.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 451,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/space/space.events.js",
    "longname": "api/space/space.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 452,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/space/space.integration.js",
    "memberof": null,
    "longname": "api/space/space.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newSpace;\n\ndescribe('Space API:', function() {\n\n  describe('GET /api/spaces', function() {\n    var spaces;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/spaces')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          spaces = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      spaces.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/spaces', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/spaces')\n        .send({\n          name: 'New Space',\n          info: 'This is the brand new space!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newSpace = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created space', function() {\n      newSpace.name.should.equal('New Space');\n      newSpace.info.should.equal('This is the brand new space!!!');\n    });\n\n  });\n\n  describe('GET /api/spaces/:id', function() {\n    var space;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/spaces/' + newSpace._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          space = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      space = {};\n    });\n\n    it('should respond with the requested space', function() {\n      space.name.should.equal('New Space');\n      space.info.should.equal('This is the brand new space!!!');\n    });\n\n  });\n\n  describe('PUT /api/spaces/:id', function() {\n    var updatedSpace;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/spaces/' + newSpace._id)\n        .send({\n          name: 'Updated Space',\n          info: 'This is the updated space!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedSpace = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedSpace = {};\n    });\n\n    it('should respond with the updated space', function() {\n      updatedSpace.name.should.equal('Updated Space');\n      updatedSpace.info.should.equal('This is the updated space!!!');\n    });\n\n  });\n\n  describe('DELETE /api/spaces/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/spaces/' + newSpace._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when space does not exist', function(done) {\n      request(app)\n        .delete('/api/spaces/' + newSpace._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 453,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/space/space.integration.js",
    "longname": "api/space/space.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 454,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/space/space.model.js",
    "memberof": null,
    "longname": "api/space/space.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\n\nexport default function (sequelize, DataTypes) {\n\treturn sequelize.define('Space', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tname: {\n\t\t\ttype: DataTypes.STRING,\n\t\t\tunique: {\n\t\t\t\tmsg: 'The specified space name is already in use.'\n\t\t\t}\n\t\t},\n\t\talias: DataTypes.STRING,\n\t\tdescription: DataTypes.STRING,\n\t\ttypeId: DataTypes.INTEGER,\n\t\tactive: DataTypes.BOOLEAN\n\t}, {\n\t\t\tgetterMethods: {\n\t\t\t\tprofile: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\talias: this.alias,\n\t\t\t\t\t\tdescription: this.description\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t/*\n\t\t\t\ttype: function(){\n\t\t\t\t\treturn Category.findById(typeId);\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t},\n\t\t\tclassMethods: {\n\t\t\t\tgetUserSpaces: function (userId) {\n\t\t\t\t\tUserRole.belongsTo(User);\n\t\t\t\t\tUserRole.blongsTo(this);\n\t\t\t\t\treturn UserRole.findAll({\n\t\t\t\t\t\tattributes: ['spaceId', 'userId'],\n\t\t\t\t\t\twhere: { userId: userId },\n\t\t\t\t\t\tinclude: [User, this],\n\t\t\t\t\t\tgroup: ['spaceId']\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddType: function (typeData) {\n\t\t\t\t\treturn this.getType(typeData, true);\n\t\t\t\t},\n\t\t\t\tgetType: function (typeData, autoCreated) {\n\t\t\t\t\t//console.log('in space Category:', typeData);\n\t\t\t\t\t//console.log('in space User:', User);\n\t\t\t\t\t//console.log('in space sqldb:', sqldb);\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\t//var Category = sqldb.Category;\n\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\tif (typeof typeData === 'string' && isNaN(typeData)) {\n\t\t\t\t\t\tvar typeName = typeData;\n\n\t\t\t\t\t\ttypeData = {};\n\n\t\t\t\t\t\ttypeData.name = typeName;\n\n\t\t\t\t\t\t//console.log('in space getType');\n\t\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\t\t//console.log('space getType typeData:', JSON.stringfy(typeData));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isNaN(typeData) && typeData > 0) {\n\t\t\t\t\t\treturn Category.findById(typeData);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof typeData === 'object' && !_.isEmpty(typeData)) {\n\t\t\t\t\t\ttypeData.owner = 'space';\n\t\t\t\t\t\tvar tyName = typeData.name;\n\t\t\t\t\t\tif (tyName.substr(0, 5).toLowerCase() !== 'space') {\n\t\t\t\t\t\t\ttyName = 'space.' + tyName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttypeData.name = tyName;\n\t\t\t\t\t\t//console.log('space model typeData:', JSON.stringify(typeData));\n\t\t\t\t\t\treturn Category.getType(typeData, true);\n\t\t\t\t\t}\n\n\t\t\t\t\t//otherwise return promise reject\n\t\t\t\t\tsequelize.Promise.reject(new Error('fail to add type!'));\n\t\t\t\t},\n\t\t\t\t//this function can use to create\n\t\t\t\t//params: {name:xxx, alias:xxx, type:xxx, roles: [...]}\n\t\t\t\t//return space with type and roles\n\t\t\t\tadd: function (spaceData) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar typeId, spaceId;\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\tvar Role = sqldb.Role;\n\n\t\t\t\t\tthis.hasMany(Role, { as: 'roles' });\n\t\t\t\t\tthis.belongsTo(Category, { as: 'type' });\n\n\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\tif (spaceData.typeId) {\n\t\t\t\t\t\t\ttypeId = spaceData.typeId;\n\t\t\t\t\t\t\treturn resolve(spaceData.typeId);\n\t\t\t\t\t\t} else if (spaceData.type) {\n\t\t\t\t\t\t\tif(spaceData.type.roles){\n\t\t\t\t\t\t\t\tspaceData.roles = spaceData.type.roles;\n\t\t\t\t\t\t\t\tdelete spaceData.type.roles;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(spaceData.type.apps){\n\t\t\t\t\t\t\t\tspaceData.apps = spaceData.type.apps;\n\t\t\t\t\t\t\t\tdelete spaceData.type.roles;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn that.addType(spaceData.type).then(function (type) {\n\t\t\t\t\t\t\t\ttypeId = type._id;\n\t\t\t\t\t\t\t\treturn resolve(type._id);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn resolve(null);\n\t\t\t\t\t}).then(function (typeId) {\n\t\t\t\t\t\t//console.log('typeId:', typeId);\n\t\t\t\t\t\tspaceData.typeId = typeId;\n\t\t\t\t\t\treturn that.findOrCreate({\n\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\tname: spaceData.name //spaceName must be unique name\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdefaults: spaceData\n\t\t\t\t\t\t})\n\t\t\t\t\t}).spread(function (space, created) {\n\t\t\t\t\t\tspaceId = space._id;\n\t\t\t\t\t\t//console.log('space', JSON.stringify(space));\n\t\t\t\t\t\tif (spaceData.roles) {\n\t\t\t\t\t\t\treturn that.addRoles(spaceData.roles, space._id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('spaceId:', spaceId);\n\t\t\t\t\t\treturn that.find({\n\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t_id: spaceId\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmodel: Role, as: 'roles'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}).then(function(space){\n\t\t\t\t\t\t\t//console.log('space:',JSON.stringify(space));\n\t\t\t\t\t\t\treturn Promise.resolve(space);\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t},\n\n\t\t\t\taddRoles: function (listRoleData, spaceId) {\n\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar roles = [];\n\n\t\t\t\t\treturn Promise.each(listRoleData, function (roleData) {\n\n\t\t\t\t\t\treturn that.addRole(roleData, spaceId).then(function (role) {\n\t\t\t\t\t\t\troles.push(role);\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t},\n\n\t\t\t\taddRole: function (roleData, spaceId) {\n\n\t\t\t\t\tvar Role = sqldb.Role;\n\t\t\t\t\t\n\t\t\t\t\tif(typeof roleData === 'string'){\n\t\t\t\t\t\troleData = {\n\t\t\t\t\t\t\tname: roleData\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof roleData === 'object') {\n\t\t\t\t\t\tif (!isNaN(spaceId) && spaceId > 0) {\n\t\t\t\t\t\t\troleData.spaceId = spaceId;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//console.log('roleData:',JSON.stringify(roleData));\n\t\t\t\t\t\tif (!roleData.spaceId || !roleData.name || roleData.name === \"\") {\n\t\t\t\t\t\t\treturn Promise.reject('please provide spaceId and role name!');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Role.addRole(roleData);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Promise.reject('fail to add role!');\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tinstanceMethods: {\n\n\t\t\t\taddRole: function (roleData) {\n\n\t\t\t\t\tvar Role = sqldb.Role;\n\n\t\t\t\t\tif (typeof roleData === 'string') {\n\t\t\t\t\t\troleData = {\n\t\t\t\t\t\t\tname: roleData\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\troleData.spaceId = this._id;\n\n\t\t\t\t\treturn Role.addRole(roleData);\n\t\t\t\t}\n\n\t\t\t},\n\t\t\thooks: {\n\n\t\t\t}\n\t\t});\n}\n"
  },
  {
    "__docId__": 455,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/space/space.model.js",
    "longname": "api/space/space.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 456,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "space",
    "memberof": "api/space/space.model.js",
    "longname": "api/space/space.model.js~space",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.model.js",
    "importStyle": "space",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 457,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/space/space.socket.js",
    "memberof": null,
    "longname": "api/space/space.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar SpaceEvents = require('./space.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('space:' + event, socket);\n\n    SpaceEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    SpaceEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 458,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "SpaceEvents",
    "memberof": "api/space/space.socket.js",
    "longname": "api/space/space.socket.js~SpaceEvents",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 459,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/space/space.socket.js",
    "longname": "api/space/space.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 460,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/space/space.socket.js",
    "longname": "api/space/space.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/space/space.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 461,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/space/space.socket.js",
    "longname": "api/space/space.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 462,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/space/space.socket.js",
    "longname": "api/space/space.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/space/space.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 463,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/thing/index.js",
    "memberof": null,
    "longname": "api/thing/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./thing.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 464,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/thing/index.js",
    "longname": "api/thing/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/thing/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 465,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/thing/index.js",
    "longname": "api/thing/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/thing/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 466,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/thing/index.js",
    "longname": "api/thing/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/thing/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 467,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/thing/index.spec.js",
    "memberof": null,
    "longname": "api/thing/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar thingCtrlStub = {\n  index: 'thingCtrl.index',\n  show: 'thingCtrl.show',\n  create: 'thingCtrl.create',\n  update: 'thingCtrl.update',\n  destroy: 'thingCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar thingIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './thing.controller': thingCtrlStub\n});\n\ndescribe('Thing API Router:', function() {\n\n  it('should return an express router instance', function() {\n    thingIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/things', function() {\n\n    it('should route to thing.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'thingCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/things/:id', function() {\n\n    it('should route to thing.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'thingCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/things', function() {\n\n    it('should route to thing.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'thingCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/things/:id', function() {\n\n    it('should route to thing.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'thingCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/things/:id', function() {\n\n    it('should route to thing.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'thingCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/things/:id', function() {\n\n    it('should route to thing.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'thingCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 468,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/thing/index.spec.js",
    "longname": "api/thing/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/thing/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 469,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "thingCtrlStub",
    "memberof": "api/thing/index.spec.js",
    "longname": "api/thing/index.spec.js~thingCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/thing/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 470,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/thing/index.spec.js",
    "longname": "api/thing/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/thing/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 471,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "thingIndex",
    "memberof": "api/thing/index.spec.js",
    "longname": "api/thing/index.spec.js~thingIndex",
    "access": null,
    "export": false,
    "importPath": "./api/thing/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 472,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/thing/thing.controller.js",
    "memberof": null,
    "longname": "api/thing/thing.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/things              ->  index\n * POST    /api/things              ->  create\n * GET     /api/things/:id          ->  show\n * PUT     /api/things/:id          ->  update\n * DELETE  /api/things/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Thing} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Things\nexport function index(req, res) {\n  Thing.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Thing from the DB\nexport function show(req, res) {\n  Thing.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Thing in the DB\nexport function create(req, res) {\n\t//console.log('thing create 1');\n  Thing.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Thing in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Thing.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Thing from the DB\nexport function destroy(req, res) {\n  Thing.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n"
  },
  {
    "__docId__": 473,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 474,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 475,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 476,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 44,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 477,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 478,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 479,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 480,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 481,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 89,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 482,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/thing/thing.controller.js",
    "longname": "api/thing/thing.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/thing/thing.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 105,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 483,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/thing/thing.events.js",
    "memberof": null,
    "longname": "api/thing/thing.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Thing model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Thing = require('../../sqldb').Thing;\nvar ThingEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nThingEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Thing.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    ThingEvents.emit(event + ':' + doc._id, doc);\n    ThingEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default ThingEvents;\n"
  },
  {
    "__docId__": 484,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Thing",
    "memberof": "api/thing/thing.events.js",
    "longname": "api/thing/thing.events.js~Thing",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 485,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/thing/thing.events.js",
    "longname": "api/thing/thing.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 486,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/thing/thing.events.js",
    "longname": "api/thing/thing.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 487,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/thing/thing.integration.js",
    "memberof": null,
    "longname": "api/thing/thing.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newThing;\n\ndescribe('Thing API:', function() {\n\n  describe('GET /api/things', function() {\n    var things;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/things')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          things = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      things.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/things', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/things')\n        .send({\n          name: 'New Thing',\n          info: 'This is the brand new thing!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newThing = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created thing', function() {\n      newThing.name.should.equal('New Thing');\n      newThing.info.should.equal('This is the brand new thing!!!');\n    });\n\n  });\n\n  describe('GET /api/things/:id', function() {\n    var thing;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/things/' + newThing._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          thing = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      thing = {};\n    });\n\n    it('should respond with the requested thing', function() {\n      thing.name.should.equal('New Thing');\n      thing.info.should.equal('This is the brand new thing!!!');\n    });\n\n  });\n\n  describe('PUT /api/things/:id', function() {\n    var updatedThing;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/things/' + newThing._id)\n        .send({\n          name: 'Updated Thing',\n          info: 'This is the updated thing!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedThing = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedThing = {};\n    });\n\n    it('should respond with the updated thing', function() {\n      updatedThing.name.should.equal('Updated Thing');\n      updatedThing.info.should.equal('This is the updated thing!!!');\n    });\n\n  });\n\n  describe('DELETE /api/things/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/things/' + newThing._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when thing does not exist', function(done) {\n      request(app)\n        .delete('/api/things/' + newThing._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 488,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/thing/thing.integration.js",
    "longname": "api/thing/thing.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 489,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/thing/thing.model.js",
    "memberof": null,
    "longname": "api/thing/thing.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('Thing', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: DataTypes.STRING,\n    info: DataTypes.STRING,\n    active: DataTypes.BOOLEAN\n  });\n}\n"
  },
  {
    "__docId__": 490,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "thing",
    "memberof": "api/thing/thing.model.js",
    "longname": "api/thing/thing.model.js~thing",
    "access": null,
    "export": true,
    "importPath": "./api/thing/thing.model.js",
    "importStyle": "thing",
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 491,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/thing/thing.socket.js",
    "memberof": null,
    "longname": "api/thing/thing.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar ThingEvents = require('./thing.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('thing:' + event, socket);\n\n    ThingEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    ThingEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 492,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "ThingEvents",
    "memberof": "api/thing/thing.socket.js",
    "longname": "api/thing/thing.socket.js~ThingEvents",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 493,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/thing/thing.socket.js",
    "longname": "api/thing/thing.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 494,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/thing/thing.socket.js",
    "longname": "api/thing/thing.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/thing/thing.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 495,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/thing/thing.socket.js",
    "longname": "api/thing/thing.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 496,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/thing/thing.socket.js",
    "longname": "api/thing/thing.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/thing/thing.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 497,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/timeslot/index.js",
    "memberof": null,
    "longname": "api/timeslot/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./voucher.controller');\n\nvar router = express.Router();\n\n//default function for voucher table\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\n//for user voucher table\nrouter.get('/vuser', controller.findAllUserVoucher);\nrouter.get('/:id/vuser', controller.findUserVoucher);\nrouter.post('/vuser/', controller.createUserVoucher);\nrouter.put('/:id/vuser', controller.updateUserVoucher);\nrouter.delete('/:id/vuser', controller.deleteUserVoucher);\n\n//for group trade table\nrouter.get('/gtrade', controller.findAllGroupTrade);\nrouter.get('/:id/gtrade', controller.findGroupTrade);\nrouter.post('/gtrade/', controller.createGroupTrade);\nrouter.put('/:id/gtrade', controller.updateGroupTrade);\nrouter.delete('/:id/gtrade', controller.deleteGroupTrade);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 498,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/timeslot/index.js",
    "longname": "api/timeslot/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 499,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/timeslot/index.js",
    "longname": "api/timeslot/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 500,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/timeslot/index.js",
    "longname": "api/timeslot/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 501,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/timeslot/index.spec.js",
    "memberof": null,
    "longname": "api/timeslot/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 502,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/timeslot/index.spec.js",
    "longname": "api/timeslot/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 503,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/timeslot/index.spec.js",
    "longname": "api/timeslot/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 504,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/timeslot/index.spec.js",
    "longname": "api/timeslot/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 505,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/timeslot/index.spec.js",
    "longname": "api/timeslot/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 506,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/timeslot/timeslot.controller.js",
    "memberof": null,
    "longname": "api/timeslot/timeslot.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Nut} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Nuts\nexport function index(req, res) {\n  Nut.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Nut from the DB\nexport function show(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Nut in the DB\nexport function create(req, res) {\n    //console.log('Nut create req.body:', JSON.stringify(req.body));\n    var nutData = req.body;\n    var typeName;\n    for(var key in nutData){\n  \t  if(key.toLowerCase() === 'type' || key.toLowerCase() === 'typename'){\n  \t\t  typeName = nutData[key];\n  \t\t  delete nutData[key]; \n  \t  }\n    }\n\t\n\tif(nutData.name){\n\t\tvar nutName = nutData.name;\n\t\tdelete nutData.name;\n\t}\n  \n    if(typeName && nutName){\n\t\tconsole.log('create nut typeName:',typeName);\n  \t  Nut.addType(typeName).then(function(type){\n  \t\t  nutData.typeId = type._id;\n  \t      Nut.findOrCreate({\n\t\t\t  where: {name: nutName},\n\t\t\t  defaults:nutData})\n  \t      .then(respondWithResult(res, 201))\n  \t      .catch(handleError(res));\n  \t  })\n    } else {\n\t      Nut.findOrCreate({\n\t\t  \t\twhere: {name: nutName},\n\t\t  \t\tdefaults:nutData})\n\t      \t.then(respondWithResult(res, 201))\n\t      \t.catch(handleError(res));\n    } \n}\n\n// Updates an existing Nut in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Nut from the DB\nexport function destroy(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function findOrCreate(req, res){\n\t\n}\n"
  },
  {
    "__docId__": 507,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 508,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 509,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 510,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 44,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 511,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 512,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 513,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 514,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 515,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 117,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 516,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 133,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 517,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findOrCreate",
    "memberof": "api/timeslot/timeslot.controller.js",
    "longname": "api/timeslot/timeslot.controller.js~findOrCreate",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.controller.js",
    "importStyle": "{findOrCreate}",
    "description": null,
    "lineNumber": 144,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 518,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/timeslot/timeslot.events.js",
    "memberof": null,
    "longname": "api/timeslot/timeslot.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 519,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/timeslot/timeslot.events.js",
    "longname": "api/timeslot/timeslot.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 520,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/timeslot/timeslot.events.js",
    "longname": "api/timeslot/timeslot.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 521,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/timeslot/timeslot.events.js",
    "longname": "api/timeslot/timeslot.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 522,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/timeslot/timeslot.integration.js",
    "memberof": null,
    "longname": "api/timeslot/timeslot.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 523,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/timeslot/timeslot.integration.js",
    "longname": "api/timeslot/timeslot.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 524,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/timeslot/timeslot.model.js",
    "memberof": null,
    "longname": "api/timeslot/timeslot.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport _ from 'lodash';\nvar Promise = require('bluebird');\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('Timeslot', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING\n    },\n    spaceId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\towner: {\n\t\ttype: DataTypes.STRING\n\t},\n\townerId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\talias: DataTypes.STRING,\n\tdescription: DataTypes.STRING,\n\tstartTime: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tendTime: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n    active: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\n\t  \taddTimeslots: function(timeslotListData, ownerData){\n\n\t  \t\t//console.log('addTimeslots timeslotListData:', JSON.stringify(timeslotListData));\n\n\t  \t\tvar count = 0;\n\t  \t\tvar flist = [];\n\t  \t\tvar that = this;\n\n\t  \t\tfor(var key in timeslotListData){\n\t  \t\t\t//console.log('addTimeslots timeslotListData[key]:', JSON.stringify(timeslotListData[key]));\n\t  \t\t\tvar timeslotData = Object.assign({},timeslotListData[key]);\n\t  \t\t\t//console.log('addTimeslots timeslotData:', JSON.stringify(timeslotData));\n\t  \t\t\ttimeslotData.name = key;\n\t  \t\t\t//console.log('addTimeslots timeslotData:', JSON.stringify(timeslotData));\n\t  \t\t\tflist.push(timeslotData);\n\t  \t\t}\n\n\t  \t\t//console.log('addTimeslots flist:', JSON.stringify(flist));\n\n\t  \t\treturn Promise.each(flist, function(timeslotData){\n\t  \t\t\t//console.log('addTimeslots timeslotData:', JSON.stringify(timeslotData));\n\t  \t\t\treturn that.addTimeslot(timeslotData, ownerData);\n\t  \t\t}).then(function(){\n\t  \t\t\treturn Promise.resolve(count);\n\t  \t\t});\n\t  \t},\n\n\t  \taddTimeslot: function(timeslotData, ownerData){\n\n\t  \t\t//console.log('addTimeslot timeslotData:', JSON.stringify(timeslotData));\n\n\t  \t\tvar timeslots = this.populateTimeslots(timeslotData,ownerData);\n\n\t  \t\ttimeslots.forEach(function(timeslot){\n\t\t\t\ttimeslot.name = timeslotData.name;\n\t  \t\t\ttimeslot.spaceId = ownerData.spaceId;\n\t  \t\t\ttimeslot.owner = ownerData.owner;\n\t  \t\t\ttimeslot.ownerId = ownerData.ownerId;\n\t  \t\t});\n\t\t\tvar list = [];\n\t\t\tvar that = this;\n\t\t\tvar i=0;\n\t\t\t//console.log('addTimeslot timeslots:', JSON.stringify(timeslots));\n\t\t\treturn Promise.each(timeslots,function(ts){\n\t\t\t\t//console.log('timeslot ts:'+ i++,JSON.stringify(ts));\n\t\t\t\treturn that.findOrCreate({\n\t\t\t\t\twhere: {\n\t\t\t\t\t\tname: ts.name,\n\t\t\t\t\t\towner: ts.owner,\n\t\t\t\t\t\townerId: ts.ownerId\n\t\t\t\t\t},\n\t\t\t\t\tdefaults:ts\n\t\t\t\t}).spread(function(timeslot,created){\n\t\t\t\t\t//console.log('timeslot created:',created);\n\t\t\t\t\tlist.push(timeslot);\n\t\t\t\t});\n\t\t\t}).then(function(){\n\t\t\t\treturn Promise.resolve(list);\n\t\t\t})\n\t\t\t  \n\t\t\t//console.log('2 addTimeslot timeslots:', JSON.stringify(timeslots));\n\n\t  \t\t//return this.bulkCreate(timeslots);\n\t  \t},\n\n\t  \tdateAdd: function(date, interval, units) {\n\t\t\t//console.log(\"interval:unit***\",interval+\":\"+units);\n\t\t\tvar ret = new Date(date); //don't change original date\n\t\t\t//console.log('1 ret:',ret);\n\t\t\tswitch (interval.toLowerCase()) {\n\t\t\t\tcase 'year':\n\t\t\t\t\tret.setFullYear(ret.getFullYear() + units);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'quarter':\n\t\t\t\t\tret.setMonth(ret.getMonth() + 3 * units);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'month':\n\t\t\t\t\tret.setMonth(ret.getMonth() + units);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'week':\n\t\t\t\t\tret.setDate(ret.getDate() + 7 * units);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'day':\n\t\t\t\t\tret.setDate(ret.getDate() + units);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hour':\n\t\t\t\t\tret.setTime(ret.getTime() + units * 3600000);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'minute':\n\t\t\t\t\tret.setTime(ret.getTime() + units * 60000);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'second':\n\t\t\t\t\tret.setTime(ret.getTime() + units * 1000);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tret = undefined;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t//console.log('2 ret:',ret);\n\t\t\treturn ret;\n\t\t},\n\n\t\tpopulateTimeslots: function(timeslotConfig,context) {\n\n\t\t\t//console.log('populateTimeslots timeslotConfig:', JSON.stringify(timeslotConfig));\n\t\n\t\t\t/**\n\t\t\t   \t* timeslotConfig format: \n\t\t\t   \t{\n\t\t\t\t\tstartTime: DateTime\n\t\t\t\t\tendTime: DateTime\n\t\t\t\t\tstartTime.offset.value: 100 or +100 or -100\n\t\t\t\t\tendTime.offset.unit: second, minute, hour, day, week, month, quarter, year\n\t\t\t\t\trepeat.value: integer\n\t\t\t\t\trepeat.timeUnit: second, minute, hour, day, week, month, quarter, year\n\t\t\t\t\trepeat.startTime: DateTime\n\t\t\t\t\trepeat.endTime: DateTime\n\t\t\t\t\trepeat.interval: number,\n\t\t\t\t\ttimeSplit: integer\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t   \t* return: array of timeslot\n\t\t\t   \t*/\n\n\t\t\tvar timeslots = [];\n\n\t\t\tif (typeof timeslotConfig === 'object') {\n\t\t\t\t//console.log('xxx');\n\t\t\t\tvar ts = {};\n\t\t\t\tvar startTime;\n\t\t\t\tvar endTime;\n\t\t\t\tstartTime = Date.now();\n\t\t\t\tendTime = Date.now();\n\t\t\t\t\n\t\t\t\tif (timeslotConfig.startTime && !isNaN(timeslotConfig.startTime)) {\n\t\t\t\t\tstartTime = timeslotConfig.startTime;\n\t\t\t\t}\n\t\t\t\tif (context && context.startTime && !isNaN(context.startTime)) {\n\t\t\t\t\tstartTime = context.startTime;\n\t\t\t\t}\n\t\t\t\tif (timeslotConfig.endTime && !isNaN(timeslotConfig.endTime)) {\n\t\t\t\t\tendTime = timeslotConfig.endTime;\n\t\t\t\t}\n\t\t\t\tif (context && context.endTime && !isNaN(context.endTime)) {\n\t\t\t\t\tendTime = context.endTime;\n\t\t\t\t}\n\n\t\t\t\tvar timeUint = 'day';\n\t\t\t\tif (timeslotConfig.timeUnit) {\n\t\t\t\t\ttimeUnit = timeslotConfig.timeUnit;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//console.log(\"1 startTime:endTime:\",startTime + \":\" + endTime);\n\t\t\t\t\n\t\t\t\tif(timeslotConfig['startTime.offset.value'] && timeslotConfig['startTime.offset.unit']){\n\t\t\t\t\t//console.log('yyy dataAdd:', this.dateAdd);\n\t\t\t\t\tstartTime = this.dateAdd(startTime, timeslotConfig[\"startTime.offset.unit\"], timeslotConfig[\"startTime.offset.value\"]).getTime();\n\t\t\t\t}\n\t\t\t\tif(timeslotConfig['endTime.offset.value'] && timeslotConfig['endTime.offset.unit']){\n\t\t\t\t\t//console.log('zzz');\n\t\t\t\t\tendTime = this.dateAdd(endTime, timeslotConfig[\"endTime.offset.unit\"], timeslotConfig[\"endTime.offset.value\"]).getTime();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//console.log(\"2 startTime:endTime:\",startTime + \":\" + endTime);\n\t\t\t\t\n\t\t\t\t/*\n\t\t\t\tif(timeslotConfig.hasOwnProperty('startTime') && typeof timeslotConfig.startTime === 'object'){\n\t\t\t\t\tconsole.log(1);\n\t\t\t\t\tif(timeslotConfig.startTime.offset && typeof timeslotConfig.startTime.offset === 'object'){\n\t\t\t\t\t\tconsole.log(2);\n\t\t\t\t\t\tif (timeslotConfig.startTime.offset.value && timeslotConfig.startTime.offset.timeUnit) {\n\t\t\t\t\t\t\tconsole.log(3);\n\t\t\t\t\t\t\tstartTime = dateAdd(startTime, timeslotConfig.startTime.offset.timeUnit, timeslotConfig.startTime.offset.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}*/\n\t\t\t\t/*\n\t\t\t\tif(timeslotConfig.endTime && typeof timeslotConfig.endTime === 'object'){\n\t\t\t\t\t//console.log(1);\n\t\t\t\t\tif(timeslotConfig.endTime.offset && typeof timeslotConfig.endTime.offset === 'object'){\n\t\t\t\t\t\t//console.log(2);\n\t\t\t\t\t\tif (timeslotConfig.endTime.offset.value && timeslotConfig.endTime.offset.timeUnit) {\n\t\t\t\t\t\t\t//console.log(3);\n\t\t\t\t\t\t\tendTime = this.dateAdd(endTime, timeslotConfig.endTime.offset.timeUnit, timeslotConfig.endTime.offset.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t\t\n\t\t\t\t//console.log(\"2 startTime\",startTime);\n\t\t\t\t//console.log(\"2 endTime\",endTime);\n\n\t\t\t\tif (timeslotConfig.timeSplit) {\n\t\t\t\t\tvar split = timeslotConfig.timeSplit;\n\t\t\t\t\tvar splitInterval = (endTime - startTime) / split;\n\t\t\t\t\tvar i = 0;\n\t\t\t\t\twhile (i++ < split) {\n\t\t\t\t\t\tts = {};\n\t\t\t\t\t\tts.name = timeslotConfig.name + '_'+i || \"ts_\"+startTime+\"_\"+i;\n\t\t\t\t\t\tts.startTime = startTime + i * splitInterval;\n\t\t\t\t\t\tts.endTime = endTime + i * splitInterval\n\t\t\t\t\t\ttimeslots.push(ts);\n\t\t\t\t\t}\n\t\t\t\t\treturn timeslots;\n\t\t\t\t}\n\n\t\t\t\t//add first timeslot\n\t\t\t\tvar ts = {\n\t\t\t\t\tname: timeslotConfig.name || 'ts_'+startTime,\n\t\t\t\t\tstartTime: startTime,\n\t\t\t\t\tendTime: endTime\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\ttimeslots.push(ts);\n\n\t\t\t\tif (timeslotConfig.repeat && timeslotConfig.repeat.timeUnit) {\n\t\t\t\t\tvar repeatTimeUnit = timeslotConfig.repeat.timeUnit;\n\t\t\t\t\trepeatInterval = 1;\n\t\t\t\t\tif (timeslotConfig.repeat.interval) {\n\t\t\t\t\t\trepeatInterval = timeslotConfig.repeat.interval;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//by default, max repeat is 10000\n\t\t\t\t\tvar repeat = 10000;\n\t\t\t\t\tif (timeslotConfig.repeat.value) {\n\t\t\t\t\t\trepeat = timeslotConfig.repeat.value;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar i = 1;\n\t\t\t\t\trepeatStartTime = startTime;\n\t\t\t\t\trepeatEndTime = dateAdd(endTime, repeatTimeUnit, repeat);\n\t\t\t\t\tif (timeslotConfig.repeat.startTime) {\n\t\t\t\t\t\trepeatStartTime = timeslotConfig.repeat.startTime;\n\t\t\t\t\t}\n\t\t\t\t\tif (timeslotConfig.repeat.endTime) {\n\t\t\t\t\t\trepeatEndTime = timeslotConfig.repeat.endTime;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (i++ <= repeat) {\n\t\t\t\t\t\tvar ts = {};\n\t\t\t\t\t\tts.name = timeslotConfig.name + \"_\"+i||\"ts_\"+startTime+\"_\"+i;\n\t\t\t\t\t\tts.startTime = dateAdd(startTime, repeatTimeUnit, repeatInterval);\n\t\t\t\t\t\tts.endTime = dateAdd(endTime, repeatTimeUnit, repeateInterval);\n\t\t\t\t\t\tif (ts.startTime > repeatStartTime && ts.endTime <= repeatEndTime) {\n\t\t\t\t\t\t\ttimeslots.push(ts);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ts.endTime > repeatEndTime) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn timeslots;\n\t\t\t}\n\t\t}\n\t  },\n\t}\n  );\n}\n\n\n"
  },
  {
    "__docId__": 525,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/timeslot/timeslot.model.js",
    "longname": "api/timeslot/timeslot.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 526,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "timeslot",
    "memberof": "api/timeslot/timeslot.model.js",
    "longname": "api/timeslot/timeslot.model.js~timeslot",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.model.js",
    "importStyle": "timeslot",
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 527,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/timeslot/timeslot.socket.js",
    "memberof": null,
    "longname": "api/timeslot/timeslot.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 528,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/timeslot/timeslot.socket.js",
    "longname": "api/timeslot/timeslot.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 529,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/timeslot/timeslot.socket.js",
    "longname": "api/timeslot/timeslot.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 530,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/timeslot/timeslot.socket.js",
    "longname": "api/timeslot/timeslot.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/timeslot/timeslot.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 531,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/timeslot/timeslot.socket.js",
    "longname": "api/timeslot/timeslot.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 532,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/timeslot/timeslot.socket.js",
    "longname": "api/timeslot/timeslot.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/timeslot/timeslot.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 533,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/account.model.js",
    "memberof": null,
    "longname": "api/trade/account.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('Price', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING\n    },\n\talias: DataTypes.STRING,\n\tdescription: DataTypes.STRING,\n\tprice: {\n\t\ttype: DataTypes.DECIMAL,\n\t\tdefaultValue: -1\n\t},\n\tcurrency: DataTypes.STRING,\n\tchangeAmount: {\n\t\ttype: DataTypes.DECIMAL,\n\t\tdefaultValue: 0\n\t},\n\tchangeMode:  {\n\t\ttype: DataTypes.ENUM('add','deduct'),\n\t\tdefaultValue: 'deduct'\n\t},\n\tchangeUnit: {\n\t\ttype: DataTypes.STRING,\n\t\tdefaultValue: 'currency'\n\t},\n\townerType: {\n\t\ttype: DataTypes.STRING\n\t}, \n\townerId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t}, \n\tparentId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t}, \n\tspaceId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tcircleId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n    active: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\t\t  \n\t  }\n  });\n}\n"
  },
  {
    "__docId__": 534,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "account",
    "memberof": "api/trade/account.model.js",
    "longname": "api/trade/account.model.js~account",
    "access": null,
    "export": true,
    "importPath": "./api/trade/account.model.js",
    "importStyle": "account",
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 535,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/index.js",
    "memberof": null,
    "longname": "api/trade/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./voucher.controller');\n\nvar router = express.Router();\n\n//default function for voucher table\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\n//for user voucher table\nrouter.get('/vuser', controller.findAllUserVoucher);\nrouter.get('/:id/vuser', controller.findUserVoucher);\nrouter.post('/vuser/', controller.createUserVoucher);\nrouter.put('/:id/vuser', controller.updateUserVoucher);\nrouter.delete('/:id/vuser', controller.deleteUserVoucher);\n\n//for group trade table\nrouter.get('/gtrade', controller.findAllGroupTrade);\nrouter.get('/:id/gtrade', controller.findGroupTrade);\nrouter.post('/gtrade/', controller.createGroupTrade);\nrouter.put('/:id/gtrade', controller.updateGroupTrade);\nrouter.delete('/:id/gtrade', controller.deleteGroupTrade);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 536,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/trade/index.js",
    "longname": "api/trade/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/trade/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 537,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/trade/index.js",
    "longname": "api/trade/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/trade/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 538,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/trade/index.js",
    "longname": "api/trade/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/trade/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 539,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/index.spec.js",
    "memberof": null,
    "longname": "api/trade/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 540,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/trade/index.spec.js",
    "longname": "api/trade/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/trade/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 541,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/trade/index.spec.js",
    "longname": "api/trade/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/trade/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 542,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/trade/index.spec.js",
    "longname": "api/trade/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/trade/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 543,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/trade/index.spec.js",
    "longname": "api/trade/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/trade/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 544,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/price.model.js",
    "memberof": null,
    "longname": "api/trade/price.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport _ from 'lodash';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('Price', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: {\n      type: DataTypes.STRING\n    },\n\t\tfullname: {\n      type: DataTypes.STRING\n    },\n\t\talias: DataTypes.STRING,\n\t\tdescription: DataTypes.STRING,\n\t\tprice: {\n\t\t\ttype: DataTypes.DECIMAL,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcurrency: DataTypes.STRING,\n\t\towner: {\n\t\t\ttype: DataTypes.STRING\n\t\t}, \n\t\townerId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t}, \n\t\tparentId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t}, \n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcircleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\t\tactive: DataTypes.BOOLEAN\n\t\t},{\n\t\t\tclassMethods: {\n\t\t\t\t\n\t\t\t}\n  });\n}\n"
  },
  {
    "__docId__": 545,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "price",
    "memberof": "api/trade/price.model.js",
    "longname": "api/trade/price.model.js~price",
    "access": null,
    "export": true,
    "importPath": "./api/trade/price.model.js",
    "importStyle": "price",
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 546,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/trade.controller.js",
    "memberof": null,
    "longname": "api/trade/trade.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Nut} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Nuts\nexport function index(req, res) {\n  Nut.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Nut from the DB\nexport function show(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Nut in the DB\nexport function create(req, res) {\n    //console.log('Nut create req.body:', JSON.stringify(req.body));\n    var nutData = req.body;\n    var typeName;\n    for(var key in nutData){\n  \t  if(key.toLowerCase() === 'type' || key.toLowerCase() === 'typename'){\n  \t\t  typeName = nutData[key];\n  \t\t  delete nutData[key]; \n  \t  }\n    }\n\t\n\tif(nutData.name){\n\t\tvar nutName = nutData.name;\n\t\tdelete nutData.name;\n\t}\n  \n    if(typeName && nutName){\n\t\tconsole.log('create nut typeName:',typeName);\n  \t  Nut.addType(typeName).then(function(type){\n  \t\t  nutData.typeId = type._id;\n  \t      Nut.findOrCreate({\n\t\t\t  where: {name: nutName},\n\t\t\t  defaults:nutData})\n  \t      .then(respondWithResult(res, 201))\n  \t      .catch(handleError(res));\n  \t  })\n    } else {\n\t      Nut.findOrCreate({\n\t\t  \t\twhere: {name: nutName},\n\t\t  \t\tdefaults:nutData})\n\t      \t.then(respondWithResult(res, 201))\n\t      \t.catch(handleError(res));\n    } \n}\n\n// Updates an existing Nut in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Nut from the DB\nexport function destroy(req, res) {\n  Nut.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function findOrCreate(req, res){\n\t\n}\n"
  },
  {
    "__docId__": 547,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 548,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 549,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 550,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 44,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 551,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 552,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 553,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 554,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 555,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 117,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 556,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 133,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 557,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findOrCreate",
    "memberof": "api/trade/trade.controller.js",
    "longname": "api/trade/trade.controller.js~findOrCreate",
    "access": null,
    "export": true,
    "importPath": "./api/trade/trade.controller.js",
    "importStyle": "{findOrCreate}",
    "description": null,
    "lineNumber": 144,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 558,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/trade.events.js",
    "memberof": null,
    "longname": "api/trade/trade.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 559,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/trade/trade.events.js",
    "longname": "api/trade/trade.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 560,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/trade/trade.events.js",
    "longname": "api/trade/trade.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 561,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/trade/trade.events.js",
    "longname": "api/trade/trade.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 562,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/trade.integration.js",
    "memberof": null,
    "longname": "api/trade/trade.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 563,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/trade/trade.integration.js",
    "longname": "api/trade/trade.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 564,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/trade/trade.socket.js",
    "memberof": null,
    "longname": "api/trade/trade.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 565,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/trade/trade.socket.js",
    "longname": "api/trade/trade.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 566,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/trade/trade.socket.js",
    "longname": "api/trade/trade.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 567,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/trade/trade.socket.js",
    "longname": "api/trade/trade.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/trade/trade.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 568,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/trade/trade.socket.js",
    "longname": "api/trade/trade.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 23,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 569,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/trade/trade.socket.js",
    "longname": "api/trade/trade.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/trade/trade.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 29,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 570,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/user/index.js",
    "memberof": null,
    "longname": "api/user/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport {Router} from 'express';\nimport * as controller from './user.controller';\nimport * as auth from '../../auth/auth.service';\n\nvar router = new Router();\n\n//impossible to get all users\n//router.get('/', auth.isAuthenticated(), controller.index);\n//get all users under space, todo: need check whether user is admin of space before get users under space\nrouter.get('/sp/:spaceId', auth.isAuthenticated(), controller.index);\nrouter.delete('/:id', auth.isAuthenticated(), controller.destroy);\nrouter.get('/me', auth.isAuthenticated(), controller.me);\nrouter.put('/:id/password', auth.isAuthenticated(), controller.changePassword);\nrouter.get('/:id', auth.isAuthenticated(), controller.show);\nrouter.post('/', controller.create);\n\n//router.post('/test', controller.test);\n\nexport default router;\n"
  },
  {
    "__docId__": 571,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/user/index.spec.js",
    "memberof": null,
    "longname": "api/user/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar userCtrlStub = {\n  index: 'userCtrl.index',\n  destroy: 'userCtrl.destroy',\n  me: 'userCtrl.me',\n  changePassword: 'userCtrl.changePassword',\n  show: 'userCtrl.show',\n  create: 'userCtrl.create'\n};\n\nvar authServiceStub = {\n  isAuthenticated() {\n    return 'authService.isAuthenticated';\n  },\n  hasRole(role) {\n    return 'authService.hasRole.' + role;\n  }\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar userIndex = proxyquire('./index', {\n  'express': {\n    Router() {\n      return routerStub;\n    }\n  },\n  './user.controller': userCtrlStub,\n  '../../auth/auth.service': authServiceStub\n});\n\ndescribe('User API Router:', function() {\n\n  it('should return an express router instance', function() {\n    userIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/users', function() {\n\n    it('should verify admin role and route to user.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'authService.hasRole.admin', 'userCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/users/:id', function() {\n\n    it('should verify admin role and route to user.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'authService.hasRole.admin', 'userCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/users/me', function() {\n\n    it('should be authenticated and route to user.controller.me', function() {\n      routerStub.get\n        .withArgs('/me', 'authService.isAuthenticated', 'userCtrl.me')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/users/:id/password', function() {\n\n    it('should be authenticated and route to user.controller.changePassword', function() {\n      routerStub.put\n        .withArgs('/:id/password', 'authService.isAuthenticated', 'userCtrl.changePassword')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/users/:id', function() {\n\n    it('should be authenticated and route to user.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'authService.isAuthenticated', 'userCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/users', function() {\n\n    it('should route to user.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'userCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 572,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/user/index.spec.js",
    "longname": "api/user/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/user/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 573,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "userCtrlStub",
    "memberof": "api/user/index.spec.js",
    "longname": "api/user/index.spec.js~userCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/user/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 574,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "authServiceStub",
    "memberof": "api/user/index.spec.js",
    "longname": "api/user/index.spec.js~authServiceStub",
    "access": null,
    "export": false,
    "importPath": "./api/user/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 14,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 575,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/user/index.spec.js",
    "longname": "api/user/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/user/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 23,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 576,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "userIndex",
    "memberof": "api/user/index.spec.js",
    "longname": "api/user/index.spec.js~userIndex",
    "access": null,
    "export": false,
    "importPath": "./api/user/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 31,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 577,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/user/user.controller.js",
    "memberof": null,
    "longname": "api/user/user.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport {User} from '../../sqldb';\nimport {UserRole} from '../../sqldb';\nimport {Role} from '../../sqldb';\nimport passport from 'passport';\nimport config from '../../config/environment';\nimport jwt from 'jsonwebtoken';\n\nfunction validationError(res, statusCode) {\n  statusCode = statusCode || 422;\n  return function(err) {\n    res.status(statusCode).json(err);\n  }\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n\n  User.belongsToMany(Role, { as: 'roles', through: UserRole});\n  Role.belongsToMany(User, { as: 'users', through: UserRole});\n\n  User.findAll({\n    attributes: [\n      '_id',\n      'name',\n      'loginId',\n      'email',\n      //'role',\n      'provider'\n    ],\n    include: [\n      {\n        model: Role, as: 'roles'\n      }\n    ]\n  })\n    .then(users => {\n      res.status(200).json(users);\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Creates a new user\n */\nexport function create(req, res, next) {\n  var newUser = User.build(req.body);\n  newUser.setDataValue('provider', 'local');\n  newUser.setDataValue('role', 'user');\n  newUser.save()\n    .then(function(user) {\n      var token = jwt.sign({ _id: user._id }, config.secrets.session, {\n        expiresIn: 60 * 60 * 5\n      });\n      res.json({ token });\n    })\n    .catch(validationError(res));\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n  var userId = req.params.id;\n\n  User.belongsToMany(Role, { as: 'roles', through: UserRole});\n  Role.belongsToMany(User, { as: 'users', through: UserRole});\n\n  User.find({\n    where: {\n      _id: userId\n    },\n    include: [\n      {\n        model: Role, as: 'roles'\n      }\n    ]\n  })\n    .then(user => {\n      if (!user) {\n        return res.status(404).end();\n      }\n      res.json(user.profile);\n    })\n    .catch(err => next(err));\n}\n\n/**\n * Deletes a user\n * restriction: 'admin'\n */\nexport function destroy(req, res) {\n  User.destroy({ _id: req.params.id })\n    .then(function() {\n      res.status(204).end();\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Change a users password\n */\nexport function changePassword(req, res, next) {\n  var userId = req.user._id;\n  var oldPass = String(req.body.oldPassword);\n  var newPass = String(req.body.newPassword);\n\n  User.find({\n    where: {\n      _id: userId\n    }\n  })\n    .then(user => {\n      if (user.authenticate(oldPass)) {\n        user.password = newPass;\n        return user.save()\n          .then(() => {\n            res.status(204).end();\n          })\n          .catch(validationError(res));\n      } else {\n        return res.status(403).end();\n      }\n    });\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n  var userId = req.user._id;\n  //console.log('req header',req.headers);\n\n  User.belongsToMany(Role, {as: 'roles', through: UserRole});\n  Role.belongsToMany(User, {as: 'users', through: UserRole});\n\n  User.find({\n    where: {\n      _id: userId\n    },\n    attributes: [\n      '_id',\n      'name',\n      'email',\n      'loginId',\n      'role',\n      'provider'\n    ],\n    include: [\n      {\n        model: Role, as: 'roles'\n      }\n    ]\n  })\n    .then(user => { // don't ever give out the password or salt\n      //console.log('me user:', JSON.stringify(user));\n      if (!user) {\n        return res.status(401).end();\n      }\n      res.json(user);\n    })\n    .catch(err => next(err));\n}\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res, next) {\n  res.redirect('/');\n}\n\nexport function test(req, res){\n\t\n}\n\n"
  },
  {
    "__docId__": 578,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "validationError",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~validationError",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 579,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 17,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 580,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{index}",
    "description": "Get list of users\nrestriction: 'admin'",
    "lineNumber": 28,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 581,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{create}",
    "description": "Creates a new user",
    "lineNumber": 57,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "next",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 582,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{show}",
    "description": "Get a single user",
    "lineNumber": 74,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "next",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 583,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{destroy}",
    "description": "Deletes a user\nrestriction: 'admin'",
    "lineNumber": 103,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 584,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "changePassword",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~changePassword",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{changePassword}",
    "description": "Change a users password",
    "lineNumber": 114,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "next",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 585,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "me",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~me",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{me}",
    "description": "Get my info",
    "lineNumber": 141,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "next",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 586,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "authCallback",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~authCallback",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{authCallback}",
    "description": "Authentication callback",
    "lineNumber": 179,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "next",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 587,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "test",
    "memberof": "api/user/user.controller.js",
    "longname": "api/user/user.controller.js~test",
    "access": null,
    "export": true,
    "importPath": "./api/user/user.controller.js",
    "importStyle": "{test}",
    "description": null,
    "lineNumber": 183,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 588,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/user/user.events.js",
    "memberof": null,
    "longname": "api/user/user.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * User model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nimport {User} from '../../sqldb';\nvar UserEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nUserEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  User.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    UserEvents.emit(event + ':' + doc._id, doc);\n    UserEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default UserEvents;\n"
  },
  {
    "__docId__": 589,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/user/user.events.js",
    "longname": "api/user/user.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 590,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/user/user.events.js",
    "longname": "api/user/user.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 591,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/user/user.integration.js",
    "memberof": null,
    "longname": "api/user/user.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport app from '../..';\nimport {User} from '../../sqldb';\nimport request from 'supertest';\n\ndescribe('User API:', function() {\n  var user;\n\n  // Clear users before testing\n  before(function() {\n    return User.destroy({ where: {} }).then(function() {\n      user = User.build({\n        name: 'Fake User',\n        email: 'test@example.com',\n        password: 'password'\n      });\n\n      return user.save();\n    });\n  });\n\n  // Clear users after testing\n  after(function() {\n    return User.destroy({ where: {} });\n  });\n\n  describe('GET /api/users/me', function() {\n    var token;\n\n    before(function(done) {\n      request(app)\n        .post('/auth/local')\n        .send({\n          email: 'test@example.com',\n          password: 'password'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          token = res.body.token;\n          done();\n        });\n    });\n\n    it('should respond with a user profile when authenticated', function(done) {\n      request(app)\n        .get('/api/users/me')\n        .set('authorization', 'Bearer ' + token)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          res.body._id.toString().should.equal(user._id.toString());\n          done();\n        });\n    });\n\n    it('should respond with a 401 when not authenticated', function(done) {\n      request(app)\n        .get('/api/users/me')\n        .expect(401)\n        .end(done);\n    });\n  });\n});\n"
  },
  {
    "__docId__": 592,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/user/user.model.js",
    "memberof": null,
    "longname": "api/user/user.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport crypto from 'crypto';\nvar authTypes = ['github', 'twitter', 'facebook', 'google'];\n\nvar validatePresenceOf = function(value) {\n  return value && value.length;\n};\n\nmodule.exports = function(sequelize, DataTypes) {\n  var User = sequelize.define('User', {\n\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    loginId: {\n      type: DataTypes.STRING,\n      unique: {\n        msg: 'The specified loginId is already in use.'\n      }\n    },\n    name: DataTypes.STRING,\n    familyname: DataTypes.STRING,\n    surname: DataTypes.STRING,\n    email: {\n      type: DataTypes.STRING,\n      unique: {\n        msg: 'The specified email address is already in use.'\n      },\n      validate: {\n        isEmail: true\n      }\n    },\n    mobile: {\n      type: DataTypes.STRING,\n      unique: {\n        msg: 'The specified mobile is already in use.'\n      },\n      validate: {\n        isNumberic: true\n      }\n    },\n    birth: {\n      type: DataTypes.DATE,\n    },\n    gender: {\n      type: DataTypes.ENUM('male','female'),\n    },\n    address: {\n      type: DataTypes.STRING,\n    },\n    role: {\n      type: DataTypes.STRING,\n      defaultValue: 'user'\n    },\n    password: {\n      type: DataTypes.STRING,\n      validate: {\n        notEmpty: true\n      }\n    },\n    description: DataTypes.STRING,\n    provider: DataTypes.STRING,\n    salt: DataTypes.STRING,\n    facebook: DataTypes.TEXT,\n    twitter: DataTypes.TEXT,\n    google: DataTypes.TEXT,\n    github: DataTypes.TEXT\n  }, {\n\n    /**\n     * Virtual Getters\n     */\n     getterMethods: {\n      // Public profile information\n      profile: function() {\n        return {\n          'name': this.name,\n          'familyname': this.familyname,\n          'surname': this.surname,\n          'fullname': this.familyname + ' '+ this.surname,\n          'gender': this.gender,\n          'age': this.age\n        };\n      },\n      age: function(){\n\n        var today = new Date();\n        var birth = new Date(this.birth);\n        return today.getFullYear() - birth.getFullYear();\n      },\n\n      // Non-sensitive info we'll be putting in the token\n      token: function() {\n        return {\n          '_id': this._id,\n          'role': this.role\n        };\n      }\n    },\n\n    /**\n     * Pre-save hooks\n     */\n     hooks: {\n      beforeBulkCreate: function(users, fields, fn) {\n        var totalUpdated = 0;\n        users.forEach(function(user) {\n          user.updatePassword(function(err) {\n            if (err) {\n              return fn(err);\n            }\n            totalUpdated += 1;\n            if (totalUpdated === users.length) {\n              return fn();\n            }\n          });\n        });\n      },\n      beforeCreate: function(user, fields, fn) {\n        user.updatePassword(fn);\n      },\n      beforeUpdate: function(user, fields, fn) {\n        if (user.changed('password')) {\n          return user.updatePassword(fn);\n        }\n        fn();\n      }\n    },\n\n    /**\n     * Instance Methods\n     */\n     instanceMethods: {\n      /**\n       * Authenticate - check if the passwords are the same\n       *\n       * @param {String} password\n       * @param {Function} callback\n       * @return {Boolean}\n       * @api public\n       */\n       authenticate: function(password, callback) {\n        if (!callback) {\n          return this.password === this.encryptPassword(password);\n        }\n\n        var _this = this;\n        this.encryptPassword(password, function(err, pwdGen) {\n          if (err) {\n            callback(err);\n          }\n\n          if (_this.password === pwdGen) {\n            callback(null, true);\n          }\n          else {\n            callback(null, false);\n          }\n        });\n      },\n\n      /**\n       * Make salt\n       *\n       * @param {Number} byteSize Optional salt byte size, default to 16\n       * @param {Function} callback\n       * @return {String}\n       * @api public\n       */\n       makeSalt: function(byteSize, callback) {\n        var defaultByteSize = 16;\n\n        if (typeof arguments[0] === 'function') {\n          callback = arguments[0];\n          byteSize = defaultByteSize;\n        }\n        else if (typeof arguments[1] === 'function') {\n          callback = arguments[1];\n        }\n\n        if (!byteSize) {\n          byteSize = defaultByteSize;\n        }\n\n        if (!callback) {\n          return crypto.randomBytes(byteSize).toString('base64');\n        }\n\n        return crypto.randomBytes(byteSize, function(err, salt) {\n          if (err) {\n            callback(err);\n          }\n          return callback(null, salt.toString('base64'));\n        });\n      },\n\n      /**\n       * Encrypt password\n       *\n       * @param {String} password\n       * @param {Function} callback\n       * @return {String}\n       * @api public\n       */\n       encryptPassword: function(password, callback) {\n        if (!password || !this.salt) {\n          if (!callback) {\n            return null;\n          }\n          return callback(null);\n        }\n\n        var defaultIterations = 10000;\n        var defaultKeyLength = 64;\n        var salt = new Buffer(this.salt, 'base64');\n\n        if (!callback) {\n          return crypto.pbkdf2Sync(password, salt, defaultIterations, defaultKeyLength)\n          .toString('base64');\n        }\n\n        return crypto.pbkdf2(password, salt, defaultIterations, defaultKeyLength,\n          function(err, key) {\n            if (err) {\n              callback(err);\n            }\n            return callback(null, key.toString('base64'));\n          });\n      },\n\n      /**\n       * Update password field\n       *\n       * @param {Function} fn\n       * @return {String}\n       * @api public\n       */\n       updatePassword: function(fn) {\n        // Handle new/update passwords\n        if (this.password) {\n          if (!validatePresenceOf(this.password) && authTypes.indexOf(this.provider) === -1) {\n            fn(new Error('Invalid password'));\n          }\n\n          // Make salt with a callback\n          var _this = this;\n          this.makeSalt(function(saltErr, salt) {\n            if (saltErr) {\n              fn(saltErr);\n            }\n            _this.salt = salt;\n            _this.encryptPassword(_this.password, function(encryptErr, hashedPassword) {\n              if (encryptErr) {\n                fn(encryptErr);\n              }\n              _this.password = hashedPassword;\n              fn(null);\n            });\n          });\n        } else {\n          fn(null);\n        }\n      }\n    }\n  });\n\nreturn User;\n};\n"
  },
  {
    "__docId__": 593,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "authTypes",
    "memberof": "api/user/user.model.js",
    "longname": "api/user/user.model.js~authTypes",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 594,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "validatePresenceOf",
    "memberof": "api/user/user.model.js",
    "longname": "api/user/user.model.js~validatePresenceOf",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "params": [
      {
        "name": "value",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 595,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "exports",
    "memberof": "api/user/user.model.js",
    "longname": "api/user/user.model.js~exports",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 596,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/user/user.model.spec.js",
    "memberof": null,
    "longname": "api/user/user.model.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport app from '../..';\nimport {User} from '../../sqldb';\nvar user;\nvar genUser = function() {\n  user = User.build({\n    provider: 'local',\n    name: 'Fake User',\n    email: 'test@example.com',\n    password: 'password'\n  });\n  return user;\n};\n\ndescribe('User Model', function() {\n  before(function() {\n    // Sync and clear users before testing\n    return User.sync().then(function() {\n      return User.destroy({ where: {} });\n    });\n  });\n\n  beforeEach(function() {\n    genUser();\n  });\n\n  afterEach(function() {\n    return User.destroy({ where: {} });\n  });\n\n  it('should begin with no users', function() {\n    return User.findAll().should\n      .eventually.have.length(0);\n  });\n\n  it('should fail when saving a duplicate user', function() {\n    return user.save()\n      .then(function() {\n        var userDup = genUser();\n        return userDup.save();\n      }).should.be.rejected;\n  });\n\n  describe('#email', function() {\n    it('should fail when saving without an email', function() {\n      user.email = '';\n      return user.save().should.be.rejected;\n    });\n  });\n\n  describe('#password', function() {\n    beforeEach(function() {\n      return user.save();\n    });\n\n    it('should authenticate user if valid', function() {\n      user.authenticate('password').should.be.true;\n    });\n\n    it('should not authenticate user if invalid', function() {\n      user.authenticate('blah').should.not.be.true;\n    });\n\n    it('should remain the same hash unless the password is updated', function() {\n      user.name = 'Test User';\n      return user.save()\n        .then(function(u) {\n          return u.authenticate('password');\n        }).should.eventually.be.true;\n    });\n  });\n\n});\n"
  },
  {
    "__docId__": 597,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "genUser",
    "memberof": "api/user/user.model.spec.js",
    "longname": "api/user/user.model.spec.js~genUser",
    "access": null,
    "export": false,
    "importPath": "./api/user/user.model.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "params": [],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 598,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/index.js",
    "memberof": null,
    "longname": "api/voucher/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./voucher.controller');\n\nvar router = express.Router();\n\n//for user voucher table\n//router.get('/users', controller.findAllUserVoucher);\n//router.post('/users/', controller.addUserVoucher);\n//router.delete('/users/:id', controller.deleteUserVoucher);\n\n//for voucher type table\n//router.get('/types', controller.getTypes);\n//router.get('/types/:id', controller.getType);\n//router.post('/types/', controller.addType);\n//router.delete('/type/:id', controller.deleteType);\n\n//for voucher attribute table\n//router.get('/attributes', controller.findAllAttribute);\n//router.post('/attributes', controller.addAttribute);\n//router.delete('/attributes/:id', controller.deleteAttribute);\n\n//for voucher permit table\n//router.get('/permit', controller.findAllPermit);\n//router.post('/permit', controller.addPermit);\n//router.delete('/permit/:id', controller.deletePermit);\n\n//for voucher timeslot table\n//router.get('/timeslot', controller.findAllTimeslot);\n//router.post('/timeslot', controller.addTimeslot);\n//router.delete('/timeslot/:id', controller.deleteTimeslot);\n\n//default function for voucher table\nrouter.get('/', controller.index);\n//router.get('/types', controller.getTypes);\nrouter.get('/:id', controller.show);\n//router.post('/types', controller.addType);\nrouter.post('/', controller.create);\nrouter.post('/bulk', controller.bulkCreate);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 599,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/voucher/index.js",
    "longname": "api/voucher/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 600,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/voucher/index.js",
    "longname": "api/voucher/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 601,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/voucher/index.js",
    "longname": "api/voucher/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 602,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/index.spec.js",
    "memberof": null,
    "longname": "api/voucher/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar appCtrlStub = {\n  index: 'appCtrl.index',\n  show: 'appCtrl.show',\n  create: 'appCtrl.create',\n  update: 'appCtrl.update',\n  destroy: 'appCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar appIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './app.controller': appCtrlStub\n});\n\ndescribe('App API Router:', function() {\n\n  it('should return an express router instance', function() {\n    appIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/apps', function() {\n\n    it('should route to app.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'appCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n\n    it('should route to app.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'appCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n\n    it('should route to app.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'appCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/apps/:id', function() {\n\n    it('should route to app.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'appCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should route to app.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'appCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 603,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/voucher/index.spec.js",
    "longname": "api/voucher/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 604,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appCtrlStub",
    "memberof": "api/voucher/index.spec.js",
    "longname": "api/voucher/index.spec.js~appCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 605,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/voucher/index.spec.js",
    "longname": "api/voucher/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 606,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "appIndex",
    "memberof": "api/voucher/index.spec.js",
    "longname": "api/voucher/index.spec.js~appIndex",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 607,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/voucher.controller.js",
    "memberof": null,
    "longname": "api/voucher/voucher.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/apps              ->  index\n * POST    /api/apps              ->  create\n * GET     /api/apps/:id          ->  show\n * PUT     /api/apps/:id          ->  update\n * DELETE  /api/apps/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Voucher} from '../../sqldb';\nimport {User} from '../../sqldb';\nimport {Role} from '../../sqldb';\nimport {UserRole} from '../../sqldb';\nimport {Timeslot} from '../../sqldb';\nimport {Category} from '../../sqldb';\nimport {Attribute} from '../../sqldb';\nvar Promise = require('bluebird');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function (entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function (entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Vouchers\nexport function index(req, res) {\n  Voucher.findAll({\n    where: req.query\n  })\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Voucher from the DB\nexport function show(req, res) {\n  Voucher.hasMany(Attribute, { foreignKey: \"ownerId\", as: \"attributes\" });\n  Voucher.find({\n    where: {\n      _id: req.params.id\n    },\n    include: {\n      model: Attribute, as: \"attributes\",\n      where: {\n        value: {\n          $ne: null\n        }\n      }\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Voucher in the DB\n//post data format:\n/*\n     {\n        \"type\": {\n          \"name\": \"discount.percent\",\n          \"alias\": \"discount_percent\",\n          \"attributes\":{\n            \"unit\":\"percent\"\n          }\n        },\n        \"name\": \"discount_percent_10\",\n        \"alias\": \"9折券\",\n        \"description\":\"\",\n        \"value\": \"10\",\n        \"grants\": {\n          \"customer\": \"allow.apply,allow.collect,allow.use\",\n          \"manager\": \"allow.issue\",\n          \"cashier\": \"allow.cash\",\n          \"admin\": \"allow.admin\"\n        },\n        \"timeslots\": {\n          \"use\": {\n            \"start\": \"now\",//if not provice start or end, default is now\n            \"start.offset.value\": -10,\n            \"start.offset.unit\": \"day\",\n            \"end\": \"now\",\n            \"end.offset.value\": 10,\n            \"end.offset.unit\": \"day\"\n          },\n          \"collect\": {\n            \"start\": \"now\",\n            \"start.offset.value\": -10,\n            \"start.offset.unit\": \"day\",\n            \"end\": \"now\",\n            \"end.offset.value\": 10,\n            \"end.offset.unit\": \"day\" \n          },\n        }\n      }\n*/\nexport function create(req, res) {\n\n  var voucherData = req.body;\n\n  if (req.query.spaceId) {\n    voucherData.spaceId = req.query.spaceId;\n  }\n\n  Voucher.add(voucherData)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function bulkCreate(req, res) {\n  var vouchers = req.body;\n  if (req.query.spaceId) {\n    vouchers.forEach(function (v) {\n      v.spaceId = req.query.spaceId;\n    })\n  }\n  //console.log('vouchers in bulkCreate:', JSON.stringify(vouchers));\n  Voucher.bulkAdd(vouchers)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Updates an existing Voucher in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Voucher.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Voucher from the DB\nexport function destroy(req, res) {\n  Voucher.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function findAllUserVoucher(req, res) {\n  VoucherUser.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function findUserVoucher(req, res) {\n  VoucherUser.find({\n    where: {\n      userId: req.params.userId\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n/*\nmethod: post\npost data format: {\n  userId: xxx,\n  typeId: xxx,\n  startTime: xxx[optional],\n  endTime: xxx[optional]\n}\nthis function do things below:\n1. find spaceId from typeId\n2. populate timeslot from attributes of type\n3. check permit according to user' role with setting in voucher type\n4. check voucher exist or not, then ignore or add\n*/\n///*\nexport function addUserVoucher(req, res) {\n  //console.log('addUserVoucher req.body:', JSON.stringify(req.body));\n  var body = req.body;\n  var userId;\n  var typeId;\n  var startTime;\n  var endTime;\n  var spaceId;\n  var newVoucher;\n  //if provide status, it will update status accordingly\n  // by default, only choose allow.use voucher to add\n  var voucherStatus = req.body.status || 'allow.use';\n\n  if (!body.userId) {\n    res.status(500).send('please provide userId');\n  } else {\n    userId = body.userId;\n  }\n\n  if (!body.typeId) {\n    res.status(500).send('please provide typeId');\n  } else {\n    typeId = body.typeId;\n  }\n\n  startTime = body.startTime || null;\n  endTime = body.endTime || null;\n\n  var theType;\n\n  return Voucher.getType(typeId).then(function (type) {\n    theType = type;\n    //console.log('addUserVoucher type:', JSON.stringify(type));\n    spaceId = type.spaceId;\n    var attributes = type.attributes;\n    var attrObj = Attribute.toObject(attributes);\n    var timeSlotData = attrObj.timeslot;\n    var grantData = attrObj.grant;\n\n    User.belongsToMany(Role, { as: 'roles', through: UserRole });\n    Role.belongsToMany(User, { as: 'users', through: UserRole });\n\n    return User.find({\n      where: {\n        _id: userId\n      },\n      include: [\n        {\n          model: Role, as: 'roles'\n        }\n      ]\n    }).then(function (user) {\n      //console.log('addUserVoucher user:', JSON.stringify(user));\n      console.log('addUserVoucher grantData:', JSON.stringify(grantData));\n      var userRoles = user.roles;\n      //find permits in grant against user's roles\n      var userPermits = [];\n      var userTimeslot = {};\n      //console.log('addUserVoucher userRoles:', JSON.stringify(userRoles));\n      userRoles.forEach(function (role) {\n        var rName = role.name;\n        //find permits for user\n        if (grantData[rName] && role.spaceId === theType.spaceId) {\n          var permit = grantData[rName];\n          var tPermits = permit.split(',');\n          tPermits.forEach(function (e) {\n            if (userPermits.indexOf(e) === -1) {\n              userPermits.push(e);\n            }\n          });\n          //console.log('addUserVoucher tPermits:', JSON.stringify(tPermits));\n          //userPermits.concat(tPermits);\n        }\n      });\n      console.log('addUserVoucher userPermits:', JSON.stringify(userPermits));\n\n      /*\n      if(voucherStatus in userPermits){\n        //userTimeslot.apply = timeSlotData.apply;\n        voucherStatus = 'allow.apply';\n      }\n      if('allow.collect' in userPermits && timeSlotData.collect){\n        //userTimeslot.collect = timeSlotData.collect;\n        voucherStatus = 'allow.collect';\n      }\n      if('allow.use' in userPermits && timeSlotData.use){\n        //userTimeslot.use = timeSlotData.use;\n        voucherStatus = 'allow.use';\n      }\n      */\n\n      //console.log('voucherStatus 1:',voucherStatus);\n      //console.log('timeSlotData:',JSON.stringify(timeSlotData));\n\n      //if user is allowed for apply or collect or use, add it to voucher table\n      if (userPermits.indexOf(voucherStatus) != -1 || userPermits.indexOf('allow.admin') != -1) {\n\n        // console.log('voucherStatus 2:',voucherStatus);\n\n        //filter timeslot according to status\n        for (var key in timeSlotData) {\n          if ('allow.' + key === voucherStatus) {\n            userTimeslot[key] = timeSlotData[key];\n          }\n        }\n\n        return Voucher.findOrCreate({\n          where: {\n            userId: userId,\n            typeId: typeId,\n            spaceId: spaceId\n          },\n          defaults: {\n            status: voucherStatus\n          }\n        }).spread(function (voucher, created) {\n          // console.log('addUserVoucher voucher:', JSON.stringify(voucher));\n          //create voucher or update status\n          if (!created && voucher.status !== voucherStatus) {\n            voucher.status = voucherStatus;\n            return voucher.save();\n          } else {\n            return Promise.resolve(voucher);\n          }\n        }).then(function (voucher) {\n\n          console.log('addUserVoucher2 voucher:', JSON.stringify(voucher));\n\n          newVoucher = voucher;\n\n          return Timeslot.addTimeslots(userTimeslot, { owner: 'voucher', ownerId: voucher._id });\n        })\n          .then(function () {\n            return Promise.resolve(newVoucher);\n          });\n      } else {\n        return Promise.reject('fail to add vouher');\n      }\n    });\n  })\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n\n} //*/\n\nexport function batchAddUserVoucher(req, res) {\n\n}\n\nexport function deleteUserVoucher(req, res) {\n  VoucherUser.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nexport function addType(req, res) {\n\n  Voucher.addType(req.body)\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n\n  /*\n\n  var typeData = {};\n  var attributeData = [];\n  var grants, timeslots;\n  var spaceId;\n\n  if (req.query && req.query.spaceId) {\n    spaceId = req.query.spaceId;\n  }\n\n  //console.log('req.body', JSON.stringify(req.body));\n\n  for (var key in req.body) {\n\n    if (key === 'name') {\n      var vName = req.body.name;\n      if (!vName.indexOf('voucher') === 0) {\n        vName\n      }\n      typeData.name = req.body.name;\n    }\n\n    if (key === 'alias') {\n      typeData.alias = req.body.alias;\n    }\n\n    if (key === 'spaceId') {\n      spaceId = typeData.spaceId = req.body.spaceId;\n    }\n\n    if (key === 'voucherMode') {\n      attributeData.push({\n        name: 'voucher.mode',\n        value: req.body.voucherMode,\n        spaceId: spaceId,\n        owner: 'voucherType'\n      });\n    }\n\n    if (key === 'voucherValue') {\n      attributeData.push({\n        name: 'voucher.value',\n        value: req.body.voucherValue,\n        spaceId: spaceId,\n        owner: 'voucherType'\n      });\n    }\n\n    if (key === 'voucherUnit') {\n      attributeData.push({\n        name: 'voucher.unit',\n        value: req.body.voucherUnit,\n        spaceId: spaceId,\n        owner: 'voucherType'\n      });\n    }\n\n    if (key === 'minExpense') {\n      attributeData.push({\n        name: 'voucher.minExpense.value',\n        value: req.body.minExpense.value,\n        spaceId: spaceId,\n        owner: 'voucherType'\n      });\n      attributeData.push({\n        name: 'voucher.minExpense.currency',\n        value: req.body.minExpense.currency,\n        spaceId: spaceId,\n        owner: 'voucherType'\n      });\n    }\n\n    if (key === 'minGroup') {\n      attributeData.push({\n        name: 'voucher.minGroup',\n        value: req.body.minGroup,\n        spaceId: spaceId,\n        owner: 'voucherType'\n      });\n    }\n\n    if (key === 'timeslots') {\n      timeslots = req.body.timeslots;\n      //console.log('timeslots:',JSON.stringify(timeslots));\n      for (var tKey in timeslots) {\n        var oTimeSlot = timeslots[tKey];\n        //console.log('oTimeSlot:',JSON.stringify(oTimeSlot));\n        for (var oKey in oTimeSlot) {\n          attributeData.push({\n            name: 'timeslot.' + tKey + '.' + oKey,\n            value: oTimeSlot[oKey],\n            spaceId: spaceId,\n            owner: 'voucherType'\n          });\n        }\n      }\n    }\n\n    if (key === 'grants') {\n      grants = req.body.grants;\n\n      for (var key in grants) {\n        attributeData.push({\n          name: 'grant.' + key,\n          value: grants[key],\n          spaceId: spaceId,\n          owner: 'voucherType'\n        });\n      }\n    }\n  }\n\n  var newType;\n\n  if (!spaceId) {\n    res.status(500).send('please provide spaceId');\n  }\n\n  typeData.spaceId = spaceId;\n\n  //console.log('attributeData:',JSON.stringify(attributeData));\n\n  Voucher.addType(typeData).then(function (type) {\n    //console.log('type:',JSON.stringify(type));\n    newType = type;\n    newType = JSON.parse(JSON.stringify(newType));\n    if (!_.isEmpty(attributeData)) {\n      attributeData.forEach(function (a) {\n        a.ownerId = type._id;\n      });\n\n      //var ar = attributeData.slice(0);\n\n      //console.log('ar:',JSON.stringify(ar));\n\n      //newType.attributes = ar;\n      //console.log('attributeData:',JSON.stringify(attributeData));\n      return Voucher.addAttributes(attributeData);\n    } else {\n      return Promise.resolve(null);\n    }\n  }).then(function () {\n    //console.log('grants:',JSON.stringify(grants));\n    if (!_.isEmpty(grants)) {\n      newType.grants = grants;\n      return Role.addGrants(grants, { spaceId: spaceId, owner: 'voucherType', ownerId: newType._id });\n    } else {\n      return Promise.resolve(null);\n    }\n  }).then(function () {\n    if (!_.isEmpty(timeslots)) {\n      newType.timeslots = timeslots;\n      //console.log('timeslots:',JSON.stringify(timeslots));\n      //return Timeslot.addTimeslots(timeslots,{spaceId: spaceId, owner: 'voucherType', ownerId: newType._id});\n    } else {\n      return Promise.resolve(null);\n    }\n  }).then(function () {\n    return Promise.resolve(newType);\n  })\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n    */\n}\n\nexport function getVouchers(req, res) {\n  var query = req.query;\n  var spaceId = query.spaceId;\n\n  //console.log('spaceId',spaceId);\n\n  if (spaceId && spaceId > 0) {\n    var whereData = {};\n    whereData.spaceId = spaceId;\n    var fVouchers = [];\n    var theVoucher;\n    Voucher.findAll(whereData).then(function (vouchers) {\n      //console.log('types:',JSON.stringify(types));\n      return Promise.map(vouchers, function (voucher) {\n        //console.log('type:',JSON.stringify(type));\n        theVoucher = voucher;\n        return Voucher.getAttributes({\n          owner: 'voucher',\n          ownerId: voucher._id\n        }).then(function (attributes) {\n          //console.log('attributes:',JSON.stringify(attributes));\n          theVoucher = JSON.parse(JSON.stringify(theVoucher));\n          theVoucher.attributes = attributes;\n          fVouchers.push(theVoucher);\n          //console.log('fTypes:',JSON.stringify(fTypes));\n          return Promise.resolve(null);\n        });\n        //console.log('types 2:',JSON.stringify(types));\n        //fTypes = types;\n      }).then(function () {\n        //console.log('fTypes 2:',JSON.stringify(fTypes));\n        return Promise.resolve(fVouchers);\n      });\n    })\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  } else {\n    res.status(500).send('please provide correct spaceId!');\n  }\n}\n\nexport function getVoucher(req, res) {\n\n  //console.log('1');\n\n  var typeId;\n\n  if (req.params && req.params.id) {\n    voucherId = req.params.id;\n  }\n\n  if (req.query && req.query.voucherId) {\n    voucherId = req.query.voucherId;\n  }\n\n  if (voucherId && voucherId > 0) {\n    return Voucher.findById(voucherId).then(function (voucher) {\n      //console.log(' voucher:', JSON.stringify(voucher));\n      return Voucher.getAttributes({\n        owner: 'voucher',\n        ownerId: voucherId,\n        spaceId: voucher.spaceId\n      }).then(function (attributes) {\n        voucher = JSON.parse(JSON.stringify(voucher));\n        voucher.attributes = attributes;\n        //type.attributes = Attribute.toObject(attributes);\n        return Promise.resolve(voucher);\n      })\n        .then(respondWithResult(res))\n        .catch(handleError(res));\n    })\n  }\n}\n"
  },
  {
    "__docId__": 608,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 20,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 609,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 610,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 31,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 611,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 40,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 612,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 51,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 613,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 61,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 614,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 615,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 78,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 616,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 139,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 617,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "bulkCreate",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~bulkCreate",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{bulkCreate}",
    "description": null,
    "lineNumber": 152,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 618,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 166,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 619,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 182,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 620,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findAllUserVoucher",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~findAllUserVoucher",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{findAllUserVoucher}",
    "description": null,
    "lineNumber": 193,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 621,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "findUserVoucher",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~findUserVoucher",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{findUserVoucher}",
    "description": null,
    "lineNumber": 199,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 622,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addUserVoucher",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~addUserVoucher",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{addUserVoucher}",
    "description": null,
    "lineNumber": 224,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 623,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "batchAddUserVoucher",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~batchAddUserVoucher",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{batchAddUserVoucher}",
    "description": null,
    "lineNumber": 369,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 624,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "deleteUserVoucher",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~deleteUserVoucher",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{deleteUserVoucher}",
    "description": null,
    "lineNumber": 373,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 625,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "addType",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~addType",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{addType}",
    "description": null,
    "lineNumber": 384,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 626,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getVouchers",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~getVouchers",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{getVouchers}",
    "description": null,
    "lineNumber": 556,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 627,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "getVoucher",
    "memberof": "api/voucher/voucher.controller.js",
    "longname": "api/voucher/voucher.controller.js~getVoucher",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.controller.js",
    "importStyle": "{getVoucher}",
    "description": null,
    "lineNumber": 597,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 628,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/voucher.events.js",
    "memberof": null,
    "longname": "api/voucher/voucher.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * App model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar App = require('../../sqldb').App;\nvar AppEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nAppEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  App.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    AppEvents.emit(event + ':' + doc._id, doc);\n    AppEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default AppEvents;\n"
  },
  {
    "__docId__": 629,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "App",
    "memberof": "api/voucher/voucher.events.js",
    "longname": "api/voucher/voucher.events.js~App",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 630,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/voucher/voucher.events.js",
    "longname": "api/voucher/voucher.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 631,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/voucher/voucher.events.js",
    "longname": "api/voucher/voucher.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 632,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/voucher.integration.js",
    "memberof": null,
    "longname": "api/voucher/voucher.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newApp;\n\ndescribe('App API:', function() {\n\n  describe('GET /api/apps', function() {\n    var apps;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          apps = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      apps.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/apps', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/apps')\n        .send({\n          name: 'New App',\n          info: 'This is the brand new app!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newApp = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created app', function() {\n      newApp.name.should.equal('New App');\n      newApp.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('GET /api/apps/:id', function() {\n    var app;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/apps/' + newApp._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          app = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      app = {};\n    });\n\n    it('should respond with the requested app', function() {\n      app.name.should.equal('New App');\n      app.info.should.equal('This is the brand new app!!!');\n    });\n\n  });\n\n  describe('PUT /api/apps/:id', function() {\n    var updatedApp;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/apps/' + newApp._id)\n        .send({\n          name: 'Updated App',\n          info: 'This is the updated app!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedApp = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedApp = {};\n    });\n\n    it('should respond with the updated app', function() {\n      updatedApp.name.should.equal('Updated App');\n      updatedApp.info.should.equal('This is the updated app!!!');\n    });\n\n  });\n\n  describe('DELETE /api/apps/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when app does not exist', function(done) {\n      request(app)\n        .delete('/api/apps/' + newApp._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 633,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/voucher/voucher.integration.js",
    "longname": "api/voucher/voucher.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 634,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/voucher.model.js",
    "memberof": null,
    "longname": "api/voucher/voucher.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport treeTable from '../../sqldb/treeTable';\nimport _ from 'lodash';\nvar Promise = require(\"bluebird\");\n\nexport default function (sequelize, DataTypes) {\n\treturn sequelize.define('Voucher', {\n\t\t_id: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tallowNull: false,\n\t\t\tprimaryKey: true,\n\t\t\tautoIncrement: true\n\t\t},\n\t\tname: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\talias: DataTypes.STRING,\n\t\tvalue: DataTypes.DECIMAL,\n\t\tdescription: DataTypes.STRING,\n\t\tstatus: DataTypes.STRING,\n\t\tspaceId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tcircleId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\ttypeId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tproductId: {\n\t\t\ttype: DataTypes.INTEGER,\n\t\t\tdefaultValue: -1\n\t\t},\n\t\tdata: DataTypes.TEXT,\n\t\tactive: DataTypes.BOOLEAN\n\t}, {\n\t\t\tgetterMethods: {\n\t\t\t\t/*\n\t\t\t\tname: function(){\n\t\t\t\t\treturn sqldb.Category.findById(this.typeId).then(function(type){\n\t\t\t\t\t\treturn type.name\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t  \n\t\t\t\ttype: function(){\n\t\t\t\t\treturn sqldb.Category.findById(this.typeId);\n\t\t\t\t}*/\n\n\t\t\t},\n\t\t\tclassMethods: {\n\n\t\t\t\taddType: function (typeData) {\n\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\tif (!isNaN(typeData)) {\n\t\t\t\t\t\treturn Category.findById(typeData);\n\t\t\t\t\t}\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar spaceId = typeData.spaceId;\n\t\t\t\t\tvar attributes;\n\n\t\t\t\t\tif (typeData.attributes) {\n\t\t\t\t\t\tattributes = typeData.attributes;\n\t\t\t\t\t\tdelete typeData.attributes;\n\t\t\t\t\t}\n\t\t\t\t\tif (attributes) {\n\t\t\t\t\t\treturn Category.getTypeRoot(typeData).then(function (typeRoot) {\n\t\t\t\t\t\t\treturn typeRoot.addChild(typeData);\n\t\t\t\t\t\t}).then(function (type) {\n\t\t\t\t\t\t\tvar newType = type;\n\t\t\t\t\t\t\t//console.log('voucher addType type:',JSON.stringify(type));\n\t\t\t\t\t\t\treturn that.addAttributes(attributes, { owner: 'type', ownerId: type._id })\n\t\t\t\t\t\t\t\t.then(function (attrs) {\n\t\t\t\t\t\t\t\t\treturn Promise.resolve(newType);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Category.getTypeRoot(typeData).then(function (typeRoot) {\n\t\t\t\t\t\t\treturn typeRoot.addChild(typeData);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetType: function (typeData, autoCreated) {\n\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\t//console.log('in space User:', User);\n\t\t\t\t\t//console.log('in space sqldb:', sqldb);\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\tvar that = this;\n\t\t\t\t\t//var Category = sqldb.Category;\n\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\tif (!isNaN(typeData) && typeData > 0) {\n\t\t\t\t\t\t//console.log('1');\n\t\t\t\t\t\treturn Category.findById(typeData)\n\t\t\t\t\t\t\t.then(function (type) {\n\t\t\t\t\t\t\t\t//console.log('2');\n\t\t\t\t\t\t\t\t//console.log('type:',JSON.stringify(type));\n\t\t\t\t\t\t\t\treturn that.getAttributes({\n\t\t\t\t\t\t\t\t\towner: 'voucherType',\n\t\t\t\t\t\t\t\t\townerId: type._id,\n\t\t\t\t\t\t\t\t\tspaceId: type.spaceId\n\t\t\t\t\t\t\t\t}).then(function (attributes) {\n\t\t\t\t\t\t\t\t\t//console.log('attributes:',JSON.stringify(attributes));\n\t\t\t\t\t\t\t\t\ttype = JSON.parse(JSON.stringify(type));\n\t\t\t\t\t\t\t\t\ttype.attributes = attributes;\n\t\t\t\t\t\t\t\t\t//console.log(\"voucher getType:\",JSON.stringify(type));\n\t\t\t\t\t\t\t\t\t//type.attributes = Attribute.toObject(attributes);\n\t\t\t\t\t\t\t\t\treturn Promise.resolve(type);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof typeData === 'string' && isNaN(typeData)) {\n\t\t\t\t\t\tvar typeName = typeData;\n\n\t\t\t\t\t\ttypeData = {};\n\n\t\t\t\t\t\ttypeData.name = typeName;\n\n\t\t\t\t\t\t//console.log('in space getType');\n\t\t\t\t\t\t//console.log('in space Category:', Category);\n\t\t\t\t\t\t//console.log('space getType typeData:', JSON.stringfy(typeData));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof typeData === 'object' && !_.isEmpty(typeData)) {\n\t\t\t\t\t\ttypeData.owner = 'voucher';\n\t\t\t\t\t\tvar tyName = typeData.name || 'voucher';\n\t\t\t\t\t\tif (tyName.substr(0, 7).toLowerCase() !== 'voucher') {\n\t\t\t\t\t\t\ttyName = 'voucher.' + tyName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttypeData.name = tyName;\n\t\t\t\t\t\t//console.log('space model typeData:', JSON.stringify(typeData));\n\t\t\t\t\t\treturn Category.getType(typeData, autoCreated)\n\t\t\t\t\t\t\t.then(function (type) {\n\t\t\t\t\t\t\t\treturn that.getAttributes({\n\t\t\t\t\t\t\t\t\towner: 'voucherType',\n\t\t\t\t\t\t\t\t\townerId: type._id,\n\t\t\t\t\t\t\t\t\tspaceId: type.spaceId\n\t\t\t\t\t\t\t\t}).then(function (attributes) {\n\t\t\t\t\t\t\t\t\t//console.log('attributes :',JSON.stringify(attributes));\n\t\t\t\t\t\t\t\t\ttype = JSON.parse(JSON.stringify(type));\n\t\t\t\t\t\t\t\t\ttype.attributes = attributes;\n\t\t\t\t\t\t\t\t\t//type.attributes = Attribute.toObject(attributes);\n\t\t\t\t\t\t\t\t\treturn Promise.resolve(type);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t//otherwise return promise reject\n\t\t\t\t\tsequelize.Promise.reject(new Error('fail to add voucher type!'));\n\t\t\t\t},\n\n\t\t\t\tgetTypes: function (typeData) {\n\n\t\t\t\t\tvar Category = sqldb.Category;\n\n\t\t\t\t\tif (typeData.spaceId && !isNaN(typeData.spaceId) && typeData.spaceId > 0) {\n\t\t\t\t\t\treturn this.getType({ spaceId: typeData.spaceId, name: 'voucher' }, true).then(function (type) {\n\t\t\t\t\t\t\t//console.log('getTypes type:',JSON.stringify(type));\n\t\t\t\t\t\t\t//console.log('getTypes type:',JSON.stringify(type));\n\t\t\t\t\t\t\treturn type.getChildren('leaf').then(function (children) {\n\t\t\t\t\t\t\t\t//console.log('getTypes children:',JSON.stringify(children));\n\t\t\t\t\t\t\t\treturn Promise.resolve(children);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t//otherwise return promise reject\n\t\t\t\t\tsequelize.Promise.reject(new Error('fail to get voucher types!'));\n\t\t\t\t},\n\n\t\t\t\taddAttributes: function (attributeData, ownerData) {\n\n\t\t\t\t\t//console.log('voucher model attributeData:',JSON.stringify(attributeData));\n\t\t\t\t\tif (typeof attributeData === 'object' && !Array.isArray(attributeData)) {\n\t\t\t\t\t\tvar oList = [];\n\t\t\t\t\t\tfor (var key in attributeData) {\n\t\t\t\t\t\t\toList.push({ name: key, value: attributeData[key] });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tattributeData = oList;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar that = this;\n\n\t\t\t\t\treturn Promise.each(attributeData, function (attr) {\n\t\t\t\t\t\t//console.log('voucher model attr:',JSON.stringify(attr));\n\t\t\t\t\t\treturn that.addAttribute(attr, ownerData);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddAttribute: function (attrData, ownerData) {\n\n\t\t\t\t\tvar Attribute = sqldb.Attribute;\n\n\t\t\t\t\tif (typeof attrData === 'object' && !_.isEmpty(attrData)) {\n\t\t\t\t\t\tif (!attrData.owner) {\n\t\t\t\t\t\t\tattrData.owner = 'voucher';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!attrData.name) {\n\t\t\t\t\t\t\tattrData.name = 'voucher';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof ownerData === 'number') {\n\t\t\t\t\t\t\tattrData.ownerId = ownerData;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof ownerData === 'object' && ownerData._id) {\n\t\t\t\t\t\t\tattrData.ownerId = ownerData._id;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof ownerData === 'object' && ownerData.owner) {\n\t\t\t\t\t\t\tattrData.owner = ownerData.owner;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof ownerData === 'object' && ownerData.ownerId) {\n\t\t\t\t\t\t\tattrData.ownerId = ownerData.ownerId;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (attrData.name) {\n\t\t\t\t\t\t\tvar aName = attrData.name;\n\t\t\t\t\t\t\tif (aName.indexOf('voucher.') !== 0 && attrData.owner === 'voucher') {\n\t\t\t\t\t\t\t\tattrData.name = 'voucher.' + aName;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//var attrName = attrData.name;\n\t\t\t\t\t\t//if(attrName.substr(0,7).toLowerCase() !== 'voucher'){\n\t\t\t\t\t\t//attrName = 'voucher.' + attrName;\n\t\t\t\t\t\t//}\n\t\t\t\t\t\t//attrData.name = attrName;\n\t\t\t\t\t\t//console.log('space model typeData:', JSON.stringify(typeData));\n\t\t\t\t\t\treturn Attribute.addAttribute(attrData);\n\t\t\t\t\t}\n\n\t\t\t\t\t//otherwise return promise reject\n\t\t\t\t\tsequelize.Promise.reject(new Error('fail to add voucher attribute!'));\n\t\t\t\t},\n\t\t\t\tgetAttributes: function (attrData) {\n\n\t\t\t\t\tvar Attribute = sqldb.Attribute;\n\n\t\t\t\t\treturn Attribute.getAttributes(attrData);\n\n\t\t\t\t},\n\t\t\t\tgetAttribute: function (attrData) {\n\n\t\t\t\t\tvar Attribute = sqldb.Attribute;\n\n\t\t\t\t\treturn Attribute.getAttribute(attrData);\n\n\t\t\t\t},\n\t\t\t\tadd: function (voucherData) {\n\t\t\t\t\t//console.log('2 voucherData:',JSON.stringify(voucherData));\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar Category = sqldb.Category;\n\t\t\t\t\tvar Role = sqldb.Role;\n\t\t\t\t\tvar Attribute = sqldb.Attribute;\n\t\t\t\t\tvar Timeslot = sqldb.Timeslot;\n\t\t\t\t\tvar attributeData = [];\n\t\t\t\t\tvar spaceId;\n\n\t\t\t\t\tvar newType, newVoucher, grants, timeslots, minExpense, minMembers;\n\n\t\t\t\t\tif (voucherData.spaceId) {\n\t\t\t\t\t\tspaceId = voucherData.spaceId;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar typeData = {//default type\n\t\t\t\t\t\tname: 'normal',\n\t\t\t\t\t\tspaceId: voucherData.spaceId\n\t\t\t\t\t};\n\n\t\t\t\t\tif (voucherData.type) {\n\t\t\t\t\t\ttypeData = voucherData.type;\n\t\t\t\t\t\ttypeData.spaceId = voucherData.spaceId;\n\t\t\t\t\t\tdelete voucherData.type;\n\t\t\t\t\t}\n\t\t\t\t\tif (voucherData.typeId) {\n\t\t\t\t\t\ttypeData = voucherData.typeId;\n\t\t\t\t\t}\n\t\t\t\t\tif (voucherData.timeslots) {\n\t\t\t\t\t\ttimeslots = voucherData.timeslots;\n\t\t\t\t\t\tdelete voucherData.timeslots;\n\n\t\t\t\t\t\tfor (var tKey in timeslots) {\n\t\t\t\t\t\t\tvar oTimeSlot = timeslots[tKey];\n\t\t\t\t\t\t\t//console.log('oTimeSlot:',JSON.stringify(oTimeSlot));\n\t\t\t\t\t\t\tfor (var oKey in oTimeSlot) {\n\t\t\t\t\t\t\t\tattributeData.push({\n\t\t\t\t\t\t\t\t\tname: 'timeslot.' + tKey + '.' + oKey,\n\t\t\t\t\t\t\t\t\tvalue: oTimeSlot[oKey],\n\t\t\t\t\t\t\t\t\tspaceId: spaceId,\n\t\t\t\t\t\t\t\t\towner: 'voucher'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (voucherData.grants) {\n\t\t\t\t\t\tgrants = voucherData.grants;\n\t\t\t\t\t\tdelete voucherData.grants;\n\n\t\t\t\t\t\tfor (var key in grants) {\n\t\t\t\t\t\t\tattributeData.push({\n\t\t\t\t\t\t\t\tname: 'grant.' + key,\n\t\t\t\t\t\t\t\tvalue: grants[key],\n\t\t\t\t\t\t\t\tspaceId: spaceId,\n\t\t\t\t\t\t\t\towner: 'voucher'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (voucherData.minMembers) {\n\t\t\t\t\t\tattributeData.push({\n\t\t\t\t\t\t\tname: 'minMembers',\n\t\t\t\t\t\t\tvalue: voucherData.minMembers,\n\t\t\t\t\t\t\tspaceId: spaceId,\n\t\t\t\t\t\t\towner: 'voucher'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdelete voucherData.minMembers;\n\t\t\t\t\t}\n\t\t\t\t\tif (voucherData.minExpense) {\n\t\t\t\t\t\tattributeData.push({\n\t\t\t\t\t\t\tname: 'minExpense.amount',\n\t\t\t\t\t\t\tvalue: voucherData.minExpense.amount,\n\t\t\t\t\t\t\tspaceId: spaceId,\n\t\t\t\t\t\t\towner: 'voucher'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tattributeData.push({\n\t\t\t\t\t\t\tname: 'minExpense.currency',\n\t\t\t\t\t\t\tvalue: voucherData.minExpense.currency,\n\t\t\t\t\t\t\tspaceId: spaceId,\n\t\t\t\t\t\t\towner: 'voucher'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdelete voucherData.minExpense;\n\t\t\t\t\t}\n\t\t\t\t\treturn that.addType(typeData).then(function (type) {\n\t\t\t\t\t\t//console.log('voucher model addType:', JSON.stringify(type));\n\t\t\t\t\t\tnewType = type;\n\t\t\t\t\t\tvar whereData = {};\n\t\t\t\t\t\tif (voucherData.name) {\n\t\t\t\t\t\t\twhereData.name = voucherData.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (voucherData.spaceId) {\n\t\t\t\t\t\t\twhereData.spaceId = voucherData.spaceId\n\t\t\t\t\t\t}\n\t\t\t\t\t\twhereData.typeId = type._id;\n\t\t\t\t\t\treturn that.findOrCreate({\n\t\t\t\t\t\t\twhere: whereData,\n\t\t\t\t\t\t\tdefaults: voucherData\n\t\t\t\t\t\t})\n\t\t\t\t\t}).spread(function (voucher, created) {\n\t\t\t\t\t\t//console.log('voucher model voucher:', JSON.stringify(voucher));\n\t\t\t\t\t\t//convert readonly voucher to writable\n\t\t\t\t\t\tnewVoucher = JSON.parse(JSON.stringify(voucher));\n\n\t\t\t\t\t\tnewVoucher.type = newType;\n\n\t\t\t\t\t\t//console.log('newVoucher:',JSON.stringify(newVoucher));\n\t\t\t\t\t\tif (!_.isEmpty(attributeData)) {\n\t\t\t\t\t\t\t//newVoucher.attributes = attributeData;\n\t\t\t\t\t\t\tattributeData.forEach(function (a) {\n\t\t\t\t\t\t\t\ta.ownerId = voucher._id;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t//console.log('ar:',JSON.stringify(ar));\n\n\t\t\t\t\t\t\t//newVoucher.attributes = ar;\n\t\t\t\t\t\t\t//console.log('attributeData:',JSON.stringify(attributeData));\n\t\t\t\t\t\t\treturn that.addAttributes(attributeData);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(function () { //addGrants\n\t\t\t\t\t\t//console.log('newVoucher:','newVoucher:'+JSON.stringify(newVoucher));\n\t\t\t\t\t\tif (!_.isEmpty(grants)) {\n\t\t\t\t\t\t\t//console.log('2 grants:',JSON.stringify(grants));\n\t\t\t\t\t\t\t//newVoucher.grants = grants;\n\t\t\t\t\t\t\t//console.log('Role:',Role);\n\t\t\t\t\t\t\treturn Role.addGrants(grants, { spaceId: spaceId, owner: 'voucher', ownerId: newVoucher._id });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t//console.log('timeslots:', JSON.stringify(timeslots));\n\t\t\t\t\t\t//if (!_.isEmpty(timeslots)) {\n\t\t\t\t\t\t\t//newVoucher.timeslots = timeslots;\n\t\t\t\t\t\t\t//console.log('2 timeslots:', JSON.stringify(timeslots));\n\t\t\t\t\t\t\t//return Timeslot.addTimeslots(timeslots, { spaceId: spaceId, owner: 'voucher', ownerId: newVoucher._id });\n\t\t\t\t\t\t//} else {\n\t\t\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t\t\t//}\n\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\tthat.hasMany(Attribute, { foreignKey: \"ownerId\", as: \"attributes\" });\n\t\t\t\t\t\tthat.belongsTo(Category,{as:'type'});\n\t\t\t\t\t\treturn that.find({\n\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t_id: newVoucher._id\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tinclude: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmodel: Category, as: 'type'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmodel: Attribute, as: \"attributes\",\n\t\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\t\t$ne: null\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbulkAdd: function (vouchers) {\n\t\t\t\t\t\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tvar list = [];\n\t\t\t\t\t\n\t\t\t\t\treturn Promise.each(vouchers,function(v){\n\t\t\t\t\t\t//console.log('bulkAdd voucherData:', JSON.stringify(v));\n\t\t\t\t\t\treturn that.add(v).then(function(voucher){\n\t\t\t\t\t\t\tlist.push(voucher);\n\t\t\t\t\t\t});\n\t\t\t\t\t}).then(function(){\n\t\t\t\t\t\treturn Promise.resolve(list);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n}\n"
  },
  {
    "__docId__": 635,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Promise",
    "memberof": "api/voucher/voucher.model.js",
    "longname": "api/voucher/voucher.model.js~Promise",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.model.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 636,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "voucher",
    "memberof": "api/voucher/voucher.model.js",
    "longname": "api/voucher/voucher.model.js~voucher",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.model.js",
    "importStyle": "voucher",
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 637,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/voucher.socket.js",
    "memberof": null,
    "longname": "api/voucher/voucher.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar AppEvents = require('./app.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('app:' + event, socket);\n\n    AppEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    AppEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 638,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "AppEvents",
    "memberof": "api/voucher/voucher.socket.js",
    "longname": "api/voucher/voucher.socket.js~AppEvents",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 639,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/voucher/voucher.socket.js",
    "longname": "api/voucher/voucher.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 640,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/voucher/voucher.socket.js",
    "longname": "api/voucher/voucher.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucher.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 641,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/voucher/voucher.socket.js",
    "longname": "api/voucher/voucher.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 642,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/voucher/voucher.socket.js",
    "longname": "api/voucher/voucher.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/voucher/voucher.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 643,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/voucher/voucherUser.model.js",
    "memberof": null,
    "longname": "api/voucher/voucherUser.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nimport sqldb from '../../sqldb';\nimport _ from 'lodash';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('VoucherUser', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n\tuserId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tvoucherId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tspaceId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tcircleId: {\n\t\ttype: DataTypes.INTEGER,\n\t\tdefaultValue: -1\n\t},\n\tstatus: {\n\t\ttype: DataTypes.STRING\n\t},\n    active: DataTypes.BOOLEAN\n  },{\n\t  classMethods: {\n\t\t  \n\t  }\n  });\n}\n"
  },
  {
    "__docId__": 644,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "voucherUser",
    "memberof": "api/voucher/voucherUser.model.js",
    "longname": "api/voucher/voucherUser.model.js~voucherUser",
    "access": null,
    "export": true,
    "importPath": "./api/voucher/voucherUser.model.js",
    "importStyle": "voucherUser",
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 645,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/wechat/index.js",
    "memberof": null,
    "longname": "api/wechat/index.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar express = require('express');\nvar controller = require('./wechat.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.get('/:id', controller.show);\nrouter.post('/', controller.create);\nrouter.put('/:id', controller.update);\nrouter.patch('/:id', controller.update);\nrouter.delete('/:id', controller.destroy);\n\nmodule.exports = router;\n"
  },
  {
    "__docId__": 646,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "express",
    "memberof": "api/wechat/index.js",
    "longname": "api/wechat/index.js~express",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 647,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "controller",
    "memberof": "api/wechat/index.js",
    "longname": "api/wechat/index.js~controller",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 648,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "router",
    "memberof": "api/wechat/index.js",
    "longname": "api/wechat/index.js~router",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 649,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/wechat/index.spec.js",
    "memberof": null,
    "longname": "api/wechat/index.spec.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar proxyquire = require('proxyquire').noPreserveCache();\n\nvar wechatCtrlStub = {\n  index: 'wechatCtrl.index',\n  show: 'wechatCtrl.show',\n  create: 'wechatCtrl.create',\n  update: 'wechatCtrl.update',\n  destroy: 'wechatCtrl.destroy'\n};\n\nvar routerStub = {\n  get: sinon.spy(),\n  put: sinon.spy(),\n  patch: sinon.spy(),\n  post: sinon.spy(),\n  delete: sinon.spy()\n};\n\n// require the index with our stubbed out modules\nvar wechatIndex = proxyquire('./index.js', {\n  'express': {\n    Router: function() {\n      return routerStub;\n    }\n  },\n  './wechat.controller': wechatCtrlStub\n});\n\ndescribe('Wechat API Router:', function() {\n\n  it('should return an express router instance', function() {\n    wechatIndex.should.equal(routerStub);\n  });\n\n  describe('GET /api/wechats', function() {\n\n    it('should route to wechat.controller.index', function() {\n      routerStub.get\n        .withArgs('/', 'wechatCtrl.index')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('GET /api/wechats/:id', function() {\n\n    it('should route to wechat.controller.show', function() {\n      routerStub.get\n        .withArgs('/:id', 'wechatCtrl.show')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('POST /api/wechats', function() {\n\n    it('should route to wechat.controller.create', function() {\n      routerStub.post\n        .withArgs('/', 'wechatCtrl.create')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PUT /api/wechats/:id', function() {\n\n    it('should route to wechat.controller.update', function() {\n      routerStub.put\n        .withArgs('/:id', 'wechatCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('PATCH /api/wechats/:id', function() {\n\n    it('should route to wechat.controller.update', function() {\n      routerStub.patch\n        .withArgs('/:id', 'wechatCtrl.update')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n  describe('DELETE /api/wechats/:id', function() {\n\n    it('should route to wechat.controller.destroy', function() {\n      routerStub.delete\n        .withArgs('/:id', 'wechatCtrl.destroy')\n        .should.have.been.calledOnce;\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 650,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "proxyquire",
    "memberof": "api/wechat/index.spec.js",
    "longname": "api/wechat/index.spec.js~proxyquire",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 651,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "wechatCtrlStub",
    "memberof": "api/wechat/index.spec.js",
    "longname": "api/wechat/index.spec.js~wechatCtrlStub",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 652,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "routerStub",
    "memberof": "api/wechat/index.spec.js",
    "longname": "api/wechat/index.spec.js~routerStub",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 653,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "wechatIndex",
    "memberof": "api/wechat/index.spec.js",
    "longname": "api/wechat/index.spec.js~wechatIndex",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/index.spec.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 654,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/wechat/wechat.controller.js",
    "memberof": null,
    "longname": "api/wechat/wechat.controller.js",
    "access": null,
    "description": null,
    "lineNumber": 10,
    "content": "/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/wechats              ->  index\n * POST    /api/wechats              ->  create\n * GET     /api/wechats/:id          ->  show\n * PUT     /api/wechats/:id          ->  update\n * DELETE  /api/wechats/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Wechat} from '../../sqldb';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Wechats\nexport function index(req, res) {\n  Wechat.findAll()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single Wechat from the DB\nexport function show(req, res) {\n  Wechat.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Wechat in the DB\nexport function create(req, res) {\n  Wechat.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Wechat in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  Wechat.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Wechat from the DB\nexport function destroy(req, res) {\n  Wechat.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n"
  },
  {
    "__docId__": 655,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "respondWithResult",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~respondWithResult",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 656,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "saveUpdates",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~saveUpdates",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "updates",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 657,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeEntity",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~removeEntity",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 33,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 658,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleEntityNotFound",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~handleEntityNotFound",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 44,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 659,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "handleError",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~handleError",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "params": [
      {
        "name": "res",
        "types": [
          "*"
        ]
      },
      {
        "name": "statusCode",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 660,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "index",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~index",
    "access": null,
    "export": true,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": "{index}",
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 661,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "show",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~show",
    "access": null,
    "export": true,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": "{show}",
    "description": null,
    "lineNumber": 69,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 662,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "create",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~create",
    "access": null,
    "export": true,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": "{create}",
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 663,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "update",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~update",
    "access": null,
    "export": true,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": "{update}",
    "description": null,
    "lineNumber": 88,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 664,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "destroy",
    "memberof": "api/wechat/wechat.controller.js",
    "longname": "api/wechat/wechat.controller.js~destroy",
    "access": null,
    "export": true,
    "importPath": "./api/wechat/wechat.controller.js",
    "importStyle": "{destroy}",
    "description": null,
    "lineNumber": 104,
    "undocument": true,
    "params": [
      {
        "name": "req",
        "types": [
          "*"
        ]
      },
      {
        "name": "res",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 665,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/wechat/wechat.events.js",
    "memberof": null,
    "longname": "api/wechat/wechat.events.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Wechat model events\n */\n\n'use strict';\n\nimport {EventEmitter} from 'events';\nvar Wechat = require('../../sqldb').Wechat;\nvar WechatEvents = new EventEmitter();\n\n// Set max event listeners (0 == unlimited)\nWechatEvents.setMaxListeners(0);\n\n// Model events\nvar events = {\n  'afterCreate': 'save',\n  'afterUpdate': 'save',\n  'afterDestroy': 'remove'\n};\n\n// Register the event emitter to the model events\nfor (var e in events) {\n  var event = events[e];\n  Wechat.hook(e, emitEvent(event));\n}\n\nfunction emitEvent(event) {\n  return function(doc, options, done) {\n    WechatEvents.emit(event + ':' + doc._id, doc);\n    WechatEvents.emit(event, doc);\n    done(null);\n  }\n}\n\nexport default WechatEvents;\n"
  },
  {
    "__docId__": 666,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "Wechat",
    "memberof": "api/wechat/wechat.events.js",
    "longname": "api/wechat/wechat.events.js~Wechat",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 667,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/wechat/wechat.events.js",
    "longname": "api/wechat/wechat.events.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 668,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "emitEvent",
    "memberof": "api/wechat/wechat.events.js",
    "longname": "api/wechat/wechat.events.js~emitEvent",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.events.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 669,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/wechat/wechat.integration.js",
    "memberof": null,
    "longname": "api/wechat/wechat.integration.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nvar app = require('../..');\nimport request from 'supertest';\n\nvar newWechat;\n\ndescribe('Wechat API:', function() {\n\n  describe('GET /api/wechats', function() {\n    var wechats;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/wechats')\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          wechats = res.body;\n          done();\n        });\n    });\n\n    it('should respond with JSON array', function() {\n      wechats.should.be.instanceOf(Array);\n    });\n\n  });\n\n  describe('POST /api/wechats', function() {\n    beforeEach(function(done) {\n      request(app)\n        .post('/api/wechats')\n        .send({\n          name: 'New Wechat',\n          info: 'This is the brand new wechat!!!'\n        })\n        .expect(201)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          newWechat = res.body;\n          done();\n        });\n    });\n\n    it('should respond with the newly created wechat', function() {\n      newWechat.name.should.equal('New Wechat');\n      newWechat.info.should.equal('This is the brand new wechat!!!');\n    });\n\n  });\n\n  describe('GET /api/wechats/:id', function() {\n    var wechat;\n\n    beforeEach(function(done) {\n      request(app)\n        .get('/api/wechats/' + newWechat._id)\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          wechat = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      wechat = {};\n    });\n\n    it('should respond with the requested wechat', function() {\n      wechat.name.should.equal('New Wechat');\n      wechat.info.should.equal('This is the brand new wechat!!!');\n    });\n\n  });\n\n  describe('PUT /api/wechats/:id', function() {\n    var updatedWechat;\n\n    beforeEach(function(done) {\n      request(app)\n        .put('/api/wechats/' + newWechat._id)\n        .send({\n          name: 'Updated Wechat',\n          info: 'This is the updated wechat!!!'\n        })\n        .expect(200)\n        .expect('Content-Type', /json/)\n        .end(function(err, res) {\n          if (err) {\n            return done(err);\n          }\n          updatedWechat = res.body;\n          done();\n        });\n    });\n\n    afterEach(function() {\n      updatedWechat = {};\n    });\n\n    it('should respond with the updated wechat', function() {\n      updatedWechat.name.should.equal('Updated Wechat');\n      updatedWechat.info.should.equal('This is the updated wechat!!!');\n    });\n\n  });\n\n  describe('DELETE /api/wechats/:id', function() {\n\n    it('should respond with 204 on successful removal', function(done) {\n      request(app)\n        .delete('/api/wechats/' + newWechat._id)\n        .expect(204)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n    it('should respond with 404 when wechat does not exist', function(done) {\n      request(app)\n        .delete('/api/wechats/' + newWechat._id)\n        .expect(404)\n        .end((err, res) => {\n          if (err) {\n            return done(err);\n          }\n          done();\n        });\n    });\n\n  });\n\n});\n"
  },
  {
    "__docId__": 670,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "app",
    "memberof": "api/wechat/wechat.integration.js",
    "longname": "api/wechat/wechat.integration.js~app",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.integration.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 671,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/wechat/wechat.model.js",
    "memberof": null,
    "longname": "api/wechat/wechat.model.js",
    "access": null,
    "description": null,
    "lineNumber": 1,
    "content": "'use strict';\n\nexport default function(sequelize, DataTypes) {\n  return sequelize.define('Wechat', {\n    _id: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    name: DataTypes.STRING,\n    info: DataTypes.STRING,\n    active: DataTypes.BOOLEAN\n  });\n}\n"
  },
  {
    "__docId__": 672,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "wechat",
    "memberof": "api/wechat/wechat.model.js",
    "longname": "api/wechat/wechat.model.js~wechat",
    "access": null,
    "export": true,
    "importPath": "./api/wechat/wechat.model.js",
    "importStyle": "wechat",
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "params": [
      {
        "name": "sequelize",
        "types": [
          "*"
        ]
      },
      {
        "name": "DataTypes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 673,
    "kind": "file",
    "static": true,
    "variation": null,
    "name": "api/wechat/wechat.socket.js",
    "memberof": null,
    "longname": "api/wechat/wechat.socket.js",
    "access": null,
    "description": null,
    "lineNumber": 5,
    "content": "/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict';\n\nvar WechatEvents = require('./wechat.events');\n\n// Model events to emit\nvar events = ['save', 'remove'];\n\nexport function register(socket) {\n  // Bind model events to socket events\n  for (var i = 0, eventsLength = events.length; i < eventsLength; i++) {\n    var event = events[i];\n    var listener = createListener('wechat:' + event, socket);\n\n    WechatEvents.on(event, listener);\n    socket.on('disconnect', removeListener(event, listener));\n  }\n}\n\n\nfunction createListener(event, socket) {\n  return function(doc) {\n    socket.emit(event, doc);\n  };\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    WechatEvents.removeListener(event, listener);\n  };\n}\n"
  },
  {
    "__docId__": 674,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "WechatEvents",
    "memberof": "api/wechat/wechat.socket.js",
    "longname": "api/wechat/wechat.socket.js~WechatEvents",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 675,
    "kind": "variable",
    "static": true,
    "variation": null,
    "name": "events",
    "memberof": "api/wechat/wechat.socket.js",
    "longname": "api/wechat/wechat.socket.js~events",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    }
  },
  {
    "__docId__": 676,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "register",
    "memberof": "api/wechat/wechat.socket.js",
    "longname": "api/wechat/wechat.socket.js~register",
    "access": null,
    "export": true,
    "importPath": "./api/wechat/wechat.socket.js",
    "importStyle": "{register}",
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "params": [
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "generator": false
  },
  {
    "__docId__": 677,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "createListener",
    "memberof": "api/wechat/wechat.socket.js",
    "longname": "api/wechat/wechat.socket.js~createListener",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 24,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "socket",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 678,
    "kind": "function",
    "static": true,
    "variation": null,
    "name": "removeListener",
    "memberof": "api/wechat/wechat.socket.js",
    "longname": "api/wechat/wechat.socket.js~removeListener",
    "access": null,
    "export": false,
    "importPath": "./api/wechat/wechat.socket.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "params": [
      {
        "name": "event",
        "types": [
          "*"
        ]
      },
      {
        "name": "listener",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "generator": false
  },
  {
    "__docId__": 680,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Infinity",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Infinity",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Infinity",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 681,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "NaN",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NaN",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~NaN",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 682,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "undefined",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~undefined",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 683,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "null",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/null",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~null",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 684,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Object",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Object",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 685,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "object",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~object",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 686,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Function",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Function",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 687,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "function",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~function",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 688,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Boolean",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Boolean",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 689,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "boolean",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~boolean",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 690,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Symbol",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Symbol",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 691,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Error",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Error",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 692,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "EvalError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/EvalError",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~EvalError",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 693,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "InternalError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/InternalError",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~InternalError",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 694,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "RangeError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RangeError",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~RangeError",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 695,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "ReferenceError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ReferenceError",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~ReferenceError",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 696,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "SyntaxError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SyntaxError",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~SyntaxError",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 697,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "TypeError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypeError",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~TypeError",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 698,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "URIError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/URIError",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~URIError",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 699,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Number",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Number",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 700,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "number",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~number",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 701,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Date",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Date",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 702,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "String",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~String",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 703,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "string",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~string",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 704,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "RegExp",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~RegExp",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 705,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 706,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Int8Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int8Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Int8Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 707,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Uint8Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Uint8Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 708,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Uint8ClampedArray",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Uint8ClampedArray",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 709,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Int16Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int16Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Int16Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 710,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Uint16Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Uint16Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 711,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Int32Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int32Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Int32Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 712,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Uint32Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Uint32Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 713,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Float32Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Float32Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 714,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Float64Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float64Array",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Float64Array",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 715,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Map",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Map",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 716,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Set",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Set",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 717,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "WeakMap",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~WeakMap",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 718,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "WeakSet",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~WeakSet",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 719,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "ArrayBuffer",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~ArrayBuffer",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 720,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "DataView",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~DataView",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 721,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "JSON",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~JSON",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 722,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Promise",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Promise",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 723,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Generator",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Generator",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 724,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "GeneratorFunction",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/GeneratorFunction",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~GeneratorFunction",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 725,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Reflect",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Reflect",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 726,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Proxy",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",
    "memberof": "BuiltinExternal/ECMAScriptExternal.js",
    "longname": "BuiltinExternal/ECMAScriptExternal.js~Proxy",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 728,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "CanvasRenderingContext2D",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~CanvasRenderingContext2D",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 729,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "DocumentFragment",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~DocumentFragment",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 730,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Element",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/API/Element",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~Element",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 731,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Event",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/API/Event",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~Event",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 732,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "Node",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/API/Node",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~Node",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 733,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "NodeList",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/API/NodeList",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~NodeList",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 734,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "XMLHttpRequest",
    "externalLink": "https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~XMLHttpRequest",
    "access": null,
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 735,
    "kind": "external",
    "static": true,
    "variation": null,
    "name": "AudioContext",
    "externalLink": "https://developer.mozilla.org/en/docs/Web/API/AudioContext",
    "memberof": "BuiltinExternal/WebAPIExternal.js",
    "longname": "BuiltinExternal/WebAPIExternal.js~AudioContext",
    "access": null,
    "description": "",
    "builtinExternal": true
  }
]